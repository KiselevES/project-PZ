class mainObjectClass {
    constructor() {
        //интервал запросов
        this.requestInterval = 10;

        //время отправки сообщения (переаодим в сек)
        this.messageTime = 23 * 60;

        //время до просрочки (переводим в сек)
        this.expirationTime = 30 * 60;

        //пустой массив под заказы
        this.orders = [];
    }
}
class orderClass {
    constructor(orderNumber) {
        this.unixTime = parseInt(new Date().getTime() / 1000);
        this.date = parseInt(new Date().getDate());
        this.expired = false;
        this.messageSent = false;
        this.complete = false;
        this.completeTime = 0;
        this.inQueue = false;
        this.preparing = false;
        this.orderNumber = orderNumber;
        this.needMessage = false;
        this.remade = false;
    }

    setExpired() {
        this.expired = true;
    }

    setMessageSent() {
        this.messageSent = true;
        this.needMessage = false;
    }

    setNeedMessage(){
        this.needMessage = true;
    }

    setTime(time) {
        this.completeTime = time - this.unixTime;
    }

    setQueue() {
        this.inQueue = true;
        this.preparing = false;
    }

    setPreparing() {
        this.preparing = true;
        this.inQueue = false;
    }

    setComplete() {
        this.complete = true;
        this.preparing = false;
        this.inQueue = false;
    }

    setRemade(){
        this.Complete = false;
        this.Remade = true;
    }

}

function getMainObject() {
    return JSON.parse(localStorage.getItem('mainObject'));
}

function isMainObjectExists() {
    return localStorage.getItem('mainObject') !== null;
}

function setMainObject(mainObject) {
    localStorage.setItem('mainObject', JSON.stringify(mainObject));
}

function ismainObjectContainsOrder(mainObject, orderNumber) {
    for (let i = 0; i < mainObject.orders.length; i++) {
        if (mainObject.orders[i].orderNumber === orderNumber) {
            return true;
        }
    }
    return false;
}

function getSameOrder(newContentObject, orderNumber) {
    for (let i = 0; i < newContentObject.orders.length; i++) {
        if (newContentObject.orders[i].orderNumber === orderNumber) {
            return newContentObject.orders[i].orderNumber;
        }
    }
    return false;
}

function isOrderRemade(mainObject, orderNumber) {
    for (let i = 0; i < mainObject.orders.length; i++) {
        if (mainObject.orders[i].orderNumber === orderNumber && mainObject.orders[i].complete === true) {
            return true;
        }
    }
    return false;
}

function secondsTimeToNormal(seconds) {
    let minutes = Math.floor(seconds / 60) + '';
    let secs = seconds % 60 + '';
    if (secs.length < 2) {
        secs = '0' + secs;
    }
    return result = minutes + ':' + secs
}
document.addEventListener("DOMContentLoaded", () => {
    function setContentHeight() {
        const header = document.querySelector('.header');
        const wrapper = document.querySelector('.wrapper');
        const footer = document.querySelector('.footer');
        const setHeightContainer = document.querySelector('.set-height');
        const neededHeight = wrapper.offsetHeight - header.offsetHeight - footer.offsetHeight;

        if (setHeightContainer.offsetHeight < neededHeight) {
            setHeightContainer.style.height = neededHeight + 'px';
        }
    }

    setContentHeight();
    window.addEventListener('resize', setContentHeight);
})



const model = {


    callExternalContent() {
        return new Promise((resolve, reject) => {
            const x = new XMLHttpRequest();

            //ajax запрос через прокси cors-anywhere
            x.open('GET', 'https://cors-anywhere.herokuapp.com/https://akson.ru/personal/order/table1/?STORE_ID=11');
            //x.open('GET', 'pz4.html');

            //x.timeout = 5000;
            x.send();
            x.onload = () => {
                if (x.status != 200) {
                    reject(x.statusText)
                } else {
                    resolve(x.responseText || '');
                }
            };
        })
    },
    //
    getContent(externalContent) {
        //вытаскиваем таблицу из исходного кода
        const cutExternalContent = externalContent.substr(3196, externalContent.length - 3370);
        //console.log(cutExternalContent);
        const hiddenTable = document.querySelector('.hidden-table');
        hiddenTable.innerHTML = cutExternalContent;
        //вытаскиваем строки
        const rows = document.getElementsByTagName('tr');
        //переменная для строк фильтрованной таблицы
        let filteredRows = [];

        //удаляем строки заголовков таблиц, удаляем отмененные заказы, формируем одну таблицу из двух
        for (let i = 0; i < rows.length; i++) {
            if (rows[i].innerHTML.length !== 377) {
                if (rows[i].children[3].innerHTML.length > 100) {
                    rows[i].parentNode.removeChild(rows[i]);
                } else {
                    filteredRows.push(rows[i]);
                }
            }
        }
        //удаляем четвертую ячейку
        for (let i = 0; i < filteredRows.length; i++) {
            filteredRows[i].removeChild(filteredRows[i].children[3]);
        }

        const newContentObject = new mainObjectClass();
        filteredRows.forEach((item) => {
            const orderNumber = parseInt(item.children[0].children[0].children[0].innerHTML);
            const order = new orderClass(orderNumber);
            //console.log(item.children[1].children[0].innerHTML.length);
            if (item.children[1].children[0].innerHTML.length > 30) {
                order.setQueue();
            } else if (item.children[2].children[0].innerHTML.length > 30) {
                order.setPreparing();
            }
            newContentObject.orders.push(order);
        })

        //удаляем таблицу
        hiddenTable.innerHTML = '';

        if (!isMainObjectExists()) {
            setMainObject(newContentObject);
            this.getContent(externalContent);
        } else {
            const notFormattedmainObject = getMainObject();
            const mainObject = new mainObjectClass();

            mainObject.requestInterval = notFormattedmainObject.requestInterval;
            mainObject.messageTime = notFormattedmainObject.messageTime;
            mainObject.expirationTime = notFormattedmainObject.expirationTime;

            notFormattedmainObject.orders.forEach((item) => {
                let currentOrder = new orderClass(item.orderNumber);
                currentOrder.expired = item.expired;
                currentOrder.messageSent = item.messageSent;
                currentOrder.complete = item.complete;
                currentOrder.completeTime = item.completeTime;
                currentOrder.inQueue = item.inQueue;
                currentOrder.preparing = item.preparing;
                currentOrder.remade = item.remade;
                currentOrder.unixTime = item.unixTime;
                currentOrder.date = item.date;
                currentOrder.needMessage = item.needMessage;
                mainObject.orders.push(currentOrder);
            })


            // Добавляем новые заказы
            newContentObject.orders.forEach((item, i) => {
                if (!ismainObjectContainsOrder(mainObject, item.orderNumber)) {
                    mainObject.orders.push(newContentObject.orders[i]);
                }
            })
            //если старого заказа нет в списке заказов нового объекта, помечаем старый подтвержденным
            mainObject.orders.forEach((item) => {
                if (!getSameOrder(newContentObject, item.orderNumber)) {
                    item.setComplete();
                }
            })
            //получаем перевыгруженные заказы
            newContentObject.orders.forEach((item) => {
                if (isOrderRemade(mainObject, item.orderNumber)) {
                    for (let i = 0; i < mainObject.orders.length; i++) {
                        if (mainObject.orders[i].orderNumber === item.orderNumber) {
                            mainObject.orders[i].remade = true;
                            mainObject.orders[i].expired = item.expired;
                            mainObject.orders[i].messageSent = false;
                            mainObject.orders[i].unixTime = parseInt(new Date().getTime() / 1000);
                            mainObject.orders[i].complete = false;
                            mainObject.orders[i].completeTime = 0;
                            mainObject.orders[i].inQueue = item.inQueue;
                            mainObject.orders[i].preparing = item.preparing;
                            mainObject.orders[i].date = item.date;
                            mainObject.orders[i].needMessage = item.needMessage;
                        }
                    }
                }
            })

            //задаем время наборки
            mainObject.orders.forEach((item) => {
                if (item.complete === false) {
                    item.setTime(parseInt(new Date().getTime() / 1000));
                }
            })

            //проверяем на просрочку

            mainObject.orders.forEach((item) => {
                if (item.completeTime > mainObject.expirationTime) {
                    item.setExpired();
                }
            })

            //удаляем заказы возрастом более 10 дней
            for (let i = mainObject.orders.length - 1; i >= 0; i--) {
                if (parseInt(new Date().getTime() / 1000) - mainObject.orders[i].unixTime > 864000) {
                    mainObject.orders.splice(i, 1);
                }
            }

            setMainObject(mainObject);
        }
    },

    setWarning() {
        const mainObject = getMainObject();
        console.log(mainObject);
        mainObject.orders.forEach((item) => {
            if (parseInt(new Date().getTime() / 1000) - item.unixTime > mainObject.messageTime && !item.complete && !item.messageSent) {
                item.needMessage = true;
            }
        })
        setMainObject(mainObject);
    }


}
view = {
    drawTable() {
        const mainObject = getMainObject();
        const newTable = document.querySelector('.new-table');
        newTable.innerHTML = '';
        // const tableHeader = document.createElement('tr');
        // tableHeader.classList.add('new-table__header');
        // newTable.appendChild(tableHeader);
        // const tableHeaderCellNumber = document.createElement('th');
        // tableHeaderCellNumber.classList.add('new-table__header-cell');
        // tableHeaderCellNumber.textContent= '№';
        // tableHeader.appendChild(tableHeaderCellNumber);
        // const tableHeaderCellOrderNumber = document.createElement('th');
        // tableHeaderCellOrderNumber.classList.add('new-table__header-cell');
        // tableHeaderCellOrderNumber.textContent = '№ заказа';
        // tableHeader.appendChild(tableHeaderCellOrderNumber);
        // const tableHeaderOrderInQueue = document.createElement('th');
        // tableHeaderOrderInQueue.classList.add('new-table__header-cell');
        // tableHeaderOrderInQueue.textContent='В очереди';
        // tableHeader.appendChild(tableHeaderOrderInQueue);
        // const tableHeaderOrderIsPreparing = document.createElement('tr');
        // tableHeaderOrderIsPreparing.classList.add('new-table__header-cell');
        // tableHeaderOrderIsPreparing.textContent = 'В наборе';
        // tableHeader.appendChild(tableHeaderOrderIsPreparing);
        // const tableHeaderTime = document.createElement('tr');
        // tableHeaderTime.classList.add('new-table__header-cell');
        // tableHeaderTime.textContent = 'Время набора';
        // tableHeader.appendChild(tableHeaderTime);


        newTable.insertAdjacentHTML('beforeend', '' +
            '                 <thead>' +
            '                    <tr class="new-table__header">\n' +
            '                        <th class="new-table__header-cell">№</th>\n' +
            '                        <th class="new-table__header-cell">Номер заказа</th>\n' +
            '                        <th class="new-table__header-cell">В очереди</th>\n' +
            '                        <th class="new-table__header-cell">В наборе</th>\n' +
            '                        <th class="new-table__header-cell">Завершен</th>\n' +
            '                        <th class="new-table__header-cell">Время</th>\n' +
            '                    </tr>' +
            '                 </thead>');

        let counter = 1;
        mainObject.orders.forEach((item) => {

            let inQueue = '';
            if (item.inQueue === true) {
                inQueue = 'X';
            }
            let preparing = '';
            if (item.preparing === true) {
                preparing = 'X';
            }
            let complete = '';
            if (item.complete === true) {
                complete = 'X';
            }
            let time = secondsTimeToNormal(item.completeTime);
            if (item.date === parseInt(new Date().getDate()) && item.remade && !item.messageSent) {
                newTable.insertAdjacentHTML('beforeend', `
                    <tbody>
                        <tr class="new-table__row new-table__order-remade">
                            <td class="new-table__cell">${counter}</td>
                            <td class="new-table__cell">${item.orderNumber}</td>
                            <td class="new-table__cell">${inQueue}</td>
                            <td class="new-table__cell">${preparing}</td>
                            <td class="new-table__cell">${complete}</td>
                            <td class="new-table__cell">${time}</td>
                        </tr>
                    </tbody>`
                )
            } else if (item.date === parseInt(new Date().getDate()) && !item.expired && !item.messageSent) {
                newTable.insertAdjacentHTML('beforeend', `
                    <tbody>
                        <tr class="new-table__row new-table__order-normal">
                            <td class="new-table__cell">${counter}</td>
                            <td class="new-table__cell">${item.orderNumber}</td>
                            <td class="new-table__cell">${inQueue}</td>
                            <td class="new-table__cell">${preparing}</td>
                            <td class="new-table__cell">${complete}</td>
                            <td class="new-table__cell">${time}</td>
                        </tr>
                    </tbody>`
                )
            } else if (item.date === parseInt(new Date().getDate()) && !item.expired && item.messageSent) {
                newTable.insertAdjacentHTML('beforeend', `
                    <tbody>
                        <tr class="new-table__row new-table__order-warning">
                            <td class="new-table__cell">${counter}</td>
                            <td class="new-table__cell">${item.orderNumber}</td>
                            <td class="new-table__cell">${inQueue}</td>
                            <td class="new-table__cell">${preparing}</td>
                            <td class="new-table__cell">${complete}</td>
                            <td class="new-table__cell">${time}</td>
                        </tr>
                    </tbody>`
                )
            } else if (item.date === parseInt(new Date().getDate()) && item.expired && item.messageSent) {
                newTable.insertAdjacentHTML('beforeend', `
                    <tbody>
                        <tr class="new-table__row new-table__order-expired">
                            <td class="new-table__cell">${counter}</td>
                            <td class="new-table__cell">${item.orderNumber}</td>
                            <td class="new-table__cell">${inQueue}</td>
                            <td class="new-table__cell">${preparing}</td>
                            <td class="new-table__cell">${complete}</td>
                            <td class="new-table__cell">${time}</td>
                        </tr>
                    </tbody>`
                )

            }
            counter++;
        })

    },

    sendMessage(message) {
        const x = new XMLHttpRequest();
        x.open('GET', 'https://api.telegram.org/bot1018757013:AAEHO9accUhscieT0ArRq9iwUeat6BmEzOM/sendMessage?chat_id=-1001471677614&text=' + message);
        x.send();


    },

    sendMessages() {
        const mainObject = getMainObject();
        mainObject.orders.forEach((item) => {
            if (item.needMessage === true) {
                this.sendMessage('Заказ ' + item.orderNumber + ' в наборе уже более ' + mainObject.expirationTime / 60 + ' минут');
                //console.log('Заказ ' + item.orderNumber + ' в наборе уже более ' + mainObject.expirationTime / 60 + ' минут')
                item.messageSent = true;
                item.needMessage = false;
            }
        })
        setMainObject(mainObject);
    },

    setPlaceholders() {
        const mainObject = getMainObject();
        document.querySelector('.options__time-to-expire').placeholder = mainObject.expirationTime / 60;
        document.querySelector('.options__time-to-send-message').placeholder = mainObject.messageTime / 60;
        document.querySelector('.options__request-interval').placeholder = mainObject.requestInterval;
    }
}

document.addEventListener("DOMContentLoaded", () => {
    let interval = 10;
    if (isMainObjectExists()) {
        const mainObject = getMainObject();
        interval = mainObject.requestInterval;
    }

    model.callExternalContent()
        .then((response) => {
            model.getContent(response);
            model.setWarning();
            view.sendMessages();
            view.drawTable();
            view.setPlaceholders();
        })

    window.setInterval(() => {
        model.callExternalContent()
            .then((response) => {
                model.getContent(response);
                model.setWarning();
                view.sendMessages();
                view.drawTable();
                view.setPlaceholders();
            })
    }, interval * 1000);

})

//устанавливаем интервал, время сообщения, время до просрочки
document.querySelector('.options__time-to-expire-button').addEventListener('click', (e) => {
    e.preventDefault();
    const expireTextArea = document.querySelector('.options__time-to-expire');
    if (expireTextArea.value) {
        const mainObject = getMainObject();
        mainObject.expirationTime = parseInt(expireTextArea.value) * 60;
        setMainObject(mainObject);
        expireTextArea.placeholder = expireTextArea.value;
        expireTextArea.value = '';
    } else {
        //TODO: Дописать вывод на экран сообщения о том, что значение не введено
    }
})

document.querySelector('.options__time-to-send-message-button').addEventListener('click', (e) => {
    e.preventDefault();
    const messageTextArea = document.querySelector('.options__time-to-send-message');
    if (messageTextArea.value) {
        const mainObject = getMainObject();
        mainObject.messageTime = parseInt(messageTextArea.value) * 60;
        messageTextArea.placeholder = messageTextArea.value;
        messageTextArea.value = '';
        setMainObject(mainObject);
    } else {
        //TODO: дописать вывод на экран о том, что значение не введено
    }
})

document.querySelector('.options__request-interval-button').addEventListener('click', (e) => {
    e.preventDefault();
    const requestTextArea = document.querySelector('.options__request-interval');
    if (requestTextArea.value && parseInt(requestTextArea.value) > 10) {
        const mainObject = getMainObject();
        mainObject.requestInterval = parseInt(requestTextArea.value) * 1000;
        requestTextArea.placeholder = requestTextArea.value;
        requestTextArea.value = '';
        setMainObject(mainObject);
    } else {
        //TODO: дописать вывод на экран о том, что значение не введено или меньше 10 сек
    }
})
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIk1haW5PYmplY3RDbGFzcy5qcyIsIm9yZGVyQ2xhc3MuanMiLCJmdW5jdGlvbnMuanMiLCJhZGp1c3RtZW50LmpzIiwiTW9kZWwuanMiLCJWaWV3LmpzIiwiQ29udHJvbGxlci5qcyIsIm1haW4uanMiLCJldmVudExpc3RlbmVycy5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNkQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3REQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDOUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDbEJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDbEtBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDaEpBO0FDQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzVCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJmaWxlIjoianMubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiY2xhc3MgbWFpbk9iamVjdENsYXNzIHtcbiAgICBjb25zdHJ1Y3RvcigpIHtcbiAgICAgICAgLy/QuNC90YLQtdGA0LLQsNC7INC30LDQv9GA0L7RgdC+0LJcbiAgICAgICAgdGhpcy5yZXF1ZXN0SW50ZXJ2YWwgPSAxMDtcblxuICAgICAgICAvL9Cy0YDQtdC80Y8g0L7RgtC/0YDQsNCy0LrQuCDRgdC+0L7QsdGJ0LXQvdC40Y8gKNC/0LXRgNC10LDQvtC00LjQvCDQsiDRgdC10LopXG4gICAgICAgIHRoaXMubWVzc2FnZVRpbWUgPSAyMyAqIDYwO1xuXG4gICAgICAgIC8v0LLRgNC10LzRjyDQtNC+INC/0YDQvtGB0YDQvtGH0LrQuCAo0L/QtdGA0LXQstC+0LTQuNC8INCyINGB0LXQuilcbiAgICAgICAgdGhpcy5leHBpcmF0aW9uVGltZSA9IDMwICogNjA7XG5cbiAgICAgICAgLy/Qv9GD0YHRgtC+0Lkg0LzQsNGB0YHQuNCyINC/0L7QtCDQt9Cw0LrQsNC30YtcbiAgICAgICAgdGhpcy5vcmRlcnMgPSBbXTtcbiAgICB9XG59IiwiY2xhc3Mgb3JkZXJDbGFzcyB7XG4gICAgY29uc3RydWN0b3Iob3JkZXJOdW1iZXIpIHtcbiAgICAgICAgdGhpcy51bml4VGltZSA9IHBhcnNlSW50KG5ldyBEYXRlKCkuZ2V0VGltZSgpIC8gMTAwMCk7XG4gICAgICAgIHRoaXMuZGF0ZSA9IHBhcnNlSW50KG5ldyBEYXRlKCkuZ2V0RGF0ZSgpKTtcbiAgICAgICAgdGhpcy5leHBpcmVkID0gZmFsc2U7XG4gICAgICAgIHRoaXMubWVzc2FnZVNlbnQgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5jb21wbGV0ZSA9IGZhbHNlO1xuICAgICAgICB0aGlzLmNvbXBsZXRlVGltZSA9IDA7XG4gICAgICAgIHRoaXMuaW5RdWV1ZSA9IGZhbHNlO1xuICAgICAgICB0aGlzLnByZXBhcmluZyA9IGZhbHNlO1xuICAgICAgICB0aGlzLm9yZGVyTnVtYmVyID0gb3JkZXJOdW1iZXI7XG4gICAgICAgIHRoaXMubmVlZE1lc3NhZ2UgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5yZW1hZGUgPSBmYWxzZTtcbiAgICB9XG5cbiAgICBzZXRFeHBpcmVkKCkge1xuICAgICAgICB0aGlzLmV4cGlyZWQgPSB0cnVlO1xuICAgIH1cblxuICAgIHNldE1lc3NhZ2VTZW50KCkge1xuICAgICAgICB0aGlzLm1lc3NhZ2VTZW50ID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5uZWVkTWVzc2FnZSA9IGZhbHNlO1xuICAgIH1cblxuICAgIHNldE5lZWRNZXNzYWdlKCl7XG4gICAgICAgIHRoaXMubmVlZE1lc3NhZ2UgPSB0cnVlO1xuICAgIH1cblxuICAgIHNldFRpbWUodGltZSkge1xuICAgICAgICB0aGlzLmNvbXBsZXRlVGltZSA9IHRpbWUgLSB0aGlzLnVuaXhUaW1lO1xuICAgIH1cblxuICAgIHNldFF1ZXVlKCkge1xuICAgICAgICB0aGlzLmluUXVldWUgPSB0cnVlO1xuICAgICAgICB0aGlzLnByZXBhcmluZyA9IGZhbHNlO1xuICAgIH1cblxuICAgIHNldFByZXBhcmluZygpIHtcbiAgICAgICAgdGhpcy5wcmVwYXJpbmcgPSB0cnVlO1xuICAgICAgICB0aGlzLmluUXVldWUgPSBmYWxzZTtcbiAgICB9XG5cbiAgICBzZXRDb21wbGV0ZSgpIHtcbiAgICAgICAgdGhpcy5jb21wbGV0ZSA9IHRydWU7XG4gICAgICAgIHRoaXMucHJlcGFyaW5nID0gZmFsc2U7XG4gICAgICAgIHRoaXMuaW5RdWV1ZSA9IGZhbHNlO1xuICAgIH1cblxuICAgIHNldFJlbWFkZSgpe1xuICAgICAgICB0aGlzLkNvbXBsZXRlID0gZmFsc2U7XG4gICAgICAgIHRoaXMuUmVtYWRlID0gdHJ1ZTtcbiAgICB9XG5cbn1cbiIsImZ1bmN0aW9uIGdldE1haW5PYmplY3QoKSB7XG4gICAgcmV0dXJuIEpTT04ucGFyc2UobG9jYWxTdG9yYWdlLmdldEl0ZW0oJ21haW5PYmplY3QnKSk7XG59XG5cbmZ1bmN0aW9uIGlzTWFpbk9iamVjdEV4aXN0cygpIHtcbiAgICByZXR1cm4gbG9jYWxTdG9yYWdlLmdldEl0ZW0oJ21haW5PYmplY3QnKSAhPT0gbnVsbDtcbn1cblxuZnVuY3Rpb24gc2V0TWFpbk9iamVjdChtYWluT2JqZWN0KSB7XG4gICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oJ21haW5PYmplY3QnLCBKU09OLnN0cmluZ2lmeShtYWluT2JqZWN0KSk7XG59XG5cbmZ1bmN0aW9uIGlzbWFpbk9iamVjdENvbnRhaW5zT3JkZXIobWFpbk9iamVjdCwgb3JkZXJOdW1iZXIpIHtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IG1haW5PYmplY3Qub3JkZXJzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIGlmIChtYWluT2JqZWN0Lm9yZGVyc1tpXS5vcmRlck51bWJlciA9PT0gb3JkZXJOdW1iZXIpIHtcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG4gICAgfVxuICAgIHJldHVybiBmYWxzZTtcbn1cblxuZnVuY3Rpb24gZ2V0U2FtZU9yZGVyKG5ld0NvbnRlbnRPYmplY3QsIG9yZGVyTnVtYmVyKSB7XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBuZXdDb250ZW50T2JqZWN0Lm9yZGVycy5sZW5ndGg7IGkrKykge1xuICAgICAgICBpZiAobmV3Q29udGVudE9iamVjdC5vcmRlcnNbaV0ub3JkZXJOdW1iZXIgPT09IG9yZGVyTnVtYmVyKSB7XG4gICAgICAgICAgICByZXR1cm4gbmV3Q29udGVudE9iamVjdC5vcmRlcnNbaV0ub3JkZXJOdW1iZXI7XG4gICAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIGZhbHNlO1xufVxuXG5mdW5jdGlvbiBpc09yZGVyUmVtYWRlKG1haW5PYmplY3QsIG9yZGVyTnVtYmVyKSB7XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBtYWluT2JqZWN0Lm9yZGVycy5sZW5ndGg7IGkrKykge1xuICAgICAgICBpZiAobWFpbk9iamVjdC5vcmRlcnNbaV0ub3JkZXJOdW1iZXIgPT09IG9yZGVyTnVtYmVyICYmIG1haW5PYmplY3Qub3JkZXJzW2ldLmNvbXBsZXRlID09PSB0cnVlKSB7XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gZmFsc2U7XG59XG5cbmZ1bmN0aW9uIHNlY29uZHNUaW1lVG9Ob3JtYWwoc2Vjb25kcykge1xuICAgIGxldCBtaW51dGVzID0gTWF0aC5mbG9vcihzZWNvbmRzIC8gNjApICsgJyc7XG4gICAgbGV0IHNlY3MgPSBzZWNvbmRzICUgNjAgKyAnJztcbiAgICBpZiAoc2Vjcy5sZW5ndGggPCAyKSB7XG4gICAgICAgIHNlY3MgPSAnMCcgKyBzZWNzO1xuICAgIH1cbiAgICByZXR1cm4gcmVzdWx0ID0gbWludXRlcyArICc6JyArIHNlY3Ncbn0iLCJkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKFwiRE9NQ29udGVudExvYWRlZFwiLCAoKSA9PiB7XG4gICAgZnVuY3Rpb24gc2V0Q29udGVudEhlaWdodCgpIHtcbiAgICAgICAgY29uc3QgaGVhZGVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmhlYWRlcicpO1xuICAgICAgICBjb25zdCB3cmFwcGVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLndyYXBwZXInKTtcbiAgICAgICAgY29uc3QgZm9vdGVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmZvb3RlcicpO1xuICAgICAgICBjb25zdCBzZXRIZWlnaHRDb250YWluZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuc2V0LWhlaWdodCcpO1xuICAgICAgICBjb25zdCBuZWVkZWRIZWlnaHQgPSB3cmFwcGVyLm9mZnNldEhlaWdodCAtIGhlYWRlci5vZmZzZXRIZWlnaHQgLSBmb290ZXIub2Zmc2V0SGVpZ2h0O1xuXG4gICAgICAgIGlmIChzZXRIZWlnaHRDb250YWluZXIub2Zmc2V0SGVpZ2h0IDwgbmVlZGVkSGVpZ2h0KSB7XG4gICAgICAgICAgICBzZXRIZWlnaHRDb250YWluZXIuc3R5bGUuaGVpZ2h0ID0gbmVlZGVkSGVpZ2h0ICsgJ3B4JztcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHNldENvbnRlbnRIZWlnaHQoKTtcbiAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigncmVzaXplJywgc2V0Q29udGVudEhlaWdodCk7XG59KVxuXG5cbiIsImNvbnN0IG1vZGVsID0ge1xuXG5cbiAgICBjYWxsRXh0ZXJuYWxDb250ZW50KCkge1xuICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgeCA9IG5ldyBYTUxIdHRwUmVxdWVzdCgpO1xuXG4gICAgICAgICAgICAvL2FqYXgg0LfQsNC/0YDQvtGBINGH0LXRgNC10Lcg0L/RgNC+0LrRgdC4IGNvcnMtYW55d2hlcmVcbiAgICAgICAgICAgIHgub3BlbignR0VUJywgJ2h0dHBzOi8vY29ycy1hbnl3aGVyZS5oZXJva3VhcHAuY29tL2h0dHBzOi8vYWtzb24ucnUvcGVyc29uYWwvb3JkZXIvdGFibGUxLz9TVE9SRV9JRD0xMScpO1xuICAgICAgICAgICAgLy94Lm9wZW4oJ0dFVCcsICdwejQuaHRtbCcpO1xuXG4gICAgICAgICAgICAvL3gudGltZW91dCA9IDUwMDA7XG4gICAgICAgICAgICB4LnNlbmQoKTtcbiAgICAgICAgICAgIHgub25sb2FkID0gKCkgPT4ge1xuICAgICAgICAgICAgICAgIGlmICh4LnN0YXR1cyAhPSAyMDApIHtcbiAgICAgICAgICAgICAgICAgICAgcmVqZWN0KHguc3RhdHVzVGV4dClcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICByZXNvbHZlKHgucmVzcG9uc2VUZXh0IHx8ICcnKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9O1xuICAgICAgICB9KVxuICAgIH0sXG4gICAgLy9cbiAgICBnZXRDb250ZW50KGV4dGVybmFsQ29udGVudCkge1xuICAgICAgICAvL9Cy0YvRgtCw0YHQutC40LLQsNC10Lwg0YLQsNCx0LvQuNGG0YMg0LjQtyDQuNGB0YXQvtC00L3QvtCz0L4g0LrQvtC00LBcbiAgICAgICAgY29uc3QgY3V0RXh0ZXJuYWxDb250ZW50ID0gZXh0ZXJuYWxDb250ZW50LnN1YnN0cigzMTk2LCBleHRlcm5hbENvbnRlbnQubGVuZ3RoIC0gMzM3MCk7XG4gICAgICAgIC8vY29uc29sZS5sb2coY3V0RXh0ZXJuYWxDb250ZW50KTtcbiAgICAgICAgY29uc3QgaGlkZGVuVGFibGUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuaGlkZGVuLXRhYmxlJyk7XG4gICAgICAgIGhpZGRlblRhYmxlLmlubmVySFRNTCA9IGN1dEV4dGVybmFsQ29udGVudDtcbiAgICAgICAgLy/QstGL0YLQsNGB0LrQuNCy0LDQtdC8INGB0YLRgNC+0LrQuFxuICAgICAgICBjb25zdCByb3dzID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ3RyJyk7XG4gICAgICAgIC8v0L/QtdGA0LXQvNC10L3QvdCw0Y8g0LTQu9GPINGB0YLRgNC+0Log0YTQuNC70YzRgtGA0L7QstCw0L3QvdC+0Lkg0YLQsNCx0LvQuNGG0YtcbiAgICAgICAgbGV0IGZpbHRlcmVkUm93cyA9IFtdO1xuXG4gICAgICAgIC8v0YPQtNCw0LvRj9C10Lwg0YHRgtGA0L7QutC4INC30LDQs9C+0LvQvtCy0LrQvtCyINGC0LDQsdC70LjRhiwg0YPQtNCw0LvRj9C10Lwg0L7RgtC80LXQvdC10L3QvdGL0LUg0LfQsNC60LDQt9GLLCDRhNC+0YDQvNC40YDRg9C10Lwg0L7QtNC90YMg0YLQsNCx0LvQuNGG0YMg0LjQtyDQtNCy0YPRhVxuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHJvd3MubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIGlmIChyb3dzW2ldLmlubmVySFRNTC5sZW5ndGggIT09IDM3Nykge1xuICAgICAgICAgICAgICAgIGlmIChyb3dzW2ldLmNoaWxkcmVuWzNdLmlubmVySFRNTC5sZW5ndGggPiAxMDApIHtcbiAgICAgICAgICAgICAgICAgICAgcm93c1tpXS5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKHJvd3NbaV0pO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGZpbHRlcmVkUm93cy5wdXNoKHJvd3NbaV0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICAvL9GD0LTQsNC70Y/QtdC8INGH0LXRgtCy0LXRgNGC0YPRjiDRj9GH0LXQudC60YNcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBmaWx0ZXJlZFJvd3MubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIGZpbHRlcmVkUm93c1tpXS5yZW1vdmVDaGlsZChmaWx0ZXJlZFJvd3NbaV0uY2hpbGRyZW5bM10pO1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgbmV3Q29udGVudE9iamVjdCA9IG5ldyBtYWluT2JqZWN0Q2xhc3MoKTtcbiAgICAgICAgZmlsdGVyZWRSb3dzLmZvckVhY2goKGl0ZW0pID0+IHtcbiAgICAgICAgICAgIGNvbnN0IG9yZGVyTnVtYmVyID0gcGFyc2VJbnQoaXRlbS5jaGlsZHJlblswXS5jaGlsZHJlblswXS5jaGlsZHJlblswXS5pbm5lckhUTUwpO1xuICAgICAgICAgICAgY29uc3Qgb3JkZXIgPSBuZXcgb3JkZXJDbGFzcyhvcmRlck51bWJlcik7XG4gICAgICAgICAgICAvL2NvbnNvbGUubG9nKGl0ZW0uY2hpbGRyZW5bMV0uY2hpbGRyZW5bMF0uaW5uZXJIVE1MLmxlbmd0aCk7XG4gICAgICAgICAgICBpZiAoaXRlbS5jaGlsZHJlblsxXS5jaGlsZHJlblswXS5pbm5lckhUTUwubGVuZ3RoID4gMzApIHtcbiAgICAgICAgICAgICAgICBvcmRlci5zZXRRdWV1ZSgpO1xuICAgICAgICAgICAgfSBlbHNlIGlmIChpdGVtLmNoaWxkcmVuWzJdLmNoaWxkcmVuWzBdLmlubmVySFRNTC5sZW5ndGggPiAzMCkge1xuICAgICAgICAgICAgICAgIG9yZGVyLnNldFByZXBhcmluZygpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgbmV3Q29udGVudE9iamVjdC5vcmRlcnMucHVzaChvcmRlcik7XG4gICAgICAgIH0pXG5cbiAgICAgICAgLy/Rg9C00LDQu9GP0LXQvCDRgtCw0LHQu9C40YbRg1xuICAgICAgICBoaWRkZW5UYWJsZS5pbm5lckhUTUwgPSAnJztcblxuICAgICAgICBpZiAoIWlzTWFpbk9iamVjdEV4aXN0cygpKSB7XG4gICAgICAgICAgICBzZXRNYWluT2JqZWN0KG5ld0NvbnRlbnRPYmplY3QpO1xuICAgICAgICAgICAgdGhpcy5nZXRDb250ZW50KGV4dGVybmFsQ29udGVudCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBjb25zdCBub3RGb3JtYXR0ZWRtYWluT2JqZWN0ID0gZ2V0TWFpbk9iamVjdCgpO1xuICAgICAgICAgICAgY29uc3QgbWFpbk9iamVjdCA9IG5ldyBtYWluT2JqZWN0Q2xhc3MoKTtcblxuICAgICAgICAgICAgbWFpbk9iamVjdC5yZXF1ZXN0SW50ZXJ2YWwgPSBub3RGb3JtYXR0ZWRtYWluT2JqZWN0LnJlcXVlc3RJbnRlcnZhbDtcbiAgICAgICAgICAgIG1haW5PYmplY3QubWVzc2FnZVRpbWUgPSBub3RGb3JtYXR0ZWRtYWluT2JqZWN0Lm1lc3NhZ2VUaW1lO1xuICAgICAgICAgICAgbWFpbk9iamVjdC5leHBpcmF0aW9uVGltZSA9IG5vdEZvcm1hdHRlZG1haW5PYmplY3QuZXhwaXJhdGlvblRpbWU7XG5cbiAgICAgICAgICAgIG5vdEZvcm1hdHRlZG1haW5PYmplY3Qub3JkZXJzLmZvckVhY2goKGl0ZW0pID0+IHtcbiAgICAgICAgICAgICAgICBsZXQgY3VycmVudE9yZGVyID0gbmV3IG9yZGVyQ2xhc3MoaXRlbS5vcmRlck51bWJlcik7XG4gICAgICAgICAgICAgICAgY3VycmVudE9yZGVyLmV4cGlyZWQgPSBpdGVtLmV4cGlyZWQ7XG4gICAgICAgICAgICAgICAgY3VycmVudE9yZGVyLm1lc3NhZ2VTZW50ID0gaXRlbS5tZXNzYWdlU2VudDtcbiAgICAgICAgICAgICAgICBjdXJyZW50T3JkZXIuY29tcGxldGUgPSBpdGVtLmNvbXBsZXRlO1xuICAgICAgICAgICAgICAgIGN1cnJlbnRPcmRlci5jb21wbGV0ZVRpbWUgPSBpdGVtLmNvbXBsZXRlVGltZTtcbiAgICAgICAgICAgICAgICBjdXJyZW50T3JkZXIuaW5RdWV1ZSA9IGl0ZW0uaW5RdWV1ZTtcbiAgICAgICAgICAgICAgICBjdXJyZW50T3JkZXIucHJlcGFyaW5nID0gaXRlbS5wcmVwYXJpbmc7XG4gICAgICAgICAgICAgICAgY3VycmVudE9yZGVyLnJlbWFkZSA9IGl0ZW0ucmVtYWRlO1xuICAgICAgICAgICAgICAgIGN1cnJlbnRPcmRlci51bml4VGltZSA9IGl0ZW0udW5peFRpbWU7XG4gICAgICAgICAgICAgICAgY3VycmVudE9yZGVyLmRhdGUgPSBpdGVtLmRhdGU7XG4gICAgICAgICAgICAgICAgY3VycmVudE9yZGVyLm5lZWRNZXNzYWdlID0gaXRlbS5uZWVkTWVzc2FnZTtcbiAgICAgICAgICAgICAgICBtYWluT2JqZWN0Lm9yZGVycy5wdXNoKGN1cnJlbnRPcmRlcik7XG4gICAgICAgICAgICB9KVxuXG5cbiAgICAgICAgICAgIC8vINCU0L7QsdCw0LLQu9GP0LXQvCDQvdC+0LLRi9C1INC30LDQutCw0LfRi1xuICAgICAgICAgICAgbmV3Q29udGVudE9iamVjdC5vcmRlcnMuZm9yRWFjaCgoaXRlbSwgaSkgPT4ge1xuICAgICAgICAgICAgICAgIGlmICghaXNtYWluT2JqZWN0Q29udGFpbnNPcmRlcihtYWluT2JqZWN0LCBpdGVtLm9yZGVyTnVtYmVyKSkge1xuICAgICAgICAgICAgICAgICAgICBtYWluT2JqZWN0Lm9yZGVycy5wdXNoKG5ld0NvbnRlbnRPYmplY3Qub3JkZXJzW2ldKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLy/QtdGB0LvQuCDRgdGC0LDRgNC+0LPQviDQt9Cw0LrQsNC30LAg0L3QtdGCINCyINGB0L/QuNGB0LrQtSDQt9Cw0LrQsNC30L7QsiDQvdC+0LLQvtCz0L4g0L7QsdGK0LXQutGC0LAsINC/0L7QvNC10YfQsNC10Lwg0YHRgtCw0YDRi9C5INC/0L7QtNGC0LLQtdGA0LbQtNC10L3QvdGL0LxcbiAgICAgICAgICAgIG1haW5PYmplY3Qub3JkZXJzLmZvckVhY2goKGl0ZW0pID0+IHtcbiAgICAgICAgICAgICAgICBpZiAoIWdldFNhbWVPcmRlcihuZXdDb250ZW50T2JqZWN0LCBpdGVtLm9yZGVyTnVtYmVyKSkge1xuICAgICAgICAgICAgICAgICAgICBpdGVtLnNldENvbXBsZXRlKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC8v0L/QvtC70YPRh9Cw0LXQvCDQv9C10YDQtdCy0YvQs9GA0YPQttC10L3QvdGL0LUg0LfQsNC60LDQt9GLXG4gICAgICAgICAgICBuZXdDb250ZW50T2JqZWN0Lm9yZGVycy5mb3JFYWNoKChpdGVtKSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKGlzT3JkZXJSZW1hZGUobWFpbk9iamVjdCwgaXRlbS5vcmRlck51bWJlcikpIHtcbiAgICAgICAgICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBtYWluT2JqZWN0Lm9yZGVycy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG1haW5PYmplY3Qub3JkZXJzW2ldLm9yZGVyTnVtYmVyID09PSBpdGVtLm9yZGVyTnVtYmVyKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbWFpbk9iamVjdC5vcmRlcnNbaV0ucmVtYWRlID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtYWluT2JqZWN0Lm9yZGVyc1tpXS5leHBpcmVkID0gaXRlbS5leHBpcmVkO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1haW5PYmplY3Qub3JkZXJzW2ldLm1lc3NhZ2VTZW50ID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbWFpbk9iamVjdC5vcmRlcnNbaV0udW5peFRpbWUgPSBwYXJzZUludChuZXcgRGF0ZSgpLmdldFRpbWUoKSAvIDEwMDApO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1haW5PYmplY3Qub3JkZXJzW2ldLmNvbXBsZXRlID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbWFpbk9iamVjdC5vcmRlcnNbaV0uY29tcGxldGVUaW1lID0gMDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtYWluT2JqZWN0Lm9yZGVyc1tpXS5pblF1ZXVlID0gaXRlbS5pblF1ZXVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1haW5PYmplY3Qub3JkZXJzW2ldLnByZXBhcmluZyA9IGl0ZW0ucHJlcGFyaW5nO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1haW5PYmplY3Qub3JkZXJzW2ldLmRhdGUgPSBpdGVtLmRhdGU7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbWFpbk9iamVjdC5vcmRlcnNbaV0ubmVlZE1lc3NhZ2UgPSBpdGVtLm5lZWRNZXNzYWdlO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSlcblxuICAgICAgICAgICAgLy/Qt9Cw0LTQsNC10Lwg0LLRgNC10LzRjyDQvdCw0LHQvtGA0LrQuFxuICAgICAgICAgICAgbWFpbk9iamVjdC5vcmRlcnMuZm9yRWFjaCgoaXRlbSkgPT4ge1xuICAgICAgICAgICAgICAgIGlmIChpdGVtLmNvbXBsZXRlID09PSBmYWxzZSkge1xuICAgICAgICAgICAgICAgICAgICBpdGVtLnNldFRpbWUocGFyc2VJbnQobmV3IERhdGUoKS5nZXRUaW1lKCkgLyAxMDAwKSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSlcblxuICAgICAgICAgICAgLy/Qv9GA0L7QstC10YDRj9C10Lwg0L3QsCDQv9GA0L7RgdGA0L7Rh9C60YNcblxuICAgICAgICAgICAgbWFpbk9iamVjdC5vcmRlcnMuZm9yRWFjaCgoaXRlbSkgPT4ge1xuICAgICAgICAgICAgICAgIGlmIChpdGVtLmNvbXBsZXRlVGltZSA+IG1haW5PYmplY3QuZXhwaXJhdGlvblRpbWUpIHtcbiAgICAgICAgICAgICAgICAgICAgaXRlbS5zZXRFeHBpcmVkKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSlcblxuICAgICAgICAgICAgLy/Rg9C00LDQu9GP0LXQvCDQt9Cw0LrQsNC30Ysg0LLQvtC30YDQsNGB0YLQvtC8INCx0L7Qu9C10LUgMTAg0LTQvdC10LlcbiAgICAgICAgICAgIGZvciAobGV0IGkgPSBtYWluT2JqZWN0Lm9yZGVycy5sZW5ndGggLSAxOyBpID49IDA7IGktLSkge1xuICAgICAgICAgICAgICAgIGlmIChwYXJzZUludChuZXcgRGF0ZSgpLmdldFRpbWUoKSAvIDEwMDApIC0gbWFpbk9iamVjdC5vcmRlcnNbaV0udW5peFRpbWUgPiA4NjQwMDApIHtcbiAgICAgICAgICAgICAgICAgICAgbWFpbk9iamVjdC5vcmRlcnMuc3BsaWNlKGksIDEpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgc2V0TWFpbk9iamVjdChtYWluT2JqZWN0KTtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBzZXRXYXJuaW5nKCkge1xuICAgICAgICBjb25zdCBtYWluT2JqZWN0ID0gZ2V0TWFpbk9iamVjdCgpO1xuICAgICAgICBjb25zb2xlLmxvZyhtYWluT2JqZWN0KTtcbiAgICAgICAgbWFpbk9iamVjdC5vcmRlcnMuZm9yRWFjaCgoaXRlbSkgPT4ge1xuICAgICAgICAgICAgaWYgKHBhcnNlSW50KG5ldyBEYXRlKCkuZ2V0VGltZSgpIC8gMTAwMCkgLSBpdGVtLnVuaXhUaW1lID4gbWFpbk9iamVjdC5tZXNzYWdlVGltZSAmJiAhaXRlbS5jb21wbGV0ZSAmJiAhaXRlbS5tZXNzYWdlU2VudCkge1xuICAgICAgICAgICAgICAgIGl0ZW0ubmVlZE1lc3NhZ2UgPSB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KVxuICAgICAgICBzZXRNYWluT2JqZWN0KG1haW5PYmplY3QpO1xuICAgIH1cblxuXG59IiwidmlldyA9IHtcbiAgICBkcmF3VGFibGUoKSB7XG4gICAgICAgIGNvbnN0IG1haW5PYmplY3QgPSBnZXRNYWluT2JqZWN0KCk7XG4gICAgICAgIGNvbnN0IG5ld1RhYmxlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLm5ldy10YWJsZScpO1xuICAgICAgICBuZXdUYWJsZS5pbm5lckhUTUwgPSAnJztcbiAgICAgICAgLy8gY29uc3QgdGFibGVIZWFkZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0cicpO1xuICAgICAgICAvLyB0YWJsZUhlYWRlci5jbGFzc0xpc3QuYWRkKCduZXctdGFibGVfX2hlYWRlcicpO1xuICAgICAgICAvLyBuZXdUYWJsZS5hcHBlbmRDaGlsZCh0YWJsZUhlYWRlcik7XG4gICAgICAgIC8vIGNvbnN0IHRhYmxlSGVhZGVyQ2VsbE51bWJlciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RoJyk7XG4gICAgICAgIC8vIHRhYmxlSGVhZGVyQ2VsbE51bWJlci5jbGFzc0xpc3QuYWRkKCduZXctdGFibGVfX2hlYWRlci1jZWxsJyk7XG4gICAgICAgIC8vIHRhYmxlSGVhZGVyQ2VsbE51bWJlci50ZXh0Q29udGVudD0gJ+KElic7XG4gICAgICAgIC8vIHRhYmxlSGVhZGVyLmFwcGVuZENoaWxkKHRhYmxlSGVhZGVyQ2VsbE51bWJlcik7XG4gICAgICAgIC8vIGNvbnN0IHRhYmxlSGVhZGVyQ2VsbE9yZGVyTnVtYmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndGgnKTtcbiAgICAgICAgLy8gdGFibGVIZWFkZXJDZWxsT3JkZXJOdW1iZXIuY2xhc3NMaXN0LmFkZCgnbmV3LXRhYmxlX19oZWFkZXItY2VsbCcpO1xuICAgICAgICAvLyB0YWJsZUhlYWRlckNlbGxPcmRlck51bWJlci50ZXh0Q29udGVudCA9ICfihJYg0LfQsNC60LDQt9CwJztcbiAgICAgICAgLy8gdGFibGVIZWFkZXIuYXBwZW5kQ2hpbGQodGFibGVIZWFkZXJDZWxsT3JkZXJOdW1iZXIpO1xuICAgICAgICAvLyBjb25zdCB0YWJsZUhlYWRlck9yZGVySW5RdWV1ZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RoJyk7XG4gICAgICAgIC8vIHRhYmxlSGVhZGVyT3JkZXJJblF1ZXVlLmNsYXNzTGlzdC5hZGQoJ25ldy10YWJsZV9faGVhZGVyLWNlbGwnKTtcbiAgICAgICAgLy8gdGFibGVIZWFkZXJPcmRlckluUXVldWUudGV4dENvbnRlbnQ9J9CSINC+0YfQtdGA0LXQtNC4JztcbiAgICAgICAgLy8gdGFibGVIZWFkZXIuYXBwZW5kQ2hpbGQodGFibGVIZWFkZXJPcmRlckluUXVldWUpO1xuICAgICAgICAvLyBjb25zdCB0YWJsZUhlYWRlck9yZGVySXNQcmVwYXJpbmcgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0cicpO1xuICAgICAgICAvLyB0YWJsZUhlYWRlck9yZGVySXNQcmVwYXJpbmcuY2xhc3NMaXN0LmFkZCgnbmV3LXRhYmxlX19oZWFkZXItY2VsbCcpO1xuICAgICAgICAvLyB0YWJsZUhlYWRlck9yZGVySXNQcmVwYXJpbmcudGV4dENvbnRlbnQgPSAn0JIg0L3QsNCx0L7RgNC1JztcbiAgICAgICAgLy8gdGFibGVIZWFkZXIuYXBwZW5kQ2hpbGQodGFibGVIZWFkZXJPcmRlcklzUHJlcGFyaW5nKTtcbiAgICAgICAgLy8gY29uc3QgdGFibGVIZWFkZXJUaW1lID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndHInKTtcbiAgICAgICAgLy8gdGFibGVIZWFkZXJUaW1lLmNsYXNzTGlzdC5hZGQoJ25ldy10YWJsZV9faGVhZGVyLWNlbGwnKTtcbiAgICAgICAgLy8gdGFibGVIZWFkZXJUaW1lLnRleHRDb250ZW50ID0gJ9CS0YDQtdC80Y8g0L3QsNCx0L7RgNCwJztcbiAgICAgICAgLy8gdGFibGVIZWFkZXIuYXBwZW5kQ2hpbGQodGFibGVIZWFkZXJUaW1lKTtcblxuXG4gICAgICAgIG5ld1RhYmxlLmluc2VydEFkamFjZW50SFRNTCgnYmVmb3JlZW5kJywgJycgK1xuICAgICAgICAgICAgJyAgICAgICAgICAgICAgICAgPHRoZWFkPicgK1xuICAgICAgICAgICAgJyAgICAgICAgICAgICAgICAgICAgPHRyIGNsYXNzPVwibmV3LXRhYmxlX19oZWFkZXJcIj5cXG4nICtcbiAgICAgICAgICAgICcgICAgICAgICAgICAgICAgICAgICAgICA8dGggY2xhc3M9XCJuZXctdGFibGVfX2hlYWRlci1jZWxsXCI+4oSWPC90aD5cXG4nICtcbiAgICAgICAgICAgICcgICAgICAgICAgICAgICAgICAgICAgICA8dGggY2xhc3M9XCJuZXctdGFibGVfX2hlYWRlci1jZWxsXCI+0J3QvtC80LXRgCDQt9Cw0LrQsNC30LA8L3RoPlxcbicgK1xuICAgICAgICAgICAgJyAgICAgICAgICAgICAgICAgICAgICAgIDx0aCBjbGFzcz1cIm5ldy10YWJsZV9faGVhZGVyLWNlbGxcIj7QkiDQvtGH0LXRgNC10LTQuDwvdGg+XFxuJyArXG4gICAgICAgICAgICAnICAgICAgICAgICAgICAgICAgICAgICAgPHRoIGNsYXNzPVwibmV3LXRhYmxlX19oZWFkZXItY2VsbFwiPtCSINC90LDQsdC+0YDQtTwvdGg+XFxuJyArXG4gICAgICAgICAgICAnICAgICAgICAgICAgICAgICAgICAgICAgPHRoIGNsYXNzPVwibmV3LXRhYmxlX19oZWFkZXItY2VsbFwiPtCX0LDQstC10YDRiNC10L08L3RoPlxcbicgK1xuICAgICAgICAgICAgJyAgICAgICAgICAgICAgICAgICAgICAgIDx0aCBjbGFzcz1cIm5ldy10YWJsZV9faGVhZGVyLWNlbGxcIj7QktGA0LXQvNGPPC90aD5cXG4nICtcbiAgICAgICAgICAgICcgICAgICAgICAgICAgICAgICAgIDwvdHI+JyArXG4gICAgICAgICAgICAnICAgICAgICAgICAgICAgICA8L3RoZWFkPicpO1xuXG4gICAgICAgIGxldCBjb3VudGVyID0gMTtcbiAgICAgICAgbWFpbk9iamVjdC5vcmRlcnMuZm9yRWFjaCgoaXRlbSkgPT4ge1xuXG4gICAgICAgICAgICBsZXQgaW5RdWV1ZSA9ICcnO1xuICAgICAgICAgICAgaWYgKGl0ZW0uaW5RdWV1ZSA9PT0gdHJ1ZSkge1xuICAgICAgICAgICAgICAgIGluUXVldWUgPSAnWCc7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBsZXQgcHJlcGFyaW5nID0gJyc7XG4gICAgICAgICAgICBpZiAoaXRlbS5wcmVwYXJpbmcgPT09IHRydWUpIHtcbiAgICAgICAgICAgICAgICBwcmVwYXJpbmcgPSAnWCc7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBsZXQgY29tcGxldGUgPSAnJztcbiAgICAgICAgICAgIGlmIChpdGVtLmNvbXBsZXRlID09PSB0cnVlKSB7XG4gICAgICAgICAgICAgICAgY29tcGxldGUgPSAnWCc7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBsZXQgdGltZSA9IHNlY29uZHNUaW1lVG9Ob3JtYWwoaXRlbS5jb21wbGV0ZVRpbWUpO1xuICAgICAgICAgICAgaWYgKGl0ZW0uZGF0ZSA9PT0gcGFyc2VJbnQobmV3IERhdGUoKS5nZXREYXRlKCkpICYmIGl0ZW0ucmVtYWRlICYmICFpdGVtLm1lc3NhZ2VTZW50KSB7XG4gICAgICAgICAgICAgICAgbmV3VGFibGUuaW5zZXJ0QWRqYWNlbnRIVE1MKCdiZWZvcmVlbmQnLCBgXG4gICAgICAgICAgICAgICAgICAgIDx0Ym9keT5cbiAgICAgICAgICAgICAgICAgICAgICAgIDx0ciBjbGFzcz1cIm5ldy10YWJsZV9fcm93IG5ldy10YWJsZV9fb3JkZXItcmVtYWRlXCI+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgPHRkIGNsYXNzPVwibmV3LXRhYmxlX19jZWxsXCI+JHtjb3VudGVyfTwvdGQ+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgPHRkIGNsYXNzPVwibmV3LXRhYmxlX19jZWxsXCI+JHtpdGVtLm9yZGVyTnVtYmVyfTwvdGQ+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgPHRkIGNsYXNzPVwibmV3LXRhYmxlX19jZWxsXCI+JHtpblF1ZXVlfTwvdGQ+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgPHRkIGNsYXNzPVwibmV3LXRhYmxlX19jZWxsXCI+JHtwcmVwYXJpbmd9PC90ZD5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8dGQgY2xhc3M9XCJuZXctdGFibGVfX2NlbGxcIj4ke2NvbXBsZXRlfTwvdGQ+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgPHRkIGNsYXNzPVwibmV3LXRhYmxlX19jZWxsXCI+JHt0aW1lfTwvdGQ+XG4gICAgICAgICAgICAgICAgICAgICAgICA8L3RyPlxuICAgICAgICAgICAgICAgICAgICA8L3Rib2R5PmBcbiAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICB9IGVsc2UgaWYgKGl0ZW0uZGF0ZSA9PT0gcGFyc2VJbnQobmV3IERhdGUoKS5nZXREYXRlKCkpICYmICFpdGVtLmV4cGlyZWQgJiYgIWl0ZW0ubWVzc2FnZVNlbnQpIHtcbiAgICAgICAgICAgICAgICBuZXdUYWJsZS5pbnNlcnRBZGphY2VudEhUTUwoJ2JlZm9yZWVuZCcsIGBcbiAgICAgICAgICAgICAgICAgICAgPHRib2R5PlxuICAgICAgICAgICAgICAgICAgICAgICAgPHRyIGNsYXNzPVwibmV3LXRhYmxlX19yb3cgbmV3LXRhYmxlX19vcmRlci1ub3JtYWxcIj5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8dGQgY2xhc3M9XCJuZXctdGFibGVfX2NlbGxcIj4ke2NvdW50ZXJ9PC90ZD5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8dGQgY2xhc3M9XCJuZXctdGFibGVfX2NlbGxcIj4ke2l0ZW0ub3JkZXJOdW1iZXJ9PC90ZD5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8dGQgY2xhc3M9XCJuZXctdGFibGVfX2NlbGxcIj4ke2luUXVldWV9PC90ZD5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8dGQgY2xhc3M9XCJuZXctdGFibGVfX2NlbGxcIj4ke3ByZXBhcmluZ308L3RkPlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDx0ZCBjbGFzcz1cIm5ldy10YWJsZV9fY2VsbFwiPiR7Y29tcGxldGV9PC90ZD5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8dGQgY2xhc3M9XCJuZXctdGFibGVfX2NlbGxcIj4ke3RpbWV9PC90ZD5cbiAgICAgICAgICAgICAgICAgICAgICAgIDwvdHI+XG4gICAgICAgICAgICAgICAgICAgIDwvdGJvZHk+YFxuICAgICAgICAgICAgICAgIClcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoaXRlbS5kYXRlID09PSBwYXJzZUludChuZXcgRGF0ZSgpLmdldERhdGUoKSkgJiYgIWl0ZW0uZXhwaXJlZCAmJiBpdGVtLm1lc3NhZ2VTZW50KSB7XG4gICAgICAgICAgICAgICAgbmV3VGFibGUuaW5zZXJ0QWRqYWNlbnRIVE1MKCdiZWZvcmVlbmQnLCBgXG4gICAgICAgICAgICAgICAgICAgIDx0Ym9keT5cbiAgICAgICAgICAgICAgICAgICAgICAgIDx0ciBjbGFzcz1cIm5ldy10YWJsZV9fcm93IG5ldy10YWJsZV9fb3JkZXItd2FybmluZ1wiPlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDx0ZCBjbGFzcz1cIm5ldy10YWJsZV9fY2VsbFwiPiR7Y291bnRlcn08L3RkPlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDx0ZCBjbGFzcz1cIm5ldy10YWJsZV9fY2VsbFwiPiR7aXRlbS5vcmRlck51bWJlcn08L3RkPlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDx0ZCBjbGFzcz1cIm5ldy10YWJsZV9fY2VsbFwiPiR7aW5RdWV1ZX08L3RkPlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDx0ZCBjbGFzcz1cIm5ldy10YWJsZV9fY2VsbFwiPiR7cHJlcGFyaW5nfTwvdGQ+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgPHRkIGNsYXNzPVwibmV3LXRhYmxlX19jZWxsXCI+JHtjb21wbGV0ZX08L3RkPlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDx0ZCBjbGFzcz1cIm5ldy10YWJsZV9fY2VsbFwiPiR7dGltZX08L3RkPlxuICAgICAgICAgICAgICAgICAgICAgICAgPC90cj5cbiAgICAgICAgICAgICAgICAgICAgPC90Ym9keT5gXG4gICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgfSBlbHNlIGlmIChpdGVtLmRhdGUgPT09IHBhcnNlSW50KG5ldyBEYXRlKCkuZ2V0RGF0ZSgpKSAmJiBpdGVtLmV4cGlyZWQgJiYgaXRlbS5tZXNzYWdlU2VudCkge1xuICAgICAgICAgICAgICAgIG5ld1RhYmxlLmluc2VydEFkamFjZW50SFRNTCgnYmVmb3JlZW5kJywgYFxuICAgICAgICAgICAgICAgICAgICA8dGJvZHk+XG4gICAgICAgICAgICAgICAgICAgICAgICA8dHIgY2xhc3M9XCJuZXctdGFibGVfX3JvdyBuZXctdGFibGVfX29yZGVyLWV4cGlyZWRcIj5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8dGQgY2xhc3M9XCJuZXctdGFibGVfX2NlbGxcIj4ke2NvdW50ZXJ9PC90ZD5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8dGQgY2xhc3M9XCJuZXctdGFibGVfX2NlbGxcIj4ke2l0ZW0ub3JkZXJOdW1iZXJ9PC90ZD5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8dGQgY2xhc3M9XCJuZXctdGFibGVfX2NlbGxcIj4ke2luUXVldWV9PC90ZD5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8dGQgY2xhc3M9XCJuZXctdGFibGVfX2NlbGxcIj4ke3ByZXBhcmluZ308L3RkPlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDx0ZCBjbGFzcz1cIm5ldy10YWJsZV9fY2VsbFwiPiR7Y29tcGxldGV9PC90ZD5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8dGQgY2xhc3M9XCJuZXctdGFibGVfX2NlbGxcIj4ke3RpbWV9PC90ZD5cbiAgICAgICAgICAgICAgICAgICAgICAgIDwvdHI+XG4gICAgICAgICAgICAgICAgICAgIDwvdGJvZHk+YFxuICAgICAgICAgICAgICAgIClcblxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY291bnRlcisrO1xuICAgICAgICB9KVxuXG4gICAgfSxcblxuICAgIHNlbmRNZXNzYWdlKG1lc3NhZ2UpIHtcbiAgICAgICAgY29uc3QgeCA9IG5ldyBYTUxIdHRwUmVxdWVzdCgpO1xuICAgICAgICB4Lm9wZW4oJ0dFVCcsICdodHRwczovL2FwaS50ZWxlZ3JhbS5vcmcvYm90MTAxODc1NzAxMzpBQUVITzlhY2NVaHNjaWVUMEFyUnE5aXdVZWF0NkJtRXpPTS9zZW5kTWVzc2FnZT9jaGF0X2lkPS0xMDAxNDcxNjc3NjE0JnRleHQ9JyArIG1lc3NhZ2UpO1xuICAgICAgICB4LnNlbmQoKTtcblxuXG4gICAgfSxcblxuICAgIHNlbmRNZXNzYWdlcygpIHtcbiAgICAgICAgY29uc3QgbWFpbk9iamVjdCA9IGdldE1haW5PYmplY3QoKTtcbiAgICAgICAgbWFpbk9iamVjdC5vcmRlcnMuZm9yRWFjaCgoaXRlbSkgPT4ge1xuICAgICAgICAgICAgaWYgKGl0ZW0ubmVlZE1lc3NhZ2UgPT09IHRydWUpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnNlbmRNZXNzYWdlKCfQl9Cw0LrQsNC3ICcgKyBpdGVtLm9yZGVyTnVtYmVyICsgJyDQsiDQvdCw0LHQvtGA0LUg0YPQttC1INCx0L7Qu9C10LUgJyArIG1haW5PYmplY3QuZXhwaXJhdGlvblRpbWUgLyA2MCArICcg0LzQuNC90YPRgicpO1xuICAgICAgICAgICAgICAgIC8vY29uc29sZS5sb2coJ9CX0LDQutCw0LcgJyArIGl0ZW0ub3JkZXJOdW1iZXIgKyAnINCyINC90LDQsdC+0YDQtSDRg9C20LUg0LHQvtC70LXQtSAnICsgbWFpbk9iamVjdC5leHBpcmF0aW9uVGltZSAvIDYwICsgJyDQvNC40L3Rg9GCJylcbiAgICAgICAgICAgICAgICBpdGVtLm1lc3NhZ2VTZW50ID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICBpdGVtLm5lZWRNZXNzYWdlID0gZmFsc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pXG4gICAgICAgIHNldE1haW5PYmplY3QobWFpbk9iamVjdCk7XG4gICAgfSxcblxuICAgIHNldFBsYWNlaG9sZGVycygpIHtcbiAgICAgICAgY29uc3QgbWFpbk9iamVjdCA9IGdldE1haW5PYmplY3QoKTtcbiAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLm9wdGlvbnNfX3RpbWUtdG8tZXhwaXJlJykucGxhY2Vob2xkZXIgPSBtYWluT2JqZWN0LmV4cGlyYXRpb25UaW1lIC8gNjA7XG4gICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5vcHRpb25zX190aW1lLXRvLXNlbmQtbWVzc2FnZScpLnBsYWNlaG9sZGVyID0gbWFpbk9iamVjdC5tZXNzYWdlVGltZSAvIDYwO1xuICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcub3B0aW9uc19fcmVxdWVzdC1pbnRlcnZhbCcpLnBsYWNlaG9sZGVyID0gbWFpbk9iamVjdC5yZXF1ZXN0SW50ZXJ2YWw7XG4gICAgfVxufSIsIiIsImRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJET01Db250ZW50TG9hZGVkXCIsICgpID0+IHtcbiAgICBsZXQgaW50ZXJ2YWwgPSAxMDtcbiAgICBpZiAoaXNNYWluT2JqZWN0RXhpc3RzKCkpIHtcbiAgICAgICAgY29uc3QgbWFpbk9iamVjdCA9IGdldE1haW5PYmplY3QoKTtcbiAgICAgICAgaW50ZXJ2YWwgPSBtYWluT2JqZWN0LnJlcXVlc3RJbnRlcnZhbDtcbiAgICB9XG5cbiAgICBtb2RlbC5jYWxsRXh0ZXJuYWxDb250ZW50KClcbiAgICAgICAgLnRoZW4oKHJlc3BvbnNlKSA9PiB7XG4gICAgICAgICAgICBtb2RlbC5nZXRDb250ZW50KHJlc3BvbnNlKTtcbiAgICAgICAgICAgIG1vZGVsLnNldFdhcm5pbmcoKTtcbiAgICAgICAgICAgIHZpZXcuc2VuZE1lc3NhZ2VzKCk7XG4gICAgICAgICAgICB2aWV3LmRyYXdUYWJsZSgpO1xuICAgICAgICAgICAgdmlldy5zZXRQbGFjZWhvbGRlcnMoKTtcbiAgICAgICAgfSlcblxuICAgIHdpbmRvdy5zZXRJbnRlcnZhbCgoKSA9PiB7XG4gICAgICAgIG1vZGVsLmNhbGxFeHRlcm5hbENvbnRlbnQoKVxuICAgICAgICAgICAgLnRoZW4oKHJlc3BvbnNlKSA9PiB7XG4gICAgICAgICAgICAgICAgbW9kZWwuZ2V0Q29udGVudChyZXNwb25zZSk7XG4gICAgICAgICAgICAgICAgbW9kZWwuc2V0V2FybmluZygpO1xuICAgICAgICAgICAgICAgIHZpZXcuc2VuZE1lc3NhZ2VzKCk7XG4gICAgICAgICAgICAgICAgdmlldy5kcmF3VGFibGUoKTtcbiAgICAgICAgICAgICAgICB2aWV3LnNldFBsYWNlaG9sZGVycygpO1xuICAgICAgICAgICAgfSlcbiAgICB9LCBpbnRlcnZhbCAqIDEwMDApO1xuXG59KVxuIiwiLy/Rg9GB0YLQsNC90LDQstC70LjQstCw0LXQvCDQuNC90YLQtdGA0LLQsNC7LCDQstGA0LXQvNGPINGB0L7QvtCx0YnQtdC90LjRjywg0LLRgNC10LzRjyDQtNC+INC/0YDQvtGB0YDQvtGH0LrQuFxuZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLm9wdGlvbnNfX3RpbWUtdG8tZXhwaXJlLWJ1dHRvbicpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGUpID0+IHtcbiAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgY29uc3QgZXhwaXJlVGV4dEFyZWEgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcub3B0aW9uc19fdGltZS10by1leHBpcmUnKTtcbiAgICBpZiAoZXhwaXJlVGV4dEFyZWEudmFsdWUpIHtcbiAgICAgICAgY29uc3QgbWFpbk9iamVjdCA9IGdldE1haW5PYmplY3QoKTtcbiAgICAgICAgbWFpbk9iamVjdC5leHBpcmF0aW9uVGltZSA9IHBhcnNlSW50KGV4cGlyZVRleHRBcmVhLnZhbHVlKSAqIDYwO1xuICAgICAgICBzZXRNYWluT2JqZWN0KG1haW5PYmplY3QpO1xuICAgICAgICBleHBpcmVUZXh0QXJlYS5wbGFjZWhvbGRlciA9IGV4cGlyZVRleHRBcmVhLnZhbHVlO1xuICAgICAgICBleHBpcmVUZXh0QXJlYS52YWx1ZSA9ICcnO1xuICAgIH0gZWxzZSB7XG4gICAgICAgIC8vVE9ETzog0JTQvtC/0LjRgdCw0YLRjCDQstGL0LLQvtC0INC90LAg0Y3QutGA0LDQvSDRgdC+0L7QsdGJ0LXQvdC40Y8g0L4g0YLQvtC8LCDRh9GC0L4g0LfQvdCw0YfQtdC90LjQtSDQvdC1INCy0LLQtdC00LXQvdC+XG4gICAgfVxufSlcblxuZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLm9wdGlvbnNfX3RpbWUtdG8tc2VuZC1tZXNzYWdlLWJ1dHRvbicpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGUpID0+IHtcbiAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgY29uc3QgbWVzc2FnZVRleHRBcmVhID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLm9wdGlvbnNfX3RpbWUtdG8tc2VuZC1tZXNzYWdlJyk7XG4gICAgaWYgKG1lc3NhZ2VUZXh0QXJlYS52YWx1ZSkge1xuICAgICAgICBjb25zdCBtYWluT2JqZWN0ID0gZ2V0TWFpbk9iamVjdCgpO1xuICAgICAgICBtYWluT2JqZWN0Lm1lc3NhZ2VUaW1lID0gcGFyc2VJbnQobWVzc2FnZVRleHRBcmVhLnZhbHVlKSAqIDYwO1xuICAgICAgICBtZXNzYWdlVGV4dEFyZWEucGxhY2Vob2xkZXIgPSBtZXNzYWdlVGV4dEFyZWEudmFsdWU7XG4gICAgICAgIG1lc3NhZ2VUZXh0QXJlYS52YWx1ZSA9ICcnO1xuICAgICAgICBzZXRNYWluT2JqZWN0KG1haW5PYmplY3QpO1xuICAgIH0gZWxzZSB7XG4gICAgICAgIC8vVE9ETzog0LTQvtC/0LjRgdCw0YLRjCDQstGL0LLQvtC0INC90LAg0Y3QutGA0LDQvSDQviDRgtC+0LwsINGH0YLQviDQt9C90LDRh9C10L3QuNC1INC90LUg0LLQstC10LTQtdC90L5cbiAgICB9XG59KVxuXG5kb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcub3B0aW9uc19fcmVxdWVzdC1pbnRlcnZhbC1idXR0b24nKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChlKSA9PiB7XG4gICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIGNvbnN0IHJlcXVlc3RUZXh0QXJlYSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5vcHRpb25zX19yZXF1ZXN0LWludGVydmFsJyk7XG4gICAgaWYgKHJlcXVlc3RUZXh0QXJlYS52YWx1ZSAmJiBwYXJzZUludChyZXF1ZXN0VGV4dEFyZWEudmFsdWUpID4gMTApIHtcbiAgICAgICAgY29uc3QgbWFpbk9iamVjdCA9IGdldE1haW5PYmplY3QoKTtcbiAgICAgICAgbWFpbk9iamVjdC5yZXF1ZXN0SW50ZXJ2YWwgPSBwYXJzZUludChyZXF1ZXN0VGV4dEFyZWEudmFsdWUpICogMTAwMDtcbiAgICAgICAgcmVxdWVzdFRleHRBcmVhLnBsYWNlaG9sZGVyID0gcmVxdWVzdFRleHRBcmVhLnZhbHVlO1xuICAgICAgICByZXF1ZXN0VGV4dEFyZWEudmFsdWUgPSAnJztcbiAgICAgICAgc2V0TWFpbk9iamVjdChtYWluT2JqZWN0KTtcbiAgICB9IGVsc2Uge1xuICAgICAgICAvL1RPRE86INC00L7Qv9C40YHQsNGC0Ywg0LLRi9Cy0L7QtCDQvdCwINGN0LrRgNCw0L0g0L4g0YLQvtC8LCDRh9GC0L4g0LfQvdCw0YfQtdC90LjQtSDQvdC1INCy0LLQtdC00LXQvdC+INC40LvQuCDQvNC10L3RjNGI0LUgMTAg0YHQtdC6XG4gICAgfVxufSkiXX0=
