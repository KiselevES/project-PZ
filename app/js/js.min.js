class mainObjectClass {
    constructor() {
        //интервал запросов
        this.requestInterval = 10;

        //время отправки сообщения (переаодим в сек)
        this.messageTime = 23 * 60;

        //время до просрочки (переводим в сек)
        this.expirationTime = 30 * 60;

        //пустой массив под заказы
        this.orders = [];

        //отправка сообщений в Telegram
        this.telegram = true;

        //развернуть инструкцию
        this.instruction = false;
    }
}
class orderClass {
    constructor(orderNumber) {
        this.unixTime = parseInt(new Date().getTime() / 1000);
        this.date = parseInt(new Date().getDate());
        this.expired = false;
        this.messageSent = false;
        this.complete = false;
        this.completeTime = 0;
        this.inQueue = false;
        this.preparing = false;
        this.orderNumber = orderNumber;
        this.needMessage = false;
        this.remade = false;
    }

    setExpired() {
        this.expired = true;
    }

    setMessageSent() {
        this.messageSent = true;
        this.needMessage = false;
    }

    setNeedMessage(){
        this.needMessage = true;
    }

    setTime(time) {
        this.completeTime = time - this.unixTime;
    }

    setQueue() {
        this.inQueue = true;
        this.preparing = false;
    }

    setPreparing() {
        this.preparing = true;
        this.inQueue = false;
    }

    setComplete() {
        this.complete = true;
        this.preparing = false;
        this.inQueue = false;
    }

    setRemade(){
        this.Complete = false;
        this.Remade = true;
    }

}

function getMainObject() {
    return JSON.parse(localStorage.getItem('mainObject'));
}

function isMainObjectExists() {
    return localStorage.getItem('mainObject') !== null;
}

function setMainObject(mainObject) {
    localStorage.setItem('mainObject', JSON.stringify(mainObject));
}

function ismainObjectContainsOrder(mainObject, orderNumber) {
    for (let i = 0; i < mainObject.orders.length; i++) {
        if (mainObject.orders[i].orderNumber === orderNumber) {
            return true;
        }
    }
    return false;
}

function getSameOrder(newContentObject, orderNumber) {
    for (let i = 0; i < newContentObject.orders.length; i++) {
        if (newContentObject.orders[i].orderNumber === orderNumber) {
            return newContentObject.orders[i].orderNumber;
        }
    }
    return false;
}

function isOrderRemade(mainObject, orderNumber) {
    for (let i = 0; i < mainObject.orders.length; i++) {
        if (mainObject.orders[i].orderNumber === orderNumber && mainObject.orders[i].complete === true) {
            return true;
        }
    }
    return false;
}

function secondsTimeToNormal(seconds) {
    let minutes = Math.floor(seconds / 60) + '';
    let secs = seconds % 60 + '';
    if (secs.length < 2) {
        secs = '0' + secs;
    }
    const result = minutes + ':' + secs;
    return result;
}

function deployInstruction(e) {
    e.preventDefault();
    const mainObject = getMainObject();
    const desc = document.querySelector('.introduction__desc');
    const button = document.querySelector('.introduction__button');
    const box = document.querySelector('.introduction__box');
    const outer = document.querySelector('.introduction__outer');
    if (button.textContent === '+') {
        box.style.display = 'block';
        outer.style.display = 'block';
        button.textContent = '-';
        desc.textContent = 'свернуть инструкцию';
        mainObject.instruction = true;
    } else if (button.textContent === '-') {
        box.style.display = 'none';
        outer.style.display = 'none';
        button.textContent = '+';
        desc.textContent = 'развернуть инструкцию';
        mainObject.instruction = false;
    }
    setMainObject(mainObject);
}
const model = {


    callExternalContent() {
        return new Promise((resolve, reject) => {
            const x = new XMLHttpRequest();

            //ajax запрос через прокси cors-anywhere
            x.open('GET', 'https://cors-anywhere.herokuapp.com/https://akson.ru/personal/order/table1/?STORE_ID=11');
            //x.open('GET', 'pz3.html');

            //x.timeout = 5000;
            x.send();
            x.onload = () => {
                if (x.status !== 200) {
                    reject(x.statusText)
                } else {
                    resolve(x.responseText || '');
                }
            };
        })
    },
    //
    getContent(externalContent) {
        //вытаскиваем таблицу из исходного кода
        const cutExternalContent = externalContent.substr(3196, externalContent.length - 3370);
        //console.log(cutExternalContent);
        const hiddenTable = document.querySelector('.hidden-table');
        hiddenTable.innerHTML = cutExternalContent;
        //вытаскиваем строки
        const rows = document.getElementsByTagName('tr');
        //переменная для строк фильтрованной таблицы
        let filteredRows = [];

        //удаляем строки заголовков таблиц, удаляем отмененные заказы, формируем одну таблицу из двух
        for (let i = 0; i < rows.length; i++) {
            if (rows[i].innerHTML.length !== 377) {
                if (rows[i].children[3].innerHTML.length > 100) {
                    rows[i].parentNode.removeChild(rows[i]);
                } else {
                    filteredRows.push(rows[i]);
                }
            }
        }
        //удаляем четвертую ячейку
        for (let i = 0; i < filteredRows.length; i++) {
            filteredRows[i].removeChild(filteredRows[i].children[3]);
        }

        const newContentObject = new mainObjectClass();
        filteredRows.forEach((item) => {
            const orderNumber = parseInt(item.children[0].children[0].children[0].innerHTML);
            const order = new orderClass(orderNumber);
            //console.log(item.children[1].children[0].innerHTML.length);
            if (item.children[1].children[0].innerHTML.length > 30) {
                order.setQueue();
            } else if (item.children[2].children[0].innerHTML.length > 30) {
                order.setPreparing();
            }
            newContentObject.orders.push(order);
        })

        //удаляем таблицу
        hiddenTable.innerHTML = '';

        if (!isMainObjectExists()) {
            setMainObject(newContentObject);
            this.getContent(externalContent);
        } else {
            const notFormattedmainObject = getMainObject();
            const mainObject = new mainObjectClass();

            mainObject.requestInterval = notFormattedmainObject.requestInterval;
            mainObject.messageTime = notFormattedmainObject.messageTime;
            mainObject.expirationTime = notFormattedmainObject.expirationTime;
            mainObject.telegram = notFormattedmainObject.telegram;
            mainObject.instruction = notFormattedmainObject.instruction;

            notFormattedmainObject.orders.forEach((item) => {
                let currentOrder = new orderClass(item.orderNumber);
                currentOrder.expired = item.expired;
                currentOrder.messageSent = item.messageSent;
                currentOrder.complete = item.complete;
                currentOrder.completeTime = item.completeTime;
                currentOrder.inQueue = item.inQueue;
                currentOrder.preparing = item.preparing;
                currentOrder.remade = item.remade;
                currentOrder.unixTime = item.unixTime;
                currentOrder.date = item.date;
                currentOrder.needMessage = item.needMessage;
                mainObject.orders.push(currentOrder);
            })


            // Добавляем новые заказы
            newContentObject.orders.forEach((item, i) => {
                if (!ismainObjectContainsOrder(mainObject, item.orderNumber)) {
                    mainObject.orders.push(newContentObject.orders[i]);
                }
            })

            //если заказ уже есть в старом объекте, добавляем новый статус (в наборе)
            for (let i = 0; i < newContentObject.orders.length; i++) {
                if (ismainObjectContainsOrder(mainObject, newContentObject.orders[i].orderNumber) && newContentObject.orders[i].preparing) {
                    for (let y = 0; y < mainObject.orders.length; y++) {
                        if (mainObject.orders[y].orderNumber === newContentObject.orders[i].orderNumber) {
                            mainObject.orders[y].preparing = true;
                            mainObject.orders[y].inQueue = false;
                        }
                    }
                }
            }

            //если старого заказа нет в списке заказов нового объекта, помечаем старый подтвержденным
            mainObject.orders.forEach((item) => {
                if (!getSameOrder(newContentObject, item.orderNumber)) {
                    item.setComplete();
                }
            })
            //получаем перевыгруженные заказы
            newContentObject.orders.forEach((item) => {
                if (isOrderRemade(mainObject, item.orderNumber)) {
                    for (let i = 0; i < mainObject.orders.length; i++) {
                        if (mainObject.orders[i].orderNumber === item.orderNumber) {
                            mainObject.orders[i].remade = true;
                            mainObject.orders[i].expired = item.expired;
                            mainObject.orders[i].messageSent = false;
                            mainObject.orders[i].unixTime = parseInt(new Date().getTime() / 1000);
                            mainObject.orders[i].complete = false;
                            mainObject.orders[i].completeTime = 0;
                            mainObject.orders[i].inQueue = item.inQueue;
                            mainObject.orders[i].preparing = item.preparing;
                            mainObject.orders[i].date = item.date;
                            mainObject.orders[i].needMessage = item.needMessage;
                            let remadeOrder = mainObject.orders[i];
                            mainObject.orders.push(remadeOrder);
                            mainObject.orders.splice(i, 1);
                        }
                    }
                }
            })

            //задаем время наборки
            mainObject.orders.forEach((item) => {
                if (item.complete === false) {
                    item.setTime(parseInt(new Date().getTime() / 1000));
                }
            })

            //проверяем на просрочку

            mainObject.orders.forEach((item) => {
                if (item.completeTime > mainObject.expirationTime) {
                    item.setExpired();
                }
            })

            //удаляем заказы возрастом более 10 дней
            for (let i = mainObject.orders.length - 1; i >= 0; i--) {
                if (parseInt(new Date().getTime() / 1000) - mainObject.orders[i].unixTime > 864000) {
                    mainObject.orders.splice(i, 1);
                }
            }

            setMainObject(mainObject);
        }
    },

    setWarning() {
        const mainObject = getMainObject();
        mainObject.orders.forEach((item) => {
            if (parseInt(new Date().getTime() / 1000) - item.unixTime > mainObject.messageTime && !item.complete && !item.messageSent) {
                item.needMessage = true;
            }
        })
        setMainObject(mainObject);
    }
}
const view = {
    drawTable() {
        const mainObject = getMainObject();
        const newTable = document.querySelector('.new-table');
        let counter = 1;
        mainObject.orders.forEach((item) => {

            let inQueue = '';
            if (item.inQueue === true) {
                inQueue = 'X';
            }
            let preparing = '';
            if (item.preparing === true) {
                preparing = 'X';
            }
            let complete = '';
            if (item.complete === true) {
                complete = 'X';
            }
            let time = secondsTimeToNormal(item.completeTime);
            if (item.date === parseInt(new Date().getDate()) && item.remade && !item.messageSent) {
                newTable.insertAdjacentHTML('beforeend', `
                    <tbody class="new-table__tbody">
                        <tr class="new-table__row new-table__order-remade">
                            <td class="new-table__cell">${counter++}</td>
                            <td class="new-table__cell">${item.orderNumber}</td>
                            <td class="new-table__cell">${inQueue}</td>
                            <td class="new-table__cell">${preparing}</td>
                            <td class="new-table__cell">${complete}</td>
                            <td class="new-table__cell">${time}</td>
                        </tr>
                    </tbody>`
                );

            } else if (item.date === parseInt(new Date().getDate()) && !item.expired && !item.messageSent) {
                newTable.insertAdjacentHTML('beforeend', `
                    <tbody class="new-table__tbody">
                        <tr class="new-table__row new-table__order-normal">
                            <td class="new-table__cell">${counter++}</td>
                            <td class="new-table__cell">${item.orderNumber}</td>
                            <td class="new-table__cell">${inQueue}</td>
                            <td class="new-table__cell">${preparing}</td>
                            <td class="new-table__cell">${complete}</td>
                            <td class="new-table__cell">${time}</td>
                        </tr>
                    </tbody>`
                );

            } else if (item.date === parseInt(new Date().getDate()) && !item.expired && item.messageSent) {
                newTable.insertAdjacentHTML('beforeend', `
                    <tbody class="new-table__tbody">
                        <tr class="new-table__row new-table__order-warning">
                            <td class="new-table__cell">${counter++}</td>
                            <td class="new-table__cell">${item.orderNumber}</td>
                            <td class="new-table__cell">${inQueue}</td>
                            <td class="new-table__cell">${preparing}</td>
                            <td class="new-table__cell">${complete}</td>
                            <td class="new-table__cell">${time}</td>
                        </tr>
                    </tbody>`
                );

            } else if (item.date === parseInt(new Date().getDate()) && item.expired && item.messageSent) {
                newTable.insertAdjacentHTML('beforeend', `
                    <tbody class="new-table__tbody">
                        <tr class="new-table__row new-table__order-expired">
                            <td class="new-table__cell">${counter++}</td>
                            <td class="new-table__cell">${item.orderNumber}</td>
                            <td class="new-table__cell">${inQueue}</td>
                            <td class="new-table__cell">${preparing}</td>
                            <td class="new-table__cell">${complete}</td>
                            <td class="new-table__cell">${time}</td>
                        </tr>
                    </tbody>`
                );

            }

        })

    },

    setTimer() {
        const mainObject = getMainObject();
        document.querySelectorAll('.new-table__tbody').forEach((item) => {
            if (item.children[0].children[4].innerHTML.length === 0) {
                setInterval(() => {
                    let unixTime = 0;
                    let orderNumber = parseInt(item.children[0].children[1].innerHTML);
                    for (let i = 0; i < mainObject.orders.length; i++) {
                        if (mainObject.orders[i].orderNumber == orderNumber) {
                            unixTime = mainObject.orders[i].unixTime;
                        }
                    }
                    let currentUnixTime = parseInt(new Date().getTime() / 1000);
                    item.children[0].children[5].innerHTML = secondsTimeToNormal(currentUnixTime - unixTime);
                }, 1000)
            }
        })
    },

    sendMessage(message) {
        const x = new XMLHttpRequest();
        x.open('GET', 'https://api.telegram.org/bot1018757013:AAEHO9accUhscieT0ArRq9iwUeat6BmEzOM/sendMessage?chat_id=-1001471677614&text=' + message);
        x.send();


    }
    ,

    sendMessages() {
        const mainObject = getMainObject();
        mainObject.orders.forEach((item) => {
            if (item.needMessage === true) {
                if (mainObject.telegram) {
                    this.sendMessage('Заказ ' + item.orderNumber + ' в наборе уже более ' + mainObject.messageTime / 60 + ' минут');
                    //console.log('Заказ ' + item.orderNumber + ' в наборе уже более ' + mainObject.expirationTime / 60 + ' минут')
                }
                item.messageSent = true;
                item.needMessage = false;
            }
        })
        setMainObject(mainObject);
        //console.log(mainObject);
    }
    ,

    setPlaceholders() {
        const mainObject = getMainObject();
        document.querySelector('.options__time-to-expire').placeholder = mainObject.expirationTime / 60;
        document.querySelector('.options__time-to-send-message').placeholder = mainObject.messageTime / 60;
        document.querySelector('.options__request-interval').placeholder = mainObject.requestInterval;
    }
    ,

    telegramCheckbox() {
        const mainObject = getMainObject();
        const checkBox = document.querySelector('.telegram__checkbox');
        if (mainObject.telegram) {
            checkBox.setAttribute('checked', 'true');
        } else {
            checkBox.removeAttribute('checked');
        }
    },

    instruction() {
        const mainObject = getMainObject();
        const desc = document.querySelector('.introduction__desc');
        const button = document.querySelector('.introduction__button');
        const box = document.querySelector('.introduction__box');
        const outer = document.querySelector('.introduction__outer');
        if (mainObject.instruction) {
            box.style.display = 'block';
            outer.style.display = 'block';
            desc.textContent = 'свернуть инструкцию';
            button.textContent = '-';
        }
    }
}
const controller = {
    mainRoute() {
        let interval = 10;
        if (isMainObjectExists()) {
            const mainObject = getMainObject();
            interval = mainObject.requestInterval;
        }

        model.callExternalContent()
            .then((response) => {
                model.getContent(response);
                model.setWarning();
                view.instruction();
                view.sendMessages();
                view.drawTable();
                view.setTimer();
                view.telegramCheckbox();
                view.setPlaceholders();
                document.getElementById('interval').scrollIntoView();
            })

        window.setTimeout(() => {
            //this.mainRoute();
            window.location.reload();
        }, interval * 1000);
    }
}
document.addEventListener("DOMContentLoaded", () => {
controller.mainRoute();
})

//устанавливаем интервал, время сообщения, время до просрочки
document.querySelector('.options__time-to-expire-button').addEventListener('click', (e) => {
    e.preventDefault();
    const expireTextArea = document.querySelector('.options__time-to-expire');
    if (expireTextArea.value && !isNaN(expireTextArea.value)) {
        const mainObject = getMainObject();
        mainObject.expirationTime = parseInt(expireTextArea.value) * 60;
        setMainObject(mainObject);
        expireTextArea.placeholder = expireTextArea.value;
        expireTextArea.value = '';
    } else {
        const messageBox = document.querySelector('.options__message-box-time-to-expire');
        messageBox.style.display = 'block';
        expireTextArea.value = '';
        setTimeout(() => {
            messageBox.style.display = 'none';
        }, 1000)
    }
})

document.querySelector('.options__time-to-send-message-button').addEventListener('click', (e) => {
    e.preventDefault();
    const messageTextArea = document.querySelector('.options__time-to-send-message');
    if (messageTextArea.value && !isNaN(messageTextArea.value)) {
        const mainObject = getMainObject();
        mainObject.messageTime = parseInt(messageTextArea.value) * 60;
        messageTextArea.placeholder = messageTextArea.value;
        messageTextArea.value = '';
        setMainObject(mainObject);
    } else {
        const messageBox = document.querySelector('.options__message-box-time-to-send-message');
        messageBox.style.display = 'block';
        messageTextArea.value = '';
        setTimeout(() => {
            messageBox.style.display = 'none';
        }, 1000)
    }
})

document.querySelector('.options__request-interval-button').addEventListener('click', (e) => {
    e.preventDefault();
    const requestTextArea = document.querySelector('.options__request-interval');
    if (requestTextArea.value && !isNaN(requestTextArea.value) && parseInt(requestTextArea.value) >= 10) {
        const mainObject = getMainObject();
        mainObject.requestInterval = parseInt(requestTextArea.value);
        requestTextArea.placeholder = requestTextArea.value;
        requestTextArea.value = '';
        setMainObject(mainObject);
    } else {
        const messageBox = document.querySelector('.options__message-box-request-interval');
        messageBox.style.display = 'block';
        requestTextArea.value = '';
        setTimeout(() => {
            messageBox.style.display = 'none';
        }, 1000)
    }
})

document.querySelector('.reset').addEventListener('click', (e) => {
    e.preventDefault();
    const msg = prompt('Действительно? Все данные удалятся! Для продолжения введите "УДАЛИТЬ!" большими буквами');
    if (msg === 'УДАЛИТЬ!') {
        localStorage.clear();
        window.location.reload();
    }


})

document.addEventListener('scroll', () => {
    const header = document.querySelector('.new-table__header-white-bg');
    if (window.scrollY > header.getBoundingClientRect().y) {
        header.style.position = 'fixed';
        header.style.top = '0';
    } else {
        header.style.position = 'static';
    }
})

document.querySelector('.telegram__checkbox').addEventListener('change', () => {
    const mainObject = getMainObject();
    const checkBox = document.querySelector('.telegram__checkbox');
    mainObject.telegram = !!checkBox.checked;
    setMainObject(mainObject);
})

document.querySelector('.introduction__link').addEventListener('click', deployInstruction);
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIk1haW5PYmplY3RDbGFzcy5qcyIsIm9yZGVyQ2xhc3MuanMiLCJmdW5jdGlvbnMuanMiLCJNb2RlbC5qcyIsIlZpZXcuanMiLCJDb250cm9sbGVyLmpzIiwibWFpbi5qcyIsImV2ZW50TGlzdGVuZXJzLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3BCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3REQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDdEVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDakxBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzlKQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUMxQkE7QUFDQTtBQUNBO0FBQ0E7QUNIQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJmaWxlIjoianMubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiY2xhc3MgbWFpbk9iamVjdENsYXNzIHtcbiAgICBjb25zdHJ1Y3RvcigpIHtcbiAgICAgICAgLy/QuNC90YLQtdGA0LLQsNC7INC30LDQv9GA0L7RgdC+0LJcbiAgICAgICAgdGhpcy5yZXF1ZXN0SW50ZXJ2YWwgPSAxMDtcblxuICAgICAgICAvL9Cy0YDQtdC80Y8g0L7RgtC/0YDQsNCy0LrQuCDRgdC+0L7QsdGJ0LXQvdC40Y8gKNC/0LXRgNC10LDQvtC00LjQvCDQsiDRgdC10LopXG4gICAgICAgIHRoaXMubWVzc2FnZVRpbWUgPSAyMyAqIDYwO1xuXG4gICAgICAgIC8v0LLRgNC10LzRjyDQtNC+INC/0YDQvtGB0YDQvtGH0LrQuCAo0L/QtdGA0LXQstC+0LTQuNC8INCyINGB0LXQuilcbiAgICAgICAgdGhpcy5leHBpcmF0aW9uVGltZSA9IDMwICogNjA7XG5cbiAgICAgICAgLy/Qv9GD0YHRgtC+0Lkg0LzQsNGB0YHQuNCyINC/0L7QtCDQt9Cw0LrQsNC30YtcbiAgICAgICAgdGhpcy5vcmRlcnMgPSBbXTtcblxuICAgICAgICAvL9C+0YLQv9GA0LDQstC60LAg0YHQvtC+0LHRidC10L3QuNC5INCyIFRlbGVncmFtXG4gICAgICAgIHRoaXMudGVsZWdyYW0gPSB0cnVlO1xuXG4gICAgICAgIC8v0YDQsNC30LLQtdGA0L3Rg9GC0Ywg0LjQvdGB0YLRgNGD0LrRhtC40Y5cbiAgICAgICAgdGhpcy5pbnN0cnVjdGlvbiA9IGZhbHNlO1xuICAgIH1cbn0iLCJjbGFzcyBvcmRlckNsYXNzIHtcbiAgICBjb25zdHJ1Y3RvcihvcmRlck51bWJlcikge1xuICAgICAgICB0aGlzLnVuaXhUaW1lID0gcGFyc2VJbnQobmV3IERhdGUoKS5nZXRUaW1lKCkgLyAxMDAwKTtcbiAgICAgICAgdGhpcy5kYXRlID0gcGFyc2VJbnQobmV3IERhdGUoKS5nZXREYXRlKCkpO1xuICAgICAgICB0aGlzLmV4cGlyZWQgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5tZXNzYWdlU2VudCA9IGZhbHNlO1xuICAgICAgICB0aGlzLmNvbXBsZXRlID0gZmFsc2U7XG4gICAgICAgIHRoaXMuY29tcGxldGVUaW1lID0gMDtcbiAgICAgICAgdGhpcy5pblF1ZXVlID0gZmFsc2U7XG4gICAgICAgIHRoaXMucHJlcGFyaW5nID0gZmFsc2U7XG4gICAgICAgIHRoaXMub3JkZXJOdW1iZXIgPSBvcmRlck51bWJlcjtcbiAgICAgICAgdGhpcy5uZWVkTWVzc2FnZSA9IGZhbHNlO1xuICAgICAgICB0aGlzLnJlbWFkZSA9IGZhbHNlO1xuICAgIH1cblxuICAgIHNldEV4cGlyZWQoKSB7XG4gICAgICAgIHRoaXMuZXhwaXJlZCA9IHRydWU7XG4gICAgfVxuXG4gICAgc2V0TWVzc2FnZVNlbnQoKSB7XG4gICAgICAgIHRoaXMubWVzc2FnZVNlbnQgPSB0cnVlO1xuICAgICAgICB0aGlzLm5lZWRNZXNzYWdlID0gZmFsc2U7XG4gICAgfVxuXG4gICAgc2V0TmVlZE1lc3NhZ2UoKXtcbiAgICAgICAgdGhpcy5uZWVkTWVzc2FnZSA9IHRydWU7XG4gICAgfVxuXG4gICAgc2V0VGltZSh0aW1lKSB7XG4gICAgICAgIHRoaXMuY29tcGxldGVUaW1lID0gdGltZSAtIHRoaXMudW5peFRpbWU7XG4gICAgfVxuXG4gICAgc2V0UXVldWUoKSB7XG4gICAgICAgIHRoaXMuaW5RdWV1ZSA9IHRydWU7XG4gICAgICAgIHRoaXMucHJlcGFyaW5nID0gZmFsc2U7XG4gICAgfVxuXG4gICAgc2V0UHJlcGFyaW5nKCkge1xuICAgICAgICB0aGlzLnByZXBhcmluZyA9IHRydWU7XG4gICAgICAgIHRoaXMuaW5RdWV1ZSA9IGZhbHNlO1xuICAgIH1cblxuICAgIHNldENvbXBsZXRlKCkge1xuICAgICAgICB0aGlzLmNvbXBsZXRlID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5wcmVwYXJpbmcgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5pblF1ZXVlID0gZmFsc2U7XG4gICAgfVxuXG4gICAgc2V0UmVtYWRlKCl7XG4gICAgICAgIHRoaXMuQ29tcGxldGUgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5SZW1hZGUgPSB0cnVlO1xuICAgIH1cblxufVxuIiwiZnVuY3Rpb24gZ2V0TWFpbk9iamVjdCgpIHtcbiAgICByZXR1cm4gSlNPTi5wYXJzZShsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgnbWFpbk9iamVjdCcpKTtcbn1cblxuZnVuY3Rpb24gaXNNYWluT2JqZWN0RXhpc3RzKCkge1xuICAgIHJldHVybiBsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgnbWFpbk9iamVjdCcpICE9PSBudWxsO1xufVxuXG5mdW5jdGlvbiBzZXRNYWluT2JqZWN0KG1haW5PYmplY3QpIHtcbiAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSgnbWFpbk9iamVjdCcsIEpTT04uc3RyaW5naWZ5KG1haW5PYmplY3QpKTtcbn1cblxuZnVuY3Rpb24gaXNtYWluT2JqZWN0Q29udGFpbnNPcmRlcihtYWluT2JqZWN0LCBvcmRlck51bWJlcikge1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbWFpbk9iamVjdC5vcmRlcnMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgaWYgKG1haW5PYmplY3Qub3JkZXJzW2ldLm9yZGVyTnVtYmVyID09PSBvcmRlck51bWJlcikge1xuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIGZhbHNlO1xufVxuXG5mdW5jdGlvbiBnZXRTYW1lT3JkZXIobmV3Q29udGVudE9iamVjdCwgb3JkZXJOdW1iZXIpIHtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IG5ld0NvbnRlbnRPYmplY3Qub3JkZXJzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIGlmIChuZXdDb250ZW50T2JqZWN0Lm9yZGVyc1tpXS5vcmRlck51bWJlciA9PT0gb3JkZXJOdW1iZXIpIHtcbiAgICAgICAgICAgIHJldHVybiBuZXdDb250ZW50T2JqZWN0Lm9yZGVyc1tpXS5vcmRlck51bWJlcjtcbiAgICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gZmFsc2U7XG59XG5cbmZ1bmN0aW9uIGlzT3JkZXJSZW1hZGUobWFpbk9iamVjdCwgb3JkZXJOdW1iZXIpIHtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IG1haW5PYmplY3Qub3JkZXJzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIGlmIChtYWluT2JqZWN0Lm9yZGVyc1tpXS5vcmRlck51bWJlciA9PT0gb3JkZXJOdW1iZXIgJiYgbWFpbk9iamVjdC5vcmRlcnNbaV0uY29tcGxldGUgPT09IHRydWUpIHtcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG4gICAgfVxuICAgIHJldHVybiBmYWxzZTtcbn1cblxuZnVuY3Rpb24gc2Vjb25kc1RpbWVUb05vcm1hbChzZWNvbmRzKSB7XG4gICAgbGV0IG1pbnV0ZXMgPSBNYXRoLmZsb29yKHNlY29uZHMgLyA2MCkgKyAnJztcbiAgICBsZXQgc2VjcyA9IHNlY29uZHMgJSA2MCArICcnO1xuICAgIGlmIChzZWNzLmxlbmd0aCA8IDIpIHtcbiAgICAgICAgc2VjcyA9ICcwJyArIHNlY3M7XG4gICAgfVxuICAgIGNvbnN0IHJlc3VsdCA9IG1pbnV0ZXMgKyAnOicgKyBzZWNzO1xuICAgIHJldHVybiByZXN1bHQ7XG59XG5cbmZ1bmN0aW9uIGRlcGxveUluc3RydWN0aW9uKGUpIHtcbiAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgY29uc3QgbWFpbk9iamVjdCA9IGdldE1haW5PYmplY3QoKTtcbiAgICBjb25zdCBkZXNjID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmludHJvZHVjdGlvbl9fZGVzYycpO1xuICAgIGNvbnN0IGJ1dHRvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5pbnRyb2R1Y3Rpb25fX2J1dHRvbicpO1xuICAgIGNvbnN0IGJveCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5pbnRyb2R1Y3Rpb25fX2JveCcpO1xuICAgIGNvbnN0IG91dGVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmludHJvZHVjdGlvbl9fb3V0ZXInKTtcbiAgICBpZiAoYnV0dG9uLnRleHRDb250ZW50ID09PSAnKycpIHtcbiAgICAgICAgYm94LnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snO1xuICAgICAgICBvdXRlci5zdHlsZS5kaXNwbGF5ID0gJ2Jsb2NrJztcbiAgICAgICAgYnV0dG9uLnRleHRDb250ZW50ID0gJy0nO1xuICAgICAgICBkZXNjLnRleHRDb250ZW50ID0gJ9GB0LLQtdGA0L3Rg9GC0Ywg0LjQvdGB0YLRgNGD0LrRhtC40Y4nO1xuICAgICAgICBtYWluT2JqZWN0Lmluc3RydWN0aW9uID0gdHJ1ZTtcbiAgICB9IGVsc2UgaWYgKGJ1dHRvbi50ZXh0Q29udGVudCA9PT0gJy0nKSB7XG4gICAgICAgIGJveC5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnO1xuICAgICAgICBvdXRlci5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnO1xuICAgICAgICBidXR0b24udGV4dENvbnRlbnQgPSAnKyc7XG4gICAgICAgIGRlc2MudGV4dENvbnRlbnQgPSAn0YDQsNC30LLQtdGA0L3Rg9GC0Ywg0LjQvdGB0YLRgNGD0LrRhtC40Y4nO1xuICAgICAgICBtYWluT2JqZWN0Lmluc3RydWN0aW9uID0gZmFsc2U7XG4gICAgfVxuICAgIHNldE1haW5PYmplY3QobWFpbk9iamVjdCk7XG59IiwiY29uc3QgbW9kZWwgPSB7XG5cblxuICAgIGNhbGxFeHRlcm5hbENvbnRlbnQoKSB7XG4gICAgICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICAgICAgICBjb25zdCB4ID0gbmV3IFhNTEh0dHBSZXF1ZXN0KCk7XG5cbiAgICAgICAgICAgIC8vYWpheCDQt9Cw0L/RgNC+0YEg0YfQtdGA0LXQtyDQv9GA0L7QutGB0LggY29ycy1hbnl3aGVyZVxuICAgICAgICAgICAgeC5vcGVuKCdHRVQnLCAnaHR0cHM6Ly9jb3JzLWFueXdoZXJlLmhlcm9rdWFwcC5jb20vaHR0cHM6Ly9ha3Nvbi5ydS9wZXJzb25hbC9vcmRlci90YWJsZTEvP1NUT1JFX0lEPTExJyk7XG4gICAgICAgICAgICAvL3gub3BlbignR0VUJywgJ3B6My5odG1sJyk7XG5cbiAgICAgICAgICAgIC8veC50aW1lb3V0ID0gNTAwMDtcbiAgICAgICAgICAgIHguc2VuZCgpO1xuICAgICAgICAgICAgeC5vbmxvYWQgPSAoKSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKHguc3RhdHVzICE9PSAyMDApIHtcbiAgICAgICAgICAgICAgICAgICAgcmVqZWN0KHguc3RhdHVzVGV4dClcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICByZXNvbHZlKHgucmVzcG9uc2VUZXh0IHx8ICcnKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9O1xuICAgICAgICB9KVxuICAgIH0sXG4gICAgLy9cbiAgICBnZXRDb250ZW50KGV4dGVybmFsQ29udGVudCkge1xuICAgICAgICAvL9Cy0YvRgtCw0YHQutC40LLQsNC10Lwg0YLQsNCx0LvQuNGG0YMg0LjQtyDQuNGB0YXQvtC00L3QvtCz0L4g0LrQvtC00LBcbiAgICAgICAgY29uc3QgY3V0RXh0ZXJuYWxDb250ZW50ID0gZXh0ZXJuYWxDb250ZW50LnN1YnN0cigzMTk2LCBleHRlcm5hbENvbnRlbnQubGVuZ3RoIC0gMzM3MCk7XG4gICAgICAgIC8vY29uc29sZS5sb2coY3V0RXh0ZXJuYWxDb250ZW50KTtcbiAgICAgICAgY29uc3QgaGlkZGVuVGFibGUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuaGlkZGVuLXRhYmxlJyk7XG4gICAgICAgIGhpZGRlblRhYmxlLmlubmVySFRNTCA9IGN1dEV4dGVybmFsQ29udGVudDtcbiAgICAgICAgLy/QstGL0YLQsNGB0LrQuNCy0LDQtdC8INGB0YLRgNC+0LrQuFxuICAgICAgICBjb25zdCByb3dzID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ3RyJyk7XG4gICAgICAgIC8v0L/QtdGA0LXQvNC10L3QvdCw0Y8g0LTQu9GPINGB0YLRgNC+0Log0YTQuNC70YzRgtGA0L7QstCw0L3QvdC+0Lkg0YLQsNCx0LvQuNGG0YtcbiAgICAgICAgbGV0IGZpbHRlcmVkUm93cyA9IFtdO1xuXG4gICAgICAgIC8v0YPQtNCw0LvRj9C10Lwg0YHRgtGA0L7QutC4INC30LDQs9C+0LvQvtCy0LrQvtCyINGC0LDQsdC70LjRhiwg0YPQtNCw0LvRj9C10Lwg0L7RgtC80LXQvdC10L3QvdGL0LUg0LfQsNC60LDQt9GLLCDRhNC+0YDQvNC40YDRg9C10Lwg0L7QtNC90YMg0YLQsNCx0LvQuNGG0YMg0LjQtyDQtNCy0YPRhVxuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHJvd3MubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIGlmIChyb3dzW2ldLmlubmVySFRNTC5sZW5ndGggIT09IDM3Nykge1xuICAgICAgICAgICAgICAgIGlmIChyb3dzW2ldLmNoaWxkcmVuWzNdLmlubmVySFRNTC5sZW5ndGggPiAxMDApIHtcbiAgICAgICAgICAgICAgICAgICAgcm93c1tpXS5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKHJvd3NbaV0pO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGZpbHRlcmVkUm93cy5wdXNoKHJvd3NbaV0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICAvL9GD0LTQsNC70Y/QtdC8INGH0LXRgtCy0LXRgNGC0YPRjiDRj9GH0LXQudC60YNcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBmaWx0ZXJlZFJvd3MubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIGZpbHRlcmVkUm93c1tpXS5yZW1vdmVDaGlsZChmaWx0ZXJlZFJvd3NbaV0uY2hpbGRyZW5bM10pO1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgbmV3Q29udGVudE9iamVjdCA9IG5ldyBtYWluT2JqZWN0Q2xhc3MoKTtcbiAgICAgICAgZmlsdGVyZWRSb3dzLmZvckVhY2goKGl0ZW0pID0+IHtcbiAgICAgICAgICAgIGNvbnN0IG9yZGVyTnVtYmVyID0gcGFyc2VJbnQoaXRlbS5jaGlsZHJlblswXS5jaGlsZHJlblswXS5jaGlsZHJlblswXS5pbm5lckhUTUwpO1xuICAgICAgICAgICAgY29uc3Qgb3JkZXIgPSBuZXcgb3JkZXJDbGFzcyhvcmRlck51bWJlcik7XG4gICAgICAgICAgICAvL2NvbnNvbGUubG9nKGl0ZW0uY2hpbGRyZW5bMV0uY2hpbGRyZW5bMF0uaW5uZXJIVE1MLmxlbmd0aCk7XG4gICAgICAgICAgICBpZiAoaXRlbS5jaGlsZHJlblsxXS5jaGlsZHJlblswXS5pbm5lckhUTUwubGVuZ3RoID4gMzApIHtcbiAgICAgICAgICAgICAgICBvcmRlci5zZXRRdWV1ZSgpO1xuICAgICAgICAgICAgfSBlbHNlIGlmIChpdGVtLmNoaWxkcmVuWzJdLmNoaWxkcmVuWzBdLmlubmVySFRNTC5sZW5ndGggPiAzMCkge1xuICAgICAgICAgICAgICAgIG9yZGVyLnNldFByZXBhcmluZygpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgbmV3Q29udGVudE9iamVjdC5vcmRlcnMucHVzaChvcmRlcik7XG4gICAgICAgIH0pXG5cbiAgICAgICAgLy/Rg9C00LDQu9GP0LXQvCDRgtCw0LHQu9C40YbRg1xuICAgICAgICBoaWRkZW5UYWJsZS5pbm5lckhUTUwgPSAnJztcblxuICAgICAgICBpZiAoIWlzTWFpbk9iamVjdEV4aXN0cygpKSB7XG4gICAgICAgICAgICBzZXRNYWluT2JqZWN0KG5ld0NvbnRlbnRPYmplY3QpO1xuICAgICAgICAgICAgdGhpcy5nZXRDb250ZW50KGV4dGVybmFsQ29udGVudCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBjb25zdCBub3RGb3JtYXR0ZWRtYWluT2JqZWN0ID0gZ2V0TWFpbk9iamVjdCgpO1xuICAgICAgICAgICAgY29uc3QgbWFpbk9iamVjdCA9IG5ldyBtYWluT2JqZWN0Q2xhc3MoKTtcblxuICAgICAgICAgICAgbWFpbk9iamVjdC5yZXF1ZXN0SW50ZXJ2YWwgPSBub3RGb3JtYXR0ZWRtYWluT2JqZWN0LnJlcXVlc3RJbnRlcnZhbDtcbiAgICAgICAgICAgIG1haW5PYmplY3QubWVzc2FnZVRpbWUgPSBub3RGb3JtYXR0ZWRtYWluT2JqZWN0Lm1lc3NhZ2VUaW1lO1xuICAgICAgICAgICAgbWFpbk9iamVjdC5leHBpcmF0aW9uVGltZSA9IG5vdEZvcm1hdHRlZG1haW5PYmplY3QuZXhwaXJhdGlvblRpbWU7XG4gICAgICAgICAgICBtYWluT2JqZWN0LnRlbGVncmFtID0gbm90Rm9ybWF0dGVkbWFpbk9iamVjdC50ZWxlZ3JhbTtcbiAgICAgICAgICAgIG1haW5PYmplY3QuaW5zdHJ1Y3Rpb24gPSBub3RGb3JtYXR0ZWRtYWluT2JqZWN0Lmluc3RydWN0aW9uO1xuXG4gICAgICAgICAgICBub3RGb3JtYXR0ZWRtYWluT2JqZWN0Lm9yZGVycy5mb3JFYWNoKChpdGVtKSA9PiB7XG4gICAgICAgICAgICAgICAgbGV0IGN1cnJlbnRPcmRlciA9IG5ldyBvcmRlckNsYXNzKGl0ZW0ub3JkZXJOdW1iZXIpO1xuICAgICAgICAgICAgICAgIGN1cnJlbnRPcmRlci5leHBpcmVkID0gaXRlbS5leHBpcmVkO1xuICAgICAgICAgICAgICAgIGN1cnJlbnRPcmRlci5tZXNzYWdlU2VudCA9IGl0ZW0ubWVzc2FnZVNlbnQ7XG4gICAgICAgICAgICAgICAgY3VycmVudE9yZGVyLmNvbXBsZXRlID0gaXRlbS5jb21wbGV0ZTtcbiAgICAgICAgICAgICAgICBjdXJyZW50T3JkZXIuY29tcGxldGVUaW1lID0gaXRlbS5jb21wbGV0ZVRpbWU7XG4gICAgICAgICAgICAgICAgY3VycmVudE9yZGVyLmluUXVldWUgPSBpdGVtLmluUXVldWU7XG4gICAgICAgICAgICAgICAgY3VycmVudE9yZGVyLnByZXBhcmluZyA9IGl0ZW0ucHJlcGFyaW5nO1xuICAgICAgICAgICAgICAgIGN1cnJlbnRPcmRlci5yZW1hZGUgPSBpdGVtLnJlbWFkZTtcbiAgICAgICAgICAgICAgICBjdXJyZW50T3JkZXIudW5peFRpbWUgPSBpdGVtLnVuaXhUaW1lO1xuICAgICAgICAgICAgICAgIGN1cnJlbnRPcmRlci5kYXRlID0gaXRlbS5kYXRlO1xuICAgICAgICAgICAgICAgIGN1cnJlbnRPcmRlci5uZWVkTWVzc2FnZSA9IGl0ZW0ubmVlZE1lc3NhZ2U7XG4gICAgICAgICAgICAgICAgbWFpbk9iamVjdC5vcmRlcnMucHVzaChjdXJyZW50T3JkZXIpO1xuICAgICAgICAgICAgfSlcblxuXG4gICAgICAgICAgICAvLyDQlNC+0LHQsNCy0LvRj9C10Lwg0L3QvtCy0YvQtSDQt9Cw0LrQsNC30YtcbiAgICAgICAgICAgIG5ld0NvbnRlbnRPYmplY3Qub3JkZXJzLmZvckVhY2goKGl0ZW0sIGkpID0+IHtcbiAgICAgICAgICAgICAgICBpZiAoIWlzbWFpbk9iamVjdENvbnRhaW5zT3JkZXIobWFpbk9iamVjdCwgaXRlbS5vcmRlck51bWJlcikpIHtcbiAgICAgICAgICAgICAgICAgICAgbWFpbk9iamVjdC5vcmRlcnMucHVzaChuZXdDb250ZW50T2JqZWN0Lm9yZGVyc1tpXSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSlcblxuICAgICAgICAgICAgLy/QtdGB0LvQuCDQt9Cw0LrQsNC3INGD0LbQtSDQtdGB0YLRjCDQsiDRgdGC0LDRgNC+0Lwg0L7QsdGK0LXQutGC0LUsINC00L7QsdCw0LLQu9GP0LXQvCDQvdC+0LLRi9C5INGB0YLQsNGC0YPRgSAo0LIg0L3QsNCx0L7RgNC1KVxuICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBuZXdDb250ZW50T2JqZWN0Lm9yZGVycy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgIGlmIChpc21haW5PYmplY3RDb250YWluc09yZGVyKG1haW5PYmplY3QsIG5ld0NvbnRlbnRPYmplY3Qub3JkZXJzW2ldLm9yZGVyTnVtYmVyKSAmJiBuZXdDb250ZW50T2JqZWN0Lm9yZGVyc1tpXS5wcmVwYXJpbmcpIHtcbiAgICAgICAgICAgICAgICAgICAgZm9yIChsZXQgeSA9IDA7IHkgPCBtYWluT2JqZWN0Lm9yZGVycy5sZW5ndGg7IHkrKykge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG1haW5PYmplY3Qub3JkZXJzW3ldLm9yZGVyTnVtYmVyID09PSBuZXdDb250ZW50T2JqZWN0Lm9yZGVyc1tpXS5vcmRlck51bWJlcikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1haW5PYmplY3Qub3JkZXJzW3ldLnByZXBhcmluZyA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbWFpbk9iamVjdC5vcmRlcnNbeV0uaW5RdWV1ZSA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvL9C10YHQu9C4INGB0YLQsNGA0L7Qs9C+INC30LDQutCw0LfQsCDQvdC10YIg0LIg0YHQv9C40YHQutC1INC30LDQutCw0LfQvtCyINC90L7QstC+0LPQviDQvtCx0YrQtdC60YLQsCwg0L/QvtC80LXRh9Cw0LXQvCDRgdGC0LDRgNGL0Lkg0L/QvtC00YLQstC10YDQttC00LXQvdC90YvQvFxuICAgICAgICAgICAgbWFpbk9iamVjdC5vcmRlcnMuZm9yRWFjaCgoaXRlbSkgPT4ge1xuICAgICAgICAgICAgICAgIGlmICghZ2V0U2FtZU9yZGVyKG5ld0NvbnRlbnRPYmplY3QsIGl0ZW0ub3JkZXJOdW1iZXIpKSB7XG4gICAgICAgICAgICAgICAgICAgIGl0ZW0uc2V0Q29tcGxldGUoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLy/Qv9C+0LvRg9GH0LDQtdC8INC/0LXRgNC10LLRi9Cz0YDRg9C20LXQvdC90YvQtSDQt9Cw0LrQsNC30YtcbiAgICAgICAgICAgIG5ld0NvbnRlbnRPYmplY3Qub3JkZXJzLmZvckVhY2goKGl0ZW0pID0+IHtcbiAgICAgICAgICAgICAgICBpZiAoaXNPcmRlclJlbWFkZShtYWluT2JqZWN0LCBpdGVtLm9yZGVyTnVtYmVyKSkge1xuICAgICAgICAgICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IG1haW5PYmplY3Qub3JkZXJzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAobWFpbk9iamVjdC5vcmRlcnNbaV0ub3JkZXJOdW1iZXIgPT09IGl0ZW0ub3JkZXJOdW1iZXIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtYWluT2JqZWN0Lm9yZGVyc1tpXS5yZW1hZGUgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1haW5PYmplY3Qub3JkZXJzW2ldLmV4cGlyZWQgPSBpdGVtLmV4cGlyZWQ7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbWFpbk9iamVjdC5vcmRlcnNbaV0ubWVzc2FnZVNlbnQgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtYWluT2JqZWN0Lm9yZGVyc1tpXS51bml4VGltZSA9IHBhcnNlSW50KG5ldyBEYXRlKCkuZ2V0VGltZSgpIC8gMTAwMCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbWFpbk9iamVjdC5vcmRlcnNbaV0uY29tcGxldGUgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtYWluT2JqZWN0Lm9yZGVyc1tpXS5jb21wbGV0ZVRpbWUgPSAwO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1haW5PYmplY3Qub3JkZXJzW2ldLmluUXVldWUgPSBpdGVtLmluUXVldWU7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbWFpbk9iamVjdC5vcmRlcnNbaV0ucHJlcGFyaW5nID0gaXRlbS5wcmVwYXJpbmc7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbWFpbk9iamVjdC5vcmRlcnNbaV0uZGF0ZSA9IGl0ZW0uZGF0ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtYWluT2JqZWN0Lm9yZGVyc1tpXS5uZWVkTWVzc2FnZSA9IGl0ZW0ubmVlZE1lc3NhZ2U7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbGV0IHJlbWFkZU9yZGVyID0gbWFpbk9iamVjdC5vcmRlcnNbaV07XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbWFpbk9iamVjdC5vcmRlcnMucHVzaChyZW1hZGVPcmRlcik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbWFpbk9iamVjdC5vcmRlcnMuc3BsaWNlKGksIDEpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSlcblxuICAgICAgICAgICAgLy/Qt9Cw0LTQsNC10Lwg0LLRgNC10LzRjyDQvdCw0LHQvtGA0LrQuFxuICAgICAgICAgICAgbWFpbk9iamVjdC5vcmRlcnMuZm9yRWFjaCgoaXRlbSkgPT4ge1xuICAgICAgICAgICAgICAgIGlmIChpdGVtLmNvbXBsZXRlID09PSBmYWxzZSkge1xuICAgICAgICAgICAgICAgICAgICBpdGVtLnNldFRpbWUocGFyc2VJbnQobmV3IERhdGUoKS5nZXRUaW1lKCkgLyAxMDAwKSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSlcblxuICAgICAgICAgICAgLy/Qv9GA0L7QstC10YDRj9C10Lwg0L3QsCDQv9GA0L7RgdGA0L7Rh9C60YNcblxuICAgICAgICAgICAgbWFpbk9iamVjdC5vcmRlcnMuZm9yRWFjaCgoaXRlbSkgPT4ge1xuICAgICAgICAgICAgICAgIGlmIChpdGVtLmNvbXBsZXRlVGltZSA+IG1haW5PYmplY3QuZXhwaXJhdGlvblRpbWUpIHtcbiAgICAgICAgICAgICAgICAgICAgaXRlbS5zZXRFeHBpcmVkKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSlcblxuICAgICAgICAgICAgLy/Rg9C00LDQu9GP0LXQvCDQt9Cw0LrQsNC30Ysg0LLQvtC30YDQsNGB0YLQvtC8INCx0L7Qu9C10LUgMTAg0LTQvdC10LlcbiAgICAgICAgICAgIGZvciAobGV0IGkgPSBtYWluT2JqZWN0Lm9yZGVycy5sZW5ndGggLSAxOyBpID49IDA7IGktLSkge1xuICAgICAgICAgICAgICAgIGlmIChwYXJzZUludChuZXcgRGF0ZSgpLmdldFRpbWUoKSAvIDEwMDApIC0gbWFpbk9iamVjdC5vcmRlcnNbaV0udW5peFRpbWUgPiA4NjQwMDApIHtcbiAgICAgICAgICAgICAgICAgICAgbWFpbk9iamVjdC5vcmRlcnMuc3BsaWNlKGksIDEpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgc2V0TWFpbk9iamVjdChtYWluT2JqZWN0KTtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBzZXRXYXJuaW5nKCkge1xuICAgICAgICBjb25zdCBtYWluT2JqZWN0ID0gZ2V0TWFpbk9iamVjdCgpO1xuICAgICAgICBtYWluT2JqZWN0Lm9yZGVycy5mb3JFYWNoKChpdGVtKSA9PiB7XG4gICAgICAgICAgICBpZiAocGFyc2VJbnQobmV3IERhdGUoKS5nZXRUaW1lKCkgLyAxMDAwKSAtIGl0ZW0udW5peFRpbWUgPiBtYWluT2JqZWN0Lm1lc3NhZ2VUaW1lICYmICFpdGVtLmNvbXBsZXRlICYmICFpdGVtLm1lc3NhZ2VTZW50KSB7XG4gICAgICAgICAgICAgICAgaXRlbS5uZWVkTWVzc2FnZSA9IHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pXG4gICAgICAgIHNldE1haW5PYmplY3QobWFpbk9iamVjdCk7XG4gICAgfVxufSIsImNvbnN0IHZpZXcgPSB7XG4gICAgZHJhd1RhYmxlKCkge1xuICAgICAgICBjb25zdCBtYWluT2JqZWN0ID0gZ2V0TWFpbk9iamVjdCgpO1xuICAgICAgICBjb25zdCBuZXdUYWJsZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5uZXctdGFibGUnKTtcbiAgICAgICAgbGV0IGNvdW50ZXIgPSAxO1xuICAgICAgICBtYWluT2JqZWN0Lm9yZGVycy5mb3JFYWNoKChpdGVtKSA9PiB7XG5cbiAgICAgICAgICAgIGxldCBpblF1ZXVlID0gJyc7XG4gICAgICAgICAgICBpZiAoaXRlbS5pblF1ZXVlID09PSB0cnVlKSB7XG4gICAgICAgICAgICAgICAgaW5RdWV1ZSA9ICdYJztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGxldCBwcmVwYXJpbmcgPSAnJztcbiAgICAgICAgICAgIGlmIChpdGVtLnByZXBhcmluZyA9PT0gdHJ1ZSkge1xuICAgICAgICAgICAgICAgIHByZXBhcmluZyA9ICdYJztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGxldCBjb21wbGV0ZSA9ICcnO1xuICAgICAgICAgICAgaWYgKGl0ZW0uY29tcGxldGUgPT09IHRydWUpIHtcbiAgICAgICAgICAgICAgICBjb21wbGV0ZSA9ICdYJztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGxldCB0aW1lID0gc2Vjb25kc1RpbWVUb05vcm1hbChpdGVtLmNvbXBsZXRlVGltZSk7XG4gICAgICAgICAgICBpZiAoaXRlbS5kYXRlID09PSBwYXJzZUludChuZXcgRGF0ZSgpLmdldERhdGUoKSkgJiYgaXRlbS5yZW1hZGUgJiYgIWl0ZW0ubWVzc2FnZVNlbnQpIHtcbiAgICAgICAgICAgICAgICBuZXdUYWJsZS5pbnNlcnRBZGphY2VudEhUTUwoJ2JlZm9yZWVuZCcsIGBcbiAgICAgICAgICAgICAgICAgICAgPHRib2R5IGNsYXNzPVwibmV3LXRhYmxlX190Ym9keVwiPlxuICAgICAgICAgICAgICAgICAgICAgICAgPHRyIGNsYXNzPVwibmV3LXRhYmxlX19yb3cgbmV3LXRhYmxlX19vcmRlci1yZW1hZGVcIj5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8dGQgY2xhc3M9XCJuZXctdGFibGVfX2NlbGxcIj4ke2NvdW50ZXIrK308L3RkPlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDx0ZCBjbGFzcz1cIm5ldy10YWJsZV9fY2VsbFwiPiR7aXRlbS5vcmRlck51bWJlcn08L3RkPlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDx0ZCBjbGFzcz1cIm5ldy10YWJsZV9fY2VsbFwiPiR7aW5RdWV1ZX08L3RkPlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDx0ZCBjbGFzcz1cIm5ldy10YWJsZV9fY2VsbFwiPiR7cHJlcGFyaW5nfTwvdGQ+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgPHRkIGNsYXNzPVwibmV3LXRhYmxlX19jZWxsXCI+JHtjb21wbGV0ZX08L3RkPlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDx0ZCBjbGFzcz1cIm5ldy10YWJsZV9fY2VsbFwiPiR7dGltZX08L3RkPlxuICAgICAgICAgICAgICAgICAgICAgICAgPC90cj5cbiAgICAgICAgICAgICAgICAgICAgPC90Ym9keT5gXG4gICAgICAgICAgICAgICAgKTtcblxuICAgICAgICAgICAgfSBlbHNlIGlmIChpdGVtLmRhdGUgPT09IHBhcnNlSW50KG5ldyBEYXRlKCkuZ2V0RGF0ZSgpKSAmJiAhaXRlbS5leHBpcmVkICYmICFpdGVtLm1lc3NhZ2VTZW50KSB7XG4gICAgICAgICAgICAgICAgbmV3VGFibGUuaW5zZXJ0QWRqYWNlbnRIVE1MKCdiZWZvcmVlbmQnLCBgXG4gICAgICAgICAgICAgICAgICAgIDx0Ym9keSBjbGFzcz1cIm5ldy10YWJsZV9fdGJvZHlcIj5cbiAgICAgICAgICAgICAgICAgICAgICAgIDx0ciBjbGFzcz1cIm5ldy10YWJsZV9fcm93IG5ldy10YWJsZV9fb3JkZXItbm9ybWFsXCI+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgPHRkIGNsYXNzPVwibmV3LXRhYmxlX19jZWxsXCI+JHtjb3VudGVyKyt9PC90ZD5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8dGQgY2xhc3M9XCJuZXctdGFibGVfX2NlbGxcIj4ke2l0ZW0ub3JkZXJOdW1iZXJ9PC90ZD5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8dGQgY2xhc3M9XCJuZXctdGFibGVfX2NlbGxcIj4ke2luUXVldWV9PC90ZD5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8dGQgY2xhc3M9XCJuZXctdGFibGVfX2NlbGxcIj4ke3ByZXBhcmluZ308L3RkPlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDx0ZCBjbGFzcz1cIm5ldy10YWJsZV9fY2VsbFwiPiR7Y29tcGxldGV9PC90ZD5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8dGQgY2xhc3M9XCJuZXctdGFibGVfX2NlbGxcIj4ke3RpbWV9PC90ZD5cbiAgICAgICAgICAgICAgICAgICAgICAgIDwvdHI+XG4gICAgICAgICAgICAgICAgICAgIDwvdGJvZHk+YFxuICAgICAgICAgICAgICAgICk7XG5cbiAgICAgICAgICAgIH0gZWxzZSBpZiAoaXRlbS5kYXRlID09PSBwYXJzZUludChuZXcgRGF0ZSgpLmdldERhdGUoKSkgJiYgIWl0ZW0uZXhwaXJlZCAmJiBpdGVtLm1lc3NhZ2VTZW50KSB7XG4gICAgICAgICAgICAgICAgbmV3VGFibGUuaW5zZXJ0QWRqYWNlbnRIVE1MKCdiZWZvcmVlbmQnLCBgXG4gICAgICAgICAgICAgICAgICAgIDx0Ym9keSBjbGFzcz1cIm5ldy10YWJsZV9fdGJvZHlcIj5cbiAgICAgICAgICAgICAgICAgICAgICAgIDx0ciBjbGFzcz1cIm5ldy10YWJsZV9fcm93IG5ldy10YWJsZV9fb3JkZXItd2FybmluZ1wiPlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDx0ZCBjbGFzcz1cIm5ldy10YWJsZV9fY2VsbFwiPiR7Y291bnRlcisrfTwvdGQ+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgPHRkIGNsYXNzPVwibmV3LXRhYmxlX19jZWxsXCI+JHtpdGVtLm9yZGVyTnVtYmVyfTwvdGQ+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgPHRkIGNsYXNzPVwibmV3LXRhYmxlX19jZWxsXCI+JHtpblF1ZXVlfTwvdGQ+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgPHRkIGNsYXNzPVwibmV3LXRhYmxlX19jZWxsXCI+JHtwcmVwYXJpbmd9PC90ZD5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8dGQgY2xhc3M9XCJuZXctdGFibGVfX2NlbGxcIj4ke2NvbXBsZXRlfTwvdGQ+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgPHRkIGNsYXNzPVwibmV3LXRhYmxlX19jZWxsXCI+JHt0aW1lfTwvdGQ+XG4gICAgICAgICAgICAgICAgICAgICAgICA8L3RyPlxuICAgICAgICAgICAgICAgICAgICA8L3Rib2R5PmBcbiAgICAgICAgICAgICAgICApO1xuXG4gICAgICAgICAgICB9IGVsc2UgaWYgKGl0ZW0uZGF0ZSA9PT0gcGFyc2VJbnQobmV3IERhdGUoKS5nZXREYXRlKCkpICYmIGl0ZW0uZXhwaXJlZCAmJiBpdGVtLm1lc3NhZ2VTZW50KSB7XG4gICAgICAgICAgICAgICAgbmV3VGFibGUuaW5zZXJ0QWRqYWNlbnRIVE1MKCdiZWZvcmVlbmQnLCBgXG4gICAgICAgICAgICAgICAgICAgIDx0Ym9keSBjbGFzcz1cIm5ldy10YWJsZV9fdGJvZHlcIj5cbiAgICAgICAgICAgICAgICAgICAgICAgIDx0ciBjbGFzcz1cIm5ldy10YWJsZV9fcm93IG5ldy10YWJsZV9fb3JkZXItZXhwaXJlZFwiPlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDx0ZCBjbGFzcz1cIm5ldy10YWJsZV9fY2VsbFwiPiR7Y291bnRlcisrfTwvdGQ+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgPHRkIGNsYXNzPVwibmV3LXRhYmxlX19jZWxsXCI+JHtpdGVtLm9yZGVyTnVtYmVyfTwvdGQ+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgPHRkIGNsYXNzPVwibmV3LXRhYmxlX19jZWxsXCI+JHtpblF1ZXVlfTwvdGQ+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgPHRkIGNsYXNzPVwibmV3LXRhYmxlX19jZWxsXCI+JHtwcmVwYXJpbmd9PC90ZD5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8dGQgY2xhc3M9XCJuZXctdGFibGVfX2NlbGxcIj4ke2NvbXBsZXRlfTwvdGQ+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgPHRkIGNsYXNzPVwibmV3LXRhYmxlX19jZWxsXCI+JHt0aW1lfTwvdGQ+XG4gICAgICAgICAgICAgICAgICAgICAgICA8L3RyPlxuICAgICAgICAgICAgICAgICAgICA8L3Rib2R5PmBcbiAgICAgICAgICAgICAgICApO1xuXG4gICAgICAgICAgICB9XG5cbiAgICAgICAgfSlcblxuICAgIH0sXG5cbiAgICBzZXRUaW1lcigpIHtcbiAgICAgICAgY29uc3QgbWFpbk9iamVjdCA9IGdldE1haW5PYmplY3QoKTtcbiAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLm5ldy10YWJsZV9fdGJvZHknKS5mb3JFYWNoKChpdGVtKSA9PiB7XG4gICAgICAgICAgICBpZiAoaXRlbS5jaGlsZHJlblswXS5jaGlsZHJlbls0XS5pbm5lckhUTUwubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICAgICAgc2V0SW50ZXJ2YWwoKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBsZXQgdW5peFRpbWUgPSAwO1xuICAgICAgICAgICAgICAgICAgICBsZXQgb3JkZXJOdW1iZXIgPSBwYXJzZUludChpdGVtLmNoaWxkcmVuWzBdLmNoaWxkcmVuWzFdLmlubmVySFRNTCk7XG4gICAgICAgICAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbWFpbk9iamVjdC5vcmRlcnMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChtYWluT2JqZWN0Lm9yZGVyc1tpXS5vcmRlck51bWJlciA9PSBvcmRlck51bWJlcikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVuaXhUaW1lID0gbWFpbk9iamVjdC5vcmRlcnNbaV0udW5peFRpbWU7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgbGV0IGN1cnJlbnRVbml4VGltZSA9IHBhcnNlSW50KG5ldyBEYXRlKCkuZ2V0VGltZSgpIC8gMTAwMCk7XG4gICAgICAgICAgICAgICAgICAgIGl0ZW0uY2hpbGRyZW5bMF0uY2hpbGRyZW5bNV0uaW5uZXJIVE1MID0gc2Vjb25kc1RpbWVUb05vcm1hbChjdXJyZW50VW5peFRpbWUgLSB1bml4VGltZSk7XG4gICAgICAgICAgICAgICAgfSwgMTAwMClcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSlcbiAgICB9LFxuXG4gICAgc2VuZE1lc3NhZ2UobWVzc2FnZSkge1xuICAgICAgICBjb25zdCB4ID0gbmV3IFhNTEh0dHBSZXF1ZXN0KCk7XG4gICAgICAgIHgub3BlbignR0VUJywgJ2h0dHBzOi8vYXBpLnRlbGVncmFtLm9yZy9ib3QxMDE4NzU3MDEzOkFBRUhPOWFjY1Voc2NpZVQwQXJScTlpd1VlYXQ2Qm1Fek9NL3NlbmRNZXNzYWdlP2NoYXRfaWQ9LTEwMDE0NzE2Nzc2MTQmdGV4dD0nICsgbWVzc2FnZSk7XG4gICAgICAgIHguc2VuZCgpO1xuXG5cbiAgICB9XG4gICAgLFxuXG4gICAgc2VuZE1lc3NhZ2VzKCkge1xuICAgICAgICBjb25zdCBtYWluT2JqZWN0ID0gZ2V0TWFpbk9iamVjdCgpO1xuICAgICAgICBtYWluT2JqZWN0Lm9yZGVycy5mb3JFYWNoKChpdGVtKSA9PiB7XG4gICAgICAgICAgICBpZiAoaXRlbS5uZWVkTWVzc2FnZSA9PT0gdHJ1ZSkge1xuICAgICAgICAgICAgICAgIGlmIChtYWluT2JqZWN0LnRlbGVncmFtKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2VuZE1lc3NhZ2UoJ9CX0LDQutCw0LcgJyArIGl0ZW0ub3JkZXJOdW1iZXIgKyAnINCyINC90LDQsdC+0YDQtSDRg9C20LUg0LHQvtC70LXQtSAnICsgbWFpbk9iamVjdC5tZXNzYWdlVGltZSAvIDYwICsgJyDQvNC40L3Rg9GCJyk7XG4gICAgICAgICAgICAgICAgICAgIC8vY29uc29sZS5sb2coJ9CX0LDQutCw0LcgJyArIGl0ZW0ub3JkZXJOdW1iZXIgKyAnINCyINC90LDQsdC+0YDQtSDRg9C20LUg0LHQvtC70LXQtSAnICsgbWFpbk9iamVjdC5leHBpcmF0aW9uVGltZSAvIDYwICsgJyDQvNC40L3Rg9GCJylcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaXRlbS5tZXNzYWdlU2VudCA9IHRydWU7XG4gICAgICAgICAgICAgICAgaXRlbS5uZWVkTWVzc2FnZSA9IGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KVxuICAgICAgICBzZXRNYWluT2JqZWN0KG1haW5PYmplY3QpO1xuICAgICAgICAvL2NvbnNvbGUubG9nKG1haW5PYmplY3QpO1xuICAgIH1cbiAgICAsXG5cbiAgICBzZXRQbGFjZWhvbGRlcnMoKSB7XG4gICAgICAgIGNvbnN0IG1haW5PYmplY3QgPSBnZXRNYWluT2JqZWN0KCk7XG4gICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5vcHRpb25zX190aW1lLXRvLWV4cGlyZScpLnBsYWNlaG9sZGVyID0gbWFpbk9iamVjdC5leHBpcmF0aW9uVGltZSAvIDYwO1xuICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcub3B0aW9uc19fdGltZS10by1zZW5kLW1lc3NhZ2UnKS5wbGFjZWhvbGRlciA9IG1haW5PYmplY3QubWVzc2FnZVRpbWUgLyA2MDtcbiAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLm9wdGlvbnNfX3JlcXVlc3QtaW50ZXJ2YWwnKS5wbGFjZWhvbGRlciA9IG1haW5PYmplY3QucmVxdWVzdEludGVydmFsO1xuICAgIH1cbiAgICAsXG5cbiAgICB0ZWxlZ3JhbUNoZWNrYm94KCkge1xuICAgICAgICBjb25zdCBtYWluT2JqZWN0ID0gZ2V0TWFpbk9iamVjdCgpO1xuICAgICAgICBjb25zdCBjaGVja0JveCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy50ZWxlZ3JhbV9fY2hlY2tib3gnKTtcbiAgICAgICAgaWYgKG1haW5PYmplY3QudGVsZWdyYW0pIHtcbiAgICAgICAgICAgIGNoZWNrQm94LnNldEF0dHJpYnV0ZSgnY2hlY2tlZCcsICd0cnVlJyk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBjaGVja0JveC5yZW1vdmVBdHRyaWJ1dGUoJ2NoZWNrZWQnKTtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBpbnN0cnVjdGlvbigpIHtcbiAgICAgICAgY29uc3QgbWFpbk9iamVjdCA9IGdldE1haW5PYmplY3QoKTtcbiAgICAgICAgY29uc3QgZGVzYyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5pbnRyb2R1Y3Rpb25fX2Rlc2MnKTtcbiAgICAgICAgY29uc3QgYnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmludHJvZHVjdGlvbl9fYnV0dG9uJyk7XG4gICAgICAgIGNvbnN0IGJveCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5pbnRyb2R1Y3Rpb25fX2JveCcpO1xuICAgICAgICBjb25zdCBvdXRlciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5pbnRyb2R1Y3Rpb25fX291dGVyJyk7XG4gICAgICAgIGlmIChtYWluT2JqZWN0Lmluc3RydWN0aW9uKSB7XG4gICAgICAgICAgICBib3guc3R5bGUuZGlzcGxheSA9ICdibG9jayc7XG4gICAgICAgICAgICBvdXRlci5zdHlsZS5kaXNwbGF5ID0gJ2Jsb2NrJztcbiAgICAgICAgICAgIGRlc2MudGV4dENvbnRlbnQgPSAn0YHQstC10YDQvdGD0YLRjCDQuNC90YHRgtGA0YPQutGG0LjRjic7XG4gICAgICAgICAgICBidXR0b24udGV4dENvbnRlbnQgPSAnLSc7XG4gICAgICAgIH1cbiAgICB9XG59IiwiY29uc3QgY29udHJvbGxlciA9IHtcbiAgICBtYWluUm91dGUoKSB7XG4gICAgICAgIGxldCBpbnRlcnZhbCA9IDEwO1xuICAgICAgICBpZiAoaXNNYWluT2JqZWN0RXhpc3RzKCkpIHtcbiAgICAgICAgICAgIGNvbnN0IG1haW5PYmplY3QgPSBnZXRNYWluT2JqZWN0KCk7XG4gICAgICAgICAgICBpbnRlcnZhbCA9IG1haW5PYmplY3QucmVxdWVzdEludGVydmFsO1xuICAgICAgICB9XG5cbiAgICAgICAgbW9kZWwuY2FsbEV4dGVybmFsQ29udGVudCgpXG4gICAgICAgICAgICAudGhlbigocmVzcG9uc2UpID0+IHtcbiAgICAgICAgICAgICAgICBtb2RlbC5nZXRDb250ZW50KHJlc3BvbnNlKTtcbiAgICAgICAgICAgICAgICBtb2RlbC5zZXRXYXJuaW5nKCk7XG4gICAgICAgICAgICAgICAgdmlldy5pbnN0cnVjdGlvbigpO1xuICAgICAgICAgICAgICAgIHZpZXcuc2VuZE1lc3NhZ2VzKCk7XG4gICAgICAgICAgICAgICAgdmlldy5kcmF3VGFibGUoKTtcbiAgICAgICAgICAgICAgICB2aWV3LnNldFRpbWVyKCk7XG4gICAgICAgICAgICAgICAgdmlldy50ZWxlZ3JhbUNoZWNrYm94KCk7XG4gICAgICAgICAgICAgICAgdmlldy5zZXRQbGFjZWhvbGRlcnMoKTtcbiAgICAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaW50ZXJ2YWwnKS5zY3JvbGxJbnRvVmlldygpO1xuICAgICAgICAgICAgfSlcblxuICAgICAgICB3aW5kb3cuc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgICAgICAvL3RoaXMubWFpblJvdXRlKCk7XG4gICAgICAgICAgICB3aW5kb3cubG9jYXRpb24ucmVsb2FkKCk7XG4gICAgICAgIH0sIGludGVydmFsICogMTAwMCk7XG4gICAgfVxufSIsImRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJET01Db250ZW50TG9hZGVkXCIsICgpID0+IHtcbmNvbnRyb2xsZXIubWFpblJvdXRlKCk7XG59KVxuIiwiLy/Rg9GB0YLQsNC90LDQstC70LjQstCw0LXQvCDQuNC90YLQtdGA0LLQsNC7LCDQstGA0LXQvNGPINGB0L7QvtCx0YnQtdC90LjRjywg0LLRgNC10LzRjyDQtNC+INC/0YDQvtGB0YDQvtGH0LrQuFxuZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLm9wdGlvbnNfX3RpbWUtdG8tZXhwaXJlLWJ1dHRvbicpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGUpID0+IHtcbiAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgY29uc3QgZXhwaXJlVGV4dEFyZWEgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcub3B0aW9uc19fdGltZS10by1leHBpcmUnKTtcbiAgICBpZiAoZXhwaXJlVGV4dEFyZWEudmFsdWUgJiYgIWlzTmFOKGV4cGlyZVRleHRBcmVhLnZhbHVlKSkge1xuICAgICAgICBjb25zdCBtYWluT2JqZWN0ID0gZ2V0TWFpbk9iamVjdCgpO1xuICAgICAgICBtYWluT2JqZWN0LmV4cGlyYXRpb25UaW1lID0gcGFyc2VJbnQoZXhwaXJlVGV4dEFyZWEudmFsdWUpICogNjA7XG4gICAgICAgIHNldE1haW5PYmplY3QobWFpbk9iamVjdCk7XG4gICAgICAgIGV4cGlyZVRleHRBcmVhLnBsYWNlaG9sZGVyID0gZXhwaXJlVGV4dEFyZWEudmFsdWU7XG4gICAgICAgIGV4cGlyZVRleHRBcmVhLnZhbHVlID0gJyc7XG4gICAgfSBlbHNlIHtcbiAgICAgICAgY29uc3QgbWVzc2FnZUJveCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5vcHRpb25zX19tZXNzYWdlLWJveC10aW1lLXRvLWV4cGlyZScpO1xuICAgICAgICBtZXNzYWdlQm94LnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snO1xuICAgICAgICBleHBpcmVUZXh0QXJlYS52YWx1ZSA9ICcnO1xuICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgICAgIG1lc3NhZ2VCb3guc3R5bGUuZGlzcGxheSA9ICdub25lJztcbiAgICAgICAgfSwgMTAwMClcbiAgICB9XG59KVxuXG5kb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcub3B0aW9uc19fdGltZS10by1zZW5kLW1lc3NhZ2UtYnV0dG9uJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoZSkgPT4ge1xuICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICBjb25zdCBtZXNzYWdlVGV4dEFyZWEgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcub3B0aW9uc19fdGltZS10by1zZW5kLW1lc3NhZ2UnKTtcbiAgICBpZiAobWVzc2FnZVRleHRBcmVhLnZhbHVlICYmICFpc05hTihtZXNzYWdlVGV4dEFyZWEudmFsdWUpKSB7XG4gICAgICAgIGNvbnN0IG1haW5PYmplY3QgPSBnZXRNYWluT2JqZWN0KCk7XG4gICAgICAgIG1haW5PYmplY3QubWVzc2FnZVRpbWUgPSBwYXJzZUludChtZXNzYWdlVGV4dEFyZWEudmFsdWUpICogNjA7XG4gICAgICAgIG1lc3NhZ2VUZXh0QXJlYS5wbGFjZWhvbGRlciA9IG1lc3NhZ2VUZXh0QXJlYS52YWx1ZTtcbiAgICAgICAgbWVzc2FnZVRleHRBcmVhLnZhbHVlID0gJyc7XG4gICAgICAgIHNldE1haW5PYmplY3QobWFpbk9iamVjdCk7XG4gICAgfSBlbHNlIHtcbiAgICAgICAgY29uc3QgbWVzc2FnZUJveCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5vcHRpb25zX19tZXNzYWdlLWJveC10aW1lLXRvLXNlbmQtbWVzc2FnZScpO1xuICAgICAgICBtZXNzYWdlQm94LnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snO1xuICAgICAgICBtZXNzYWdlVGV4dEFyZWEudmFsdWUgPSAnJztcbiAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgICAgICBtZXNzYWdlQm94LnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7XG4gICAgICAgIH0sIDEwMDApXG4gICAgfVxufSlcblxuZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLm9wdGlvbnNfX3JlcXVlc3QtaW50ZXJ2YWwtYnV0dG9uJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoZSkgPT4ge1xuICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICBjb25zdCByZXF1ZXN0VGV4dEFyZWEgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcub3B0aW9uc19fcmVxdWVzdC1pbnRlcnZhbCcpO1xuICAgIGlmIChyZXF1ZXN0VGV4dEFyZWEudmFsdWUgJiYgIWlzTmFOKHJlcXVlc3RUZXh0QXJlYS52YWx1ZSkgJiYgcGFyc2VJbnQocmVxdWVzdFRleHRBcmVhLnZhbHVlKSA+PSAxMCkge1xuICAgICAgICBjb25zdCBtYWluT2JqZWN0ID0gZ2V0TWFpbk9iamVjdCgpO1xuICAgICAgICBtYWluT2JqZWN0LnJlcXVlc3RJbnRlcnZhbCA9IHBhcnNlSW50KHJlcXVlc3RUZXh0QXJlYS52YWx1ZSk7XG4gICAgICAgIHJlcXVlc3RUZXh0QXJlYS5wbGFjZWhvbGRlciA9IHJlcXVlc3RUZXh0QXJlYS52YWx1ZTtcbiAgICAgICAgcmVxdWVzdFRleHRBcmVhLnZhbHVlID0gJyc7XG4gICAgICAgIHNldE1haW5PYmplY3QobWFpbk9iamVjdCk7XG4gICAgfSBlbHNlIHtcbiAgICAgICAgY29uc3QgbWVzc2FnZUJveCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5vcHRpb25zX19tZXNzYWdlLWJveC1yZXF1ZXN0LWludGVydmFsJyk7XG4gICAgICAgIG1lc3NhZ2VCb3guc3R5bGUuZGlzcGxheSA9ICdibG9jayc7XG4gICAgICAgIHJlcXVlc3RUZXh0QXJlYS52YWx1ZSA9ICcnO1xuICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgICAgIG1lc3NhZ2VCb3guc3R5bGUuZGlzcGxheSA9ICdub25lJztcbiAgICAgICAgfSwgMTAwMClcbiAgICB9XG59KVxuXG5kb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcucmVzZXQnKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChlKSA9PiB7XG4gICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIGNvbnN0IG1zZyA9IHByb21wdCgn0JTQtdC50YHRgtCy0LjRgtC10LvRjNC90L4/INCS0YHQtSDQtNCw0L3QvdGL0LUg0YPQtNCw0LvRj9GC0YHRjyEg0JTQu9GPINC/0YDQvtC00L7Qu9C20LXQvdC40Y8g0LLQstC10LTQuNGC0LUgXCLQo9CU0JDQm9CY0KLQrCFcIiDQsdC+0LvRjNGI0LjQvNC4INCx0YPQutCy0LDQvNC4Jyk7XG4gICAgaWYgKG1zZyA9PT0gJ9Cj0JTQkNCb0JjQotCsIScpIHtcbiAgICAgICAgbG9jYWxTdG9yYWdlLmNsZWFyKCk7XG4gICAgICAgIHdpbmRvdy5sb2NhdGlvbi5yZWxvYWQoKTtcbiAgICB9XG5cblxufSlcblxuZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignc2Nyb2xsJywgKCkgPT4ge1xuICAgIGNvbnN0IGhlYWRlciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5uZXctdGFibGVfX2hlYWRlci13aGl0ZS1iZycpO1xuICAgIGlmICh3aW5kb3cuc2Nyb2xsWSA+IGhlYWRlci5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKS55KSB7XG4gICAgICAgIGhlYWRlci5zdHlsZS5wb3NpdGlvbiA9ICdmaXhlZCc7XG4gICAgICAgIGhlYWRlci5zdHlsZS50b3AgPSAnMCc7XG4gICAgfSBlbHNlIHtcbiAgICAgICAgaGVhZGVyLnN0eWxlLnBvc2l0aW9uID0gJ3N0YXRpYyc7XG4gICAgfVxufSlcblxuZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnRlbGVncmFtX19jaGVja2JveCcpLmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsICgpID0+IHtcbiAgICBjb25zdCBtYWluT2JqZWN0ID0gZ2V0TWFpbk9iamVjdCgpO1xuICAgIGNvbnN0IGNoZWNrQm94ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnRlbGVncmFtX19jaGVja2JveCcpO1xuICAgIG1haW5PYmplY3QudGVsZWdyYW0gPSAhIWNoZWNrQm94LmNoZWNrZWQ7XG4gICAgc2V0TWFpbk9iamVjdChtYWluT2JqZWN0KTtcbn0pXG5cbmRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5pbnRyb2R1Y3Rpb25fX2xpbmsnKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGRlcGxveUluc3RydWN0aW9uKTsiXX0=
