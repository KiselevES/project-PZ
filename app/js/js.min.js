class mainObjectClass {
    constructor() {
        //интервал запросов
        this.requestInterval = 10 * 1000;

        //время отправки сообщения (переаодим в сек)
        this.messageTime = 23 * 60;

        //время до просрочки (переводим в сек)
        this.expirationTime = 30 * 60;

        //дата
        const currentDate = new Date();
        this.currentDate = currentDate.getDate();

        //пустой массив под заказы
        this.orders = [];
    }
}
class orderClass {
    constructor(orderNumber) {
        this.unixTime = parseInt(new Date().getTime() / 1000);
        this.date = parseInt(new Date().getDate());
        this.expired = false;
        this.messageSent = false;
        this.complete = false;
        this.completeTime = 0;
        this.inQueue = false;
        this.preparing = false;
        this.orderNumber = orderNumber;
        this.needMessage = false;
        this.remade = false;
    }

    setExpired() {
        this.expired = true;
    }

    setMessageSent() {
        this.messageSent = true;
        this.needMessage = false;
    }

    setNeedMessage(){
        this.needMessage = true;
    }

    setTime(time) {
        this.completeTime = time - this.unixTime;
    }

    setQueue() {
        this.inQueue = true;
        this.preparing = false;
    }

    setPreparing() {
        this.preparing = true;
        this.inQueue = false;
    }

    setComplete() {
        this.complete = true;
        this.preparing = false;
        this.inQueue = false;
    }

    setRemade(){
        this.Complete = false;
        this.Remade = true;
    }

}

function getMainObject() {
    return JSON.parse(localStorage.getItem('mainObject'));
}

function isMainObjectExists() {
    return localStorage.getItem('mainObject') !== null;
}

function setMainObject(mainObject) {
    localStorage.setItem('mainObject', JSON.stringify(mainObject));
}

function ismainObjectContainsOrder(mainObject, orderNumber) {
    for (let i = 0; i < mainObject.orders.length; i++) {
        if (mainObject.orders[i].orderNumber === orderNumber) {
            return true;
        }
    }
    return false;
}

function getSameOrder(newContentObject, orderNumber) {
    for (let i = 0; i < newContentObject.orders.length; i++) {
        if (newContentObject.orders[i].orderNumber === orderNumber) {
            return newContentObject.orders[i].orderNumber;
        }
    }
    return false;
}

function isOrderRemade(mainObject, orderNumber) {
    for (let i = 0; i < mainObject.orders.length; i++) {
        if (mainObject.orders[i].orderNumber === orderNumber && mainObject.orders[i].complete === true) {
            return true;
        }
    }
    return false;
}

function secondsTimeToNormal(seconds) {
    let minutes = Math.floor(seconds / 60) + '';
    let secs = seconds % 60 + '';
    if (secs.length < 2) {
        secs = '0' + secs;
    }
    return result = minutes + ':' + secs
}
document.addEventListener("DOMContentLoaded", () => {
    function setContentHeight() {
        const header = document.querySelector('.header');
        const wrapper = document.querySelector('.wrapper');
        const footer = document.querySelector('.footer');
        const setHeightContainer = document.querySelector('.set-height');
        const neededHeight = wrapper.offsetHeight - header.offsetHeight - footer.offsetHeight;

        if (setHeightContainer.offsetHeight < neededHeight) {
            setHeightContainer.style.height = neededHeight + 'px';
        }
    }

    setContentHeight();
    window.addEventListener('resize', setContentHeight);
})



const model = {


    callExternalContent() {
        return new Promise((resolve, reject) => {
            const x = new XMLHttpRequest();

            //ajax запрос через прокси cors-anywhere
            //x.open('GET', 'https://cors-anywhere.herokuapp.com/https://akson.ru/personal/order/table1/?STORE_ID=11');
            x.open('GET', 'pz4.html');

            //x.timeout = 5000;
            x.send();
            x.onload = () => {
                if (x.status != 200) {
                    reject(x.statusText)
                } else {
                    resolve(x.responseText || '');
                }
            };
        })
    },
    //
    getContent(externalContent) {
        //вытаскиваем таблицу из исходного кода
        const cutExternalContent = externalContent.substr(3196, externalContent.length - 3370);
        //console.log(cutExternalContent);
        const hiddenTable = document.querySelector('.hidden-table');
        hiddenTable.innerHTML = cutExternalContent;
        //вытаскиваем строки
        const rows = document.getElementsByTagName('tr');
        //переменная для строк фильтрованной таблицы
        let filteredRows = [];

        //удаляем строки заголовков таблиц, удаляем отмененные заказы, формируем одну таблицу из двух
        for (let i = 0; i < rows.length; i++) {
            if (rows[i].innerHTML.length !== 377) {
                if (rows[i].children[3].innerHTML.length > 100) {
                    rows[i].parentNode.removeChild(rows[i]);
                } else {
                    filteredRows.push(rows[i]);
                }
            }
        }
        //удаляем четвертую ячейку
        for (let i = 0; i < filteredRows.length; i++) {
            filteredRows[i].removeChild(filteredRows[i].children[3]);
        }

        const newContentObject = new mainObjectClass();
        filteredRows.forEach((item) => {
            const orderNumber = parseInt(item.children[0].children[0].children[0].innerHTML);
            const order = new orderClass(orderNumber);
            //console.log(item.children[1].children[0].innerHTML.length);
            if (item.children[1].children[0].innerHTML.length > 30) {
                order.setQueue();
            } else if (item.children[2].children[0].innerHTML.length > 30) {
                order.setPreparing();
            }
            newContentObject.orders.push(order);
        })

        //удаляем таблицу
        hiddenTable.innerHTML = '';

        if (!isMainObjectExists()) {
            setMainObject(newContentObject);
            this.getContent(externalContent);
        } else {
            const notFormattedmainObject = getMainObject();
            const mainObject = new mainObjectClass();

            mainObject.requestInterval = notFormattedmainObject.requestInterval;
            mainObject.messageTime = notFormattedmainObject.messageTime;
            mainObject.expirationTime = notFormattedmainObject.expirationTime;

            notFormattedmainObject.orders.forEach((item) => {
                let currentOrder = new orderClass(item.orderNumber);
                currentOrder.expired = item.expired;
                currentOrder.messageSent = item.messageSent;
                currentOrder.complete = item.complete;
                currentOrder.completeTime = item.completeTime;
                currentOrder.inQueue = item.inQueue;
                currentOrder.preparing = item.preparing;
                currentOrder.remade = item.remade;
                currentOrder.unixTime = item.unixTime;
                currentOrder.date = item.date;
                currentOrder.needMessage = item.needMessage;
                mainObject.orders.push(currentOrder);
            })


            // Добавляем новые заказы
            newContentObject.orders.forEach((item, i) => {
                if (!ismainObjectContainsOrder(mainObject, item.orderNumber)) {
                    mainObject.orders.push(newContentObject.orders[i]);
                }
            })
            //если старого заказа нет в списке заказов нового объекта, помечаем старый подтвержденным
            mainObject.orders.forEach((item) => {
                if (!getSameOrder(newContentObject, item.orderNumber)) {
                    item.setComplete();
                }
            })
            //получаем перевыгруженные заказы
            newContentObject.orders.forEach((item) => {
                if (isOrderRemade(mainObject, item.orderNumber)) {
                    for (let i = 0; i < mainObject.orders.length; i++) {
                        if (mainObject.orders[i].orderNumber === item.orderNumber) {
                            mainObject.orders[i].setRemade();
                            mainObject.orders[i].expired = item.expired;
                            mainObject.orders[i].messageSent = false;
                            mainObject.orders[i].unixTime = parseInt(new Date().getTime() / 1000);
                            mainObject.orders[i].complete = false;
                            mainObject.orders[i].completeTime = 0;
                            mainObject.orders[i].inQueue = item.inQueue;
                            mainObject.orders[i].preparing = item.preparing;
                            mainObject.orders[i].date = item.date;
                            mainObject.orders[i].needMessage = item.needMessage;
                        }
                    }
                }
            })

            //задаем время наборки
            mainObject.orders.forEach((item) => {
                if (item.complete === false) {
                    item.setTime(parseInt(new Date().getTime() / 1000));
                }
            })

            //проверяем на просрочку

            mainObject.orders.forEach((item) => {
                if (item.completeTime > mainObject.expirationTime) {
                    item.setExpired();
                }
            })

            //удаляем заказы возрастом более 10 дней
            for (let i = mainObject.orders.length - 1; i >= 0; i--) {
                if (parseInt(new Date().getTime() / 1000) - mainObject.orders[i].unixTime > 864000) {
                    mainObject.orders.splice(i, 1);
                }
            }


            setMainObject(mainObject);
            console.log(mainObject);
        }
    },

    getWarning() {
        const mainObject = getMainObject();
        mainObject.orders.forEach((item) => {
            if (parseInt(new Date().getTime() / 1000) - item.unixTime > mainObject.messageTime) {
                item.needMessage = true;
            }
        })
        setMainObject(mainObject);
    }
}
view = {
    drawTable() {
        const mainObject = getMainObject();
        const newTable = document.querySelector('.new-table');
        newTable.innerHTML = '';
        // const tableHeader = document.createElement('tr');
        // tableHeader.classList.add('new-table__header');
        // newTable.appendChild(tableHeader);
        // const tableHeaderCellNumber = document.createElement('th');
        // tableHeaderCellNumber.classList.add('new-table__header-cell');
        // tableHeaderCellNumber.textContent= '№';
        // tableHeader.appendChild(tableHeaderCellNumber);
        // const tableHeaderCellOrderNumber = document.createElement('th');
        // tableHeaderCellOrderNumber.classList.add('new-table__header-cell');
        // tableHeaderCellOrderNumber.textContent = '№ заказа';
        // tableHeader.appendChild(tableHeaderCellOrderNumber);
        // const tableHeaderOrderInQueue = document.createElement('th');
        // tableHeaderOrderInQueue.classList.add('new-table__header-cell');
        // tableHeaderOrderInQueue.textContent='В очереди';
        // tableHeader.appendChild(tableHeaderOrderInQueue);
        // const tableHeaderOrderIsPreparing = document.createElement('tr');
        // tableHeaderOrderIsPreparing.classList.add('new-table__header-cell');
        // tableHeaderOrderIsPreparing.textContent = 'В наборе';
        // tableHeader.appendChild(tableHeaderOrderIsPreparing);
        // const tableHeaderTime = document.createElement('tr');
        // tableHeaderTime.classList.add('new-table__header-cell');
        // tableHeaderTime.textContent = 'Время набора';
        // tableHeader.appendChild(tableHeaderTime);


        newTable.insertAdjacentHTML('beforeend', '' +
            '                 <thead>' +
            '                    <tr class="new-table__header">\n' +
            '                        <th class="new-table__header-cell">№</th>\n' +
            '                        <th class="new-table__header-cell">Номер заказа</th>\n' +
            '                        <th class="new-table__header-cell">В очереди</th>\n' +
            '                        <th class="new-table__header-cell">В наборе</th>\n' +
            '                        <th class="new-table__header-cell">Завершен</th>\n' +
            '                        <th class="new-table__header-cell">Время</th>\n' +
            '                    </tr>' +
            '                 </thead>');

        let counter = 1;
        mainObject.orders.forEach((item) => {

            let inQueue = '';
            if (item.inQueue === true) {
                inQueue = 'X';
            }
            let preparing = '';
            if (item.preparing === true) {
                preparing = 'X';
            }
            let complete = '';
            if (item.complete === true) {
                complete = 'X';
            }
            let time = secondsTimeToNormal(item.completeTime);
            if (item.date === parseInt(new Date().getDate()) && item.expired === false && item.messageSent === false) {
                newTable.insertAdjacentHTML('beforeend', `
                    <tbody>
                        <tr class="new-table__row">
                            <td class="new-table__cell">${counter}</td>
                            <td class="new-table__cell">${item.orderNumber}</td>
                            <td class="new-table__cell">${inQueue}</td>
                            <td class="new-table__cell">${preparing}</td>
                            <td class="new-table__cell">${complete}</td>
                            <td class="new-table__cell">${time}</td>
                        </tr>
                    </tbody>`
                )
            } else if (item.date === parseInt(new Date().getDate()) && item.expired === false && item.messageSent === true) {
                newTable.insertAdjacentHTML('beforeend', `
                    <tbody class="new-table__order-warning">
                        <tr class="new-table__row">
                            <td class="new-table__cell">${counter}</td>
                            <td class="new-table__cell">${item.orderNumber}</td>
                            <td class="new-table__cell">${inQueue}</td>
                            <td class="new-table__cell">${preparing}</td>
                            <td class="new-table__cell">${complete}</td>
                            <td class="new-table__cell">${time}</td>
                        </tr>
                    </tbody>`
                )
            } else if (item.date === parseInt(new Date().getDate()) && item.expired === true && item.messageSent === true) {
                newTable.insertAdjacentHTML('beforeend', `
                    <tbody class="new-table__order-expired">
                        <tr class="new-table__row">
                            <td class="new-table__cell">${counter}</td>
                            <td class="new-table__cell">${item.orderNumber}</td>
                            <td class="new-table__cell">${inQueue}</td>
                            <td class="new-table__cell">${preparing}</td>
                            <td class="new-table__cell">${complete}</td>
                            <td class="new-table__cell">${time}</td>
                        </tr>
                    </tbody>`
                )

            }
            counter++;
        })

    },

    sendMessage(message) {
        return new Promise((resolve, reject) => {
            const x = new XMLHttpRequest();
            x.open('GET', 'https://api.telegram.org/bot1018757013:AAEHO9accUhscieT0ArRq9iwUeat6BmEzOM/sendMessage?chat_id=-1001471677614&text=' + message);
            x.send();
            x.onload = () => {
                if (x.status != 200) {
                    reject(x.statusText)
                } else {
                    resolve(x.responseText || '');
                }
            };
        })
    },

    sendMessages() {
        const mainObject = getMainObject();
        mainObject.orders.forEach((item) => {
            if (item.needMessage === true) {
                this.sendMessage('Заказ ' + item.orderNumber + ' в наборе уже более ' + mainObject.expirationTime / 60 + ' минут');
                mainObject.messageSent = true;
                mainObject.needMessage = false;
            }
        })
        setMainObject(mainObject);
    }
}

document.addEventListener("DOMContentLoaded", () => {

    model.callExternalContent()
        .then((response) => {
            model.getContent(response);
            model.getWarning();
            view.sendMessages();
            view.drawTable();
        })









    // // Функция перевода количества секунд в минуты и секунды
//     function unixTimeToNormal(seconds) {
//         let minutes = Math.floor(seconds / 60) + '';
//         let secs = seconds % 60 + '';
//         if (secs.length < 2) {
//             secs = '0' + secs;
//         }
//         return result = minutes + ':' + secs
//     }
//
// //---добавляем функцию проверки наличия заказа в session storage
//     function isOrderNumberInSessionStorage(orderNumber) {
//         if (sessionStorage.getItem(orderNumber)) {
//             return true;
//         } else {
//             return false;
//         }
//     }
//
// //функция проверяет наличие заказа в строке "отправить" в session storage
//     function isAddedToSendString(orderNumber) {
//         let text = sessionStorage.getItem('to-send');
//         if (text) {
//             let ordersArray = text.split('|');
//             for (i = 0; i < ordersArray.length; i++) {
//                 if (orderNumber === parseInt(ordersArray[i])) {
//                     return true
//                 }
//             }
//         }
//     }
//
// //Функция оверяет наличие заказа в строке просроченных в session storage
//     function isAdded(orderNumber) {
//         let text = sessionStorage.getItem('expired');
//         if (text) {
//             let ordersArray = text.split('|');
//             for (i = 0; i < ordersArray.length; i++) {
//                 if (orderNumber === parseInt(ordersArray[i])) {
//                     return true
//                 }
//             }
//         }
//         return false
//     }
//
// //Функция получения данных
//     function callExternalContent() {
//         return new Promise((resolve, reject) => {
//             const x = new XMLHttpRequest();
//
//             //ajax запрос через прокси cors-anywhere
//             x.open('GET', 'https://cors-anywhere.herokuapp.com/https://akson.ru/personal/order/table1/?STORE_ID=11');
//             //x.open('GET', 'pz.html');
//             //x.open('GET', 'pz2.html');
//             //x.timeout = 5000;
//             x.send();
//             x.onload = () => {
//                 if (x.status != 200) {
//                     reject(x.statusText)
//                 } else {
//                     resolve(x.responseText || '');
//                 }
//             };
//         })
//     }
//
// //Функция проверки наличия строки expired в session storage
//     function doesSessionStorageContainsExpiredString() {
//         if (sessionStorage.getItem('expired')) {
//             return true;
//         } else {
//             return false
//         }
//     }
//
// //Функция проверки наличия строки "отправить" в session storage
//     function doesSessionStorageContainsToSendString() {
//         if (sessionStorage.getItem('to-send')) {
//             return true;
//         } else {
//             return false
//         }
//     }
//
// //Функция проверки наличия строки "отправлено" в session storage
//     function doesSessionStorageContainsSentString() {
//         if (sessionStorage.getItem('sent')) {
//             return true;
//         } else {
//             return false
//         }
//     }
//
// //Функция отправки сообщения в Telegram канал
//     function sendMessage(message) {
//         return new Promise((resolve, reject) => {
//             const x = new XMLHttpRequest();
//             x.open('GET', 'https://api.telegram.org/bot1018757013:AAEHO9accUhscieT0ArRq9iwUeat6BmEzOM/sendMessage?chat_id=-1001471677614&text=' + message);
//             x.send();
//             x.onload = () => {
//                 if (x.status != 200) {
//                     reject(x.statusText)
//                 } else {
//                     resolve(x.responseText || '');
//                 }
//             };
//         })
//     }
//
// //время до просрочки в секундах
//     let timeToExpire = 1800;
//     const timeToExpireInput = document.querySelector('.options__time-to-expire');
//     const timeToExpireButton = document.querySelector('.options__time-to-expire-button');
//     timeToExpireButton.addEventListener('click', (e) => {
//         e.preventDefault();
//         timeToExpire = timeToExpireInput.value * 60;
//     })
//
// //время до отправки сообщения в секундах
//     let timeToSendMessage = 20;
//
// //временной интервал между запросами на сервер
//     let requestInterval = 10;
//
// //массив с заказами для отправки сообщения
//     let ordersToTelegram = [];
//
// //переменная для получения исходных данных
//     let externalContent = '';
//
// //создаем переменную для скрытой исходной таблицы
//     const table = document.querySelector('.table');
//
// //здаем переменную для строки просроченных заказов
//     const expiredOrders = document.querySelector('.expired-orders');
//
//
//     //последовательность асинхронных операций
//     callExternalContent()
//         .then(result => {
//                 externalContent = result;
//             },
//             error => console.log('Error' + ': ' + error))
//         .then(() => {
//             //вытаскиваем таблицу из исходного кода
//             externalContent = externalContent.substr(3476, externalContent.length - 3704);
//             table.innerHTML = externalContent;
//             //вытаскиваем строки
//             const rows = document.getElementsByTagName('tr');
//             //переменная для строк фильтрованной таблицы
//             let filteredRows = [];
//
//             //удаляем строки заголовков таблиц, удаляем отмененные заказы, формируем одну таблицу из двух
//             for (i = 0; i < rows.length; i++) {
//                 if (rows[i].innerHTML.length !== 377) {
//                     if (rows[i].children[3].innerHTML.length > 100) {
//                         rows[i].parentNode.removeChild(rows[i]);
//                     } else {
//                         filteredRows.push(rows[i]);
//                     }
//                 }
//             }
//
//             //удаляем четвертую ячейку
//             for (i = 0; i < filteredRows.length; i++) {
//                 filteredRows[i].removeChild(filteredRows[i].children[3]);
//
//                 //добавляем ячейку со временем
//                 let timeItem = document.createElement('td');
//                 filteredRows[i].appendChild(timeItem);
//             }
//
//             //рендерим таблицу
//             const filteredTable = document.querySelector('.filtered-table');
//             for (i = 0; i < filteredRows.length; i++) {
//                 filteredTable.innerHTML += filteredRows[i].innerHTML;
//             }
//
//             //Проверяем наличие заказа в session storage, добавляем заказ если его нет, проверяем время наборки
//             for (i = 0; i < filteredTable.children.length; i++) {
//                 //console.log(filteredTable);
//                 //получаем номер заказа из таблицы
//                 let orderNumber = parseInt(filteredTable.children[i].children[0].children[0].children[0].children[0].innerHTML);
//
//                 //проверяем наличие заказа в session storage
//                 //---если заказа нет, добавляем в session storage его номер как ключ и unixtime как значение
//                 if (!isOrderNumberInSessionStorage(orderNumber)) {
//                     sessionStorage.setItem(orderNumber, parseInt(new Date().getTime() / 1000));
//                     // --- устанавливаем время в четвертый столбец
//                     filteredTable.children[i].children[0].children[3].innerHTML = '0:00';
//                 } else {
//                     //если заказ есть, обновляем время
//                     let seconds = parseInt(new Date().getTime() / 1000) - sessionStorage.getItem(orderNumber);
//                     filteredTable.children[i].children[0].children[3].innerHTML = unixTimeToNormal(seconds);
//
//                     //если пора отправлять сообщение, отправляем его в session storage
//                     if (seconds > timeToSendMessage) {
//                         if (!isAddedToSendString(orderNumber)) {
//                             if (doesSessionStorageContainsToSendString()) {
//                                 sessionStorage.setItem('to-send', sessionStorage.getItem('to-send') + '|' + orderNumber);
//                             } else {
//                                 sessionStorage.setItem('to-send', orderNumber);
//                             }
//                         }
//                     }
//
//                     //если заказ просрочен, отправляем его в session storage
//                     if (seconds > timeToExpire) {
//                         if (!isAdded(orderNumber)) {
//                             if (doesSessionStorageContainsExpiredString()) {
//                                 sessionStorage.setItem('expired', sessionStorage.getItem('expired') + '|' + orderNumber);
//                             } else {
//                                 sessionStorage.setItem('expired', orderNumber);
//                             }
//                         }
//                     }
//                 }
//             }
//             //Формируем строку с просроченными заказами
//             if (doesSessionStorageContainsExpiredString()) {
//                 let text = sessionStorage.getItem('expired');
//                 text = text.split('|');
//                 let createdText = '';
//                 for (i = 0; i < text.length; i++) {
//                     createdText += ", " + text[i];
//                 }
//                 createdText = createdText.substr(2);
//                 expiredOrders.innerHTML = createdText;
//             }
// //Проверяем, отправлены ли сообщения по заказам
//             if (doesSessionStorageContainsToSendString()) {
//                 let ordersToSend = sessionStorage.getItem('to-send');
//                 let ordersToSendArray = ordersToSend.split('|');
//                 if (doesSessionStorageContainsSentString()) {
//                     let sentOrders = sessionStorage.getItem('sent');
//                     let sentOrdersArray = sentOrders.split('|');
//                     for (i = 0; i < ordersToSendArray.length; i++) {
//                         for (j = 0; j < sentOrdersArray.length; j++) {
//                             if (ordersToSendArray[i] == sentOrdersArray[j]) {
//                                 ordersToSendArray.splice(i, 1);
//                             }
//                         }
//                     }
//                 }
//                 if (ordersToSendArray) {
//                     ordersToTelegram = ordersToSendArray;
//                 }
//             }
//
//         })
//         .then(() => {
//             if (ordersToTelegram) {
//                 for (i = 0; i < ordersToTelegram.length; i++) {
//                     console.log('Заказ ' + ordersToTelegram[i] + ' в наборе уже ' + timeToSendMessage / 60 + ' минут');
//                     //sendMessage('Заказ ' + ordersToTelegram[i] + ' в наборе уже ' + timeToSendMessage/60 + ' минут');
//                     if (doesSessionStorageContainsSentString()) {
//                         sessionStorage.setItem('sent', sessionStorage.getItem('sent') + '|' + ordersToTelegram[i]);
//                     } else {
//                         sessionStorage.setItem('sent', ordersToTelegram[i]);
//                     }
//                 }
//             }
//         })
//          .then(() => {
//              window.setTimeout(() => document.location.reload(), 10000);
//          })
})

//устанавливаем интервал, время сообщения, время до просрочки
document.querySelector('.options__time-to-expire-button').addEventListener('click', (e) => {
    e.preventDefault();
    const expireTextArea = document.querySelector('.options__time-to-expire');
    if (expireTextArea.value) {
        const mainObject = getMainObject();
        mainObject.expirationTime = parseInt(expireTextArea.value) * 60;
        setMainObject(mainObject);
        expireTextArea.placeholder = expireTextArea.value;
        expireTextArea.value = '';
    } else {
        //TODO: Дописать вывод на экран сообщения о том, что значение не введено
    }
})

document.querySelector('.options__time-to-send-message-button').addEventListener('click', (e) => {
    e.preventDefault();
    const messageTextArea = document.querySelector('.options__time-to-send-message');
    if (messageTextArea.value) {
        const mainObject = getMainObject();
        mainObject.messageTime = parseInt(messageTextArea.value) * 60;
        messageTextArea.placeholder = messageTextArea.value;
        messageTextArea.value = '';
        setMainObject(mainObject);
    } else {
        //TODO: дописать вывод на экран о том, что значение не введено
    }
})

document.querySelector('.options__request-interval-button').addEventListener('click', (e) => {
    e.preventDefault();
    const requestTextArea = document.querySelector('.options__request-interval');
    if (requestTextArea.value && parseInt(requestTextArea.value) > 10) {
        const mainObject = getMainObject();
        mainObject.requestInterval = parseInt(requestTextArea.value) * 1000;
        requestTextArea.placeholder = requestTextArea.value;
        requestTextArea.value = '';
        setMainObject(mainObject);
    } else {
        //TODO: дописать вывод на экран о том, что значение не введено или меньше 10 сек
    }
})
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIk1haW5PYmplY3RDbGFzcy5qcyIsIm9yZGVyQ2xhc3MuanMiLCJmdW5jdGlvbnMuanMiLCJhZGp1c3RtZW50LmpzIiwiTW9kZWwuanMiLCJWaWV3LmpzIiwiQ29udHJvbGxlci5qcyIsIm1haW4uanMiLCJldmVudExpc3RlbmVycy5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ2xCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3REQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDOUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDbEJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ2pLQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDbElBO0FDQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzlSQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJmaWxlIjoianMubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiY2xhc3MgbWFpbk9iamVjdENsYXNzIHtcbiAgICBjb25zdHJ1Y3RvcigpIHtcbiAgICAgICAgLy/QuNC90YLQtdGA0LLQsNC7INC30LDQv9GA0L7RgdC+0LJcbiAgICAgICAgdGhpcy5yZXF1ZXN0SW50ZXJ2YWwgPSAxMCAqIDEwMDA7XG5cbiAgICAgICAgLy/QstGA0LXQvNGPINC+0YLQv9GA0LDQstC60Lgg0YHQvtC+0LHRidC10L3QuNGPICjQv9C10YDQtdCw0L7QtNC40Lwg0LIg0YHQtdC6KVxuICAgICAgICB0aGlzLm1lc3NhZ2VUaW1lID0gMjMgKiA2MDtcblxuICAgICAgICAvL9Cy0YDQtdC80Y8g0LTQviDQv9GA0L7RgdGA0L7Rh9C60LggKNC/0LXRgNC10LLQvtC00LjQvCDQsiDRgdC10LopXG4gICAgICAgIHRoaXMuZXhwaXJhdGlvblRpbWUgPSAzMCAqIDYwO1xuXG4gICAgICAgIC8v0LTQsNGC0LBcbiAgICAgICAgY29uc3QgY3VycmVudERhdGUgPSBuZXcgRGF0ZSgpO1xuICAgICAgICB0aGlzLmN1cnJlbnREYXRlID0gY3VycmVudERhdGUuZ2V0RGF0ZSgpO1xuXG4gICAgICAgIC8v0L/Rg9GB0YLQvtC5INC80LDRgdGB0LjQsiDQv9C+0LQg0LfQsNC60LDQt9GLXG4gICAgICAgIHRoaXMub3JkZXJzID0gW107XG4gICAgfVxufSIsImNsYXNzIG9yZGVyQ2xhc3Mge1xuICAgIGNvbnN0cnVjdG9yKG9yZGVyTnVtYmVyKSB7XG4gICAgICAgIHRoaXMudW5peFRpbWUgPSBwYXJzZUludChuZXcgRGF0ZSgpLmdldFRpbWUoKSAvIDEwMDApO1xuICAgICAgICB0aGlzLmRhdGUgPSBwYXJzZUludChuZXcgRGF0ZSgpLmdldERhdGUoKSk7XG4gICAgICAgIHRoaXMuZXhwaXJlZCA9IGZhbHNlO1xuICAgICAgICB0aGlzLm1lc3NhZ2VTZW50ID0gZmFsc2U7XG4gICAgICAgIHRoaXMuY29tcGxldGUgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5jb21wbGV0ZVRpbWUgPSAwO1xuICAgICAgICB0aGlzLmluUXVldWUgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5wcmVwYXJpbmcgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5vcmRlck51bWJlciA9IG9yZGVyTnVtYmVyO1xuICAgICAgICB0aGlzLm5lZWRNZXNzYWdlID0gZmFsc2U7XG4gICAgICAgIHRoaXMucmVtYWRlID0gZmFsc2U7XG4gICAgfVxuXG4gICAgc2V0RXhwaXJlZCgpIHtcbiAgICAgICAgdGhpcy5leHBpcmVkID0gdHJ1ZTtcbiAgICB9XG5cbiAgICBzZXRNZXNzYWdlU2VudCgpIHtcbiAgICAgICAgdGhpcy5tZXNzYWdlU2VudCA9IHRydWU7XG4gICAgICAgIHRoaXMubmVlZE1lc3NhZ2UgPSBmYWxzZTtcbiAgICB9XG5cbiAgICBzZXROZWVkTWVzc2FnZSgpe1xuICAgICAgICB0aGlzLm5lZWRNZXNzYWdlID0gdHJ1ZTtcbiAgICB9XG5cbiAgICBzZXRUaW1lKHRpbWUpIHtcbiAgICAgICAgdGhpcy5jb21wbGV0ZVRpbWUgPSB0aW1lIC0gdGhpcy51bml4VGltZTtcbiAgICB9XG5cbiAgICBzZXRRdWV1ZSgpIHtcbiAgICAgICAgdGhpcy5pblF1ZXVlID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5wcmVwYXJpbmcgPSBmYWxzZTtcbiAgICB9XG5cbiAgICBzZXRQcmVwYXJpbmcoKSB7XG4gICAgICAgIHRoaXMucHJlcGFyaW5nID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5pblF1ZXVlID0gZmFsc2U7XG4gICAgfVxuXG4gICAgc2V0Q29tcGxldGUoKSB7XG4gICAgICAgIHRoaXMuY29tcGxldGUgPSB0cnVlO1xuICAgICAgICB0aGlzLnByZXBhcmluZyA9IGZhbHNlO1xuICAgICAgICB0aGlzLmluUXVldWUgPSBmYWxzZTtcbiAgICB9XG5cbiAgICBzZXRSZW1hZGUoKXtcbiAgICAgICAgdGhpcy5Db21wbGV0ZSA9IGZhbHNlO1xuICAgICAgICB0aGlzLlJlbWFkZSA9IHRydWU7XG4gICAgfVxuXG59XG4iLCJmdW5jdGlvbiBnZXRNYWluT2JqZWN0KCkge1xuICAgIHJldHVybiBKU09OLnBhcnNlKGxvY2FsU3RvcmFnZS5nZXRJdGVtKCdtYWluT2JqZWN0JykpO1xufVxuXG5mdW5jdGlvbiBpc01haW5PYmplY3RFeGlzdHMoKSB7XG4gICAgcmV0dXJuIGxvY2FsU3RvcmFnZS5nZXRJdGVtKCdtYWluT2JqZWN0JykgIT09IG51bGw7XG59XG5cbmZ1bmN0aW9uIHNldE1haW5PYmplY3QobWFpbk9iamVjdCkge1xuICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKCdtYWluT2JqZWN0JywgSlNPTi5zdHJpbmdpZnkobWFpbk9iamVjdCkpO1xufVxuXG5mdW5jdGlvbiBpc21haW5PYmplY3RDb250YWluc09yZGVyKG1haW5PYmplY3QsIG9yZGVyTnVtYmVyKSB7XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBtYWluT2JqZWN0Lm9yZGVycy5sZW5ndGg7IGkrKykge1xuICAgICAgICBpZiAobWFpbk9iamVjdC5vcmRlcnNbaV0ub3JkZXJOdW1iZXIgPT09IG9yZGVyTnVtYmVyKSB7XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gZmFsc2U7XG59XG5cbmZ1bmN0aW9uIGdldFNhbWVPcmRlcihuZXdDb250ZW50T2JqZWN0LCBvcmRlck51bWJlcikge1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbmV3Q29udGVudE9iamVjdC5vcmRlcnMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgaWYgKG5ld0NvbnRlbnRPYmplY3Qub3JkZXJzW2ldLm9yZGVyTnVtYmVyID09PSBvcmRlck51bWJlcikge1xuICAgICAgICAgICAgcmV0dXJuIG5ld0NvbnRlbnRPYmplY3Qub3JkZXJzW2ldLm9yZGVyTnVtYmVyO1xuICAgICAgICB9XG4gICAgfVxuICAgIHJldHVybiBmYWxzZTtcbn1cblxuZnVuY3Rpb24gaXNPcmRlclJlbWFkZShtYWluT2JqZWN0LCBvcmRlck51bWJlcikge1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbWFpbk9iamVjdC5vcmRlcnMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgaWYgKG1haW5PYmplY3Qub3JkZXJzW2ldLm9yZGVyTnVtYmVyID09PSBvcmRlck51bWJlciAmJiBtYWluT2JqZWN0Lm9yZGVyc1tpXS5jb21wbGV0ZSA9PT0gdHJ1ZSkge1xuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIGZhbHNlO1xufVxuXG5mdW5jdGlvbiBzZWNvbmRzVGltZVRvTm9ybWFsKHNlY29uZHMpIHtcbiAgICBsZXQgbWludXRlcyA9IE1hdGguZmxvb3Ioc2Vjb25kcyAvIDYwKSArICcnO1xuICAgIGxldCBzZWNzID0gc2Vjb25kcyAlIDYwICsgJyc7XG4gICAgaWYgKHNlY3MubGVuZ3RoIDwgMikge1xuICAgICAgICBzZWNzID0gJzAnICsgc2VjcztcbiAgICB9XG4gICAgcmV0dXJuIHJlc3VsdCA9IG1pbnV0ZXMgKyAnOicgKyBzZWNzXG59IiwiZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcIkRPTUNvbnRlbnRMb2FkZWRcIiwgKCkgPT4ge1xuICAgIGZ1bmN0aW9uIHNldENvbnRlbnRIZWlnaHQoKSB7XG4gICAgICAgIGNvbnN0IGhlYWRlciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5oZWFkZXInKTtcbiAgICAgICAgY29uc3Qgd3JhcHBlciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy53cmFwcGVyJyk7XG4gICAgICAgIGNvbnN0IGZvb3RlciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5mb290ZXInKTtcbiAgICAgICAgY29uc3Qgc2V0SGVpZ2h0Q29udGFpbmVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnNldC1oZWlnaHQnKTtcbiAgICAgICAgY29uc3QgbmVlZGVkSGVpZ2h0ID0gd3JhcHBlci5vZmZzZXRIZWlnaHQgLSBoZWFkZXIub2Zmc2V0SGVpZ2h0IC0gZm9vdGVyLm9mZnNldEhlaWdodDtcblxuICAgICAgICBpZiAoc2V0SGVpZ2h0Q29udGFpbmVyLm9mZnNldEhlaWdodCA8IG5lZWRlZEhlaWdodCkge1xuICAgICAgICAgICAgc2V0SGVpZ2h0Q29udGFpbmVyLnN0eWxlLmhlaWdodCA9IG5lZWRlZEhlaWdodCArICdweCc7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBzZXRDb250ZW50SGVpZ2h0KCk7XG4gICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ3Jlc2l6ZScsIHNldENvbnRlbnRIZWlnaHQpO1xufSlcblxuXG4iLCJjb25zdCBtb2RlbCA9IHtcblxuXG4gICAgY2FsbEV4dGVybmFsQ29udGVudCgpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHggPSBuZXcgWE1MSHR0cFJlcXVlc3QoKTtcblxuICAgICAgICAgICAgLy9hamF4INC30LDQv9GA0L7RgSDRh9C10YDQtdC3INC/0YDQvtC60YHQuCBjb3JzLWFueXdoZXJlXG4gICAgICAgICAgICAvL3gub3BlbignR0VUJywgJ2h0dHBzOi8vY29ycy1hbnl3aGVyZS5oZXJva3VhcHAuY29tL2h0dHBzOi8vYWtzb24ucnUvcGVyc29uYWwvb3JkZXIvdGFibGUxLz9TVE9SRV9JRD0xMScpO1xuICAgICAgICAgICAgeC5vcGVuKCdHRVQnLCAncHo0Lmh0bWwnKTtcblxuICAgICAgICAgICAgLy94LnRpbWVvdXQgPSA1MDAwO1xuICAgICAgICAgICAgeC5zZW5kKCk7XG4gICAgICAgICAgICB4Lm9ubG9hZCA9ICgpID0+IHtcbiAgICAgICAgICAgICAgICBpZiAoeC5zdGF0dXMgIT0gMjAwKSB7XG4gICAgICAgICAgICAgICAgICAgIHJlamVjdCh4LnN0YXR1c1RleHQpXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZSh4LnJlc3BvbnNlVGV4dCB8fCAnJyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfTtcbiAgICAgICAgfSlcbiAgICB9LFxuICAgIC8vXG4gICAgZ2V0Q29udGVudChleHRlcm5hbENvbnRlbnQpIHtcbiAgICAgICAgLy/QstGL0YLQsNGB0LrQuNCy0LDQtdC8INGC0LDQsdC70LjRhtGDINC40Lcg0LjRgdGF0L7QtNC90L7Qs9C+INC60L7QtNCwXG4gICAgICAgIGNvbnN0IGN1dEV4dGVybmFsQ29udGVudCA9IGV4dGVybmFsQ29udGVudC5zdWJzdHIoMzE5NiwgZXh0ZXJuYWxDb250ZW50Lmxlbmd0aCAtIDMzNzApO1xuICAgICAgICAvL2NvbnNvbGUubG9nKGN1dEV4dGVybmFsQ29udGVudCk7XG4gICAgICAgIGNvbnN0IGhpZGRlblRhYmxlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmhpZGRlbi10YWJsZScpO1xuICAgICAgICBoaWRkZW5UYWJsZS5pbm5lckhUTUwgPSBjdXRFeHRlcm5hbENvbnRlbnQ7XG4gICAgICAgIC8v0LLRi9GC0LDRgdC60LjQstCw0LXQvCDRgdGC0YDQvtC60LhcbiAgICAgICAgY29uc3Qgcm93cyA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKCd0cicpO1xuICAgICAgICAvL9C/0LXRgNC10LzQtdC90L3QsNGPINC00LvRjyDRgdGC0YDQvtC6INGE0LjQu9GM0YLRgNC+0LLQsNC90L3QvtC5INGC0LDQsdC70LjRhtGLXG4gICAgICAgIGxldCBmaWx0ZXJlZFJvd3MgPSBbXTtcblxuICAgICAgICAvL9GD0LTQsNC70Y/QtdC8INGB0YLRgNC+0LrQuCDQt9Cw0LPQvtC70L7QstC60L7QsiDRgtCw0LHQu9C40YYsINGD0LTQsNC70Y/QtdC8INC+0YLQvNC10L3QtdC90L3Ri9C1INC30LDQutCw0LfRiywg0YTQvtGA0LzQuNGA0YPQtdC8INC+0LTQvdGDINGC0LDQsdC70LjRhtGDINC40Lcg0LTQstGD0YVcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCByb3dzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICBpZiAocm93c1tpXS5pbm5lckhUTUwubGVuZ3RoICE9PSAzNzcpIHtcbiAgICAgICAgICAgICAgICBpZiAocm93c1tpXS5jaGlsZHJlblszXS5pbm5lckhUTUwubGVuZ3RoID4gMTAwKSB7XG4gICAgICAgICAgICAgICAgICAgIHJvd3NbaV0ucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChyb3dzW2ldKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBmaWx0ZXJlZFJvd3MucHVzaChyb3dzW2ldKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgLy/Rg9C00LDQu9GP0LXQvCDRh9C10YLQstC10YDRgtGD0Y4g0Y/Rh9C10LnQutGDXG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgZmlsdGVyZWRSb3dzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICBmaWx0ZXJlZFJvd3NbaV0ucmVtb3ZlQ2hpbGQoZmlsdGVyZWRSb3dzW2ldLmNoaWxkcmVuWzNdKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IG5ld0NvbnRlbnRPYmplY3QgPSBuZXcgbWFpbk9iamVjdENsYXNzKCk7XG4gICAgICAgIGZpbHRlcmVkUm93cy5mb3JFYWNoKChpdGVtKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBvcmRlck51bWJlciA9IHBhcnNlSW50KGl0ZW0uY2hpbGRyZW5bMF0uY2hpbGRyZW5bMF0uY2hpbGRyZW5bMF0uaW5uZXJIVE1MKTtcbiAgICAgICAgICAgIGNvbnN0IG9yZGVyID0gbmV3IG9yZGVyQ2xhc3Mob3JkZXJOdW1iZXIpO1xuICAgICAgICAgICAgLy9jb25zb2xlLmxvZyhpdGVtLmNoaWxkcmVuWzFdLmNoaWxkcmVuWzBdLmlubmVySFRNTC5sZW5ndGgpO1xuICAgICAgICAgICAgaWYgKGl0ZW0uY2hpbGRyZW5bMV0uY2hpbGRyZW5bMF0uaW5uZXJIVE1MLmxlbmd0aCA+IDMwKSB7XG4gICAgICAgICAgICAgICAgb3JkZXIuc2V0UXVldWUoKTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoaXRlbS5jaGlsZHJlblsyXS5jaGlsZHJlblswXS5pbm5lckhUTUwubGVuZ3RoID4gMzApIHtcbiAgICAgICAgICAgICAgICBvcmRlci5zZXRQcmVwYXJpbmcoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIG5ld0NvbnRlbnRPYmplY3Qub3JkZXJzLnB1c2gob3JkZXIpO1xuICAgICAgICB9KVxuXG4gICAgICAgIC8v0YPQtNCw0LvRj9C10Lwg0YLQsNCx0LvQuNGG0YNcbiAgICAgICAgaGlkZGVuVGFibGUuaW5uZXJIVE1MID0gJyc7XG5cbiAgICAgICAgaWYgKCFpc01haW5PYmplY3RFeGlzdHMoKSkge1xuICAgICAgICAgICAgc2V0TWFpbk9iamVjdChuZXdDb250ZW50T2JqZWN0KTtcbiAgICAgICAgICAgIHRoaXMuZ2V0Q29udGVudChleHRlcm5hbENvbnRlbnQpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgY29uc3Qgbm90Rm9ybWF0dGVkbWFpbk9iamVjdCA9IGdldE1haW5PYmplY3QoKTtcbiAgICAgICAgICAgIGNvbnN0IG1haW5PYmplY3QgPSBuZXcgbWFpbk9iamVjdENsYXNzKCk7XG5cbiAgICAgICAgICAgIG1haW5PYmplY3QucmVxdWVzdEludGVydmFsID0gbm90Rm9ybWF0dGVkbWFpbk9iamVjdC5yZXF1ZXN0SW50ZXJ2YWw7XG4gICAgICAgICAgICBtYWluT2JqZWN0Lm1lc3NhZ2VUaW1lID0gbm90Rm9ybWF0dGVkbWFpbk9iamVjdC5tZXNzYWdlVGltZTtcbiAgICAgICAgICAgIG1haW5PYmplY3QuZXhwaXJhdGlvblRpbWUgPSBub3RGb3JtYXR0ZWRtYWluT2JqZWN0LmV4cGlyYXRpb25UaW1lO1xuXG4gICAgICAgICAgICBub3RGb3JtYXR0ZWRtYWluT2JqZWN0Lm9yZGVycy5mb3JFYWNoKChpdGVtKSA9PiB7XG4gICAgICAgICAgICAgICAgbGV0IGN1cnJlbnRPcmRlciA9IG5ldyBvcmRlckNsYXNzKGl0ZW0ub3JkZXJOdW1iZXIpO1xuICAgICAgICAgICAgICAgIGN1cnJlbnRPcmRlci5leHBpcmVkID0gaXRlbS5leHBpcmVkO1xuICAgICAgICAgICAgICAgIGN1cnJlbnRPcmRlci5tZXNzYWdlU2VudCA9IGl0ZW0ubWVzc2FnZVNlbnQ7XG4gICAgICAgICAgICAgICAgY3VycmVudE9yZGVyLmNvbXBsZXRlID0gaXRlbS5jb21wbGV0ZTtcbiAgICAgICAgICAgICAgICBjdXJyZW50T3JkZXIuY29tcGxldGVUaW1lID0gaXRlbS5jb21wbGV0ZVRpbWU7XG4gICAgICAgICAgICAgICAgY3VycmVudE9yZGVyLmluUXVldWUgPSBpdGVtLmluUXVldWU7XG4gICAgICAgICAgICAgICAgY3VycmVudE9yZGVyLnByZXBhcmluZyA9IGl0ZW0ucHJlcGFyaW5nO1xuICAgICAgICAgICAgICAgIGN1cnJlbnRPcmRlci5yZW1hZGUgPSBpdGVtLnJlbWFkZTtcbiAgICAgICAgICAgICAgICBjdXJyZW50T3JkZXIudW5peFRpbWUgPSBpdGVtLnVuaXhUaW1lO1xuICAgICAgICAgICAgICAgIGN1cnJlbnRPcmRlci5kYXRlID0gaXRlbS5kYXRlO1xuICAgICAgICAgICAgICAgIGN1cnJlbnRPcmRlci5uZWVkTWVzc2FnZSA9IGl0ZW0ubmVlZE1lc3NhZ2U7XG4gICAgICAgICAgICAgICAgbWFpbk9iamVjdC5vcmRlcnMucHVzaChjdXJyZW50T3JkZXIpO1xuICAgICAgICAgICAgfSlcblxuXG4gICAgICAgICAgICAvLyDQlNC+0LHQsNCy0LvRj9C10Lwg0L3QvtCy0YvQtSDQt9Cw0LrQsNC30YtcbiAgICAgICAgICAgIG5ld0NvbnRlbnRPYmplY3Qub3JkZXJzLmZvckVhY2goKGl0ZW0sIGkpID0+IHtcbiAgICAgICAgICAgICAgICBpZiAoIWlzbWFpbk9iamVjdENvbnRhaW5zT3JkZXIobWFpbk9iamVjdCwgaXRlbS5vcmRlck51bWJlcikpIHtcbiAgICAgICAgICAgICAgICAgICAgbWFpbk9iamVjdC5vcmRlcnMucHVzaChuZXdDb250ZW50T2JqZWN0Lm9yZGVyc1tpXSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC8v0LXRgdC70Lgg0YHRgtCw0YDQvtCz0L4g0LfQsNC60LDQt9CwINC90LXRgiDQsiDRgdC/0LjRgdC60LUg0LfQsNC60LDQt9C+0LIg0L3QvtCy0L7Qs9C+INC+0LHRitC10LrRgtCwLCDQv9C+0LzQtdGH0LDQtdC8INGB0YLQsNGA0YvQuSDQv9C+0LTRgtCy0LXRgNC20LTQtdC90L3Ri9C8XG4gICAgICAgICAgICBtYWluT2JqZWN0Lm9yZGVycy5mb3JFYWNoKChpdGVtKSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKCFnZXRTYW1lT3JkZXIobmV3Q29udGVudE9iamVjdCwgaXRlbS5vcmRlck51bWJlcikpIHtcbiAgICAgICAgICAgICAgICAgICAgaXRlbS5zZXRDb21wbGV0ZSgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAvL9C/0L7Qu9GD0YfQsNC10Lwg0L/QtdGA0LXQstGL0LPRgNGD0LbQtdC90L3Ri9C1INC30LDQutCw0LfRi1xuICAgICAgICAgICAgbmV3Q29udGVudE9iamVjdC5vcmRlcnMuZm9yRWFjaCgoaXRlbSkgPT4ge1xuICAgICAgICAgICAgICAgIGlmIChpc09yZGVyUmVtYWRlKG1haW5PYmplY3QsIGl0ZW0ub3JkZXJOdW1iZXIpKSB7XG4gICAgICAgICAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbWFpbk9iamVjdC5vcmRlcnMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChtYWluT2JqZWN0Lm9yZGVyc1tpXS5vcmRlck51bWJlciA9PT0gaXRlbS5vcmRlck51bWJlcikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1haW5PYmplY3Qub3JkZXJzW2ldLnNldFJlbWFkZSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1haW5PYmplY3Qub3JkZXJzW2ldLmV4cGlyZWQgPSBpdGVtLmV4cGlyZWQ7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbWFpbk9iamVjdC5vcmRlcnNbaV0ubWVzc2FnZVNlbnQgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtYWluT2JqZWN0Lm9yZGVyc1tpXS51bml4VGltZSA9IHBhcnNlSW50KG5ldyBEYXRlKCkuZ2V0VGltZSgpIC8gMTAwMCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbWFpbk9iamVjdC5vcmRlcnNbaV0uY29tcGxldGUgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtYWluT2JqZWN0Lm9yZGVyc1tpXS5jb21wbGV0ZVRpbWUgPSAwO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1haW5PYmplY3Qub3JkZXJzW2ldLmluUXVldWUgPSBpdGVtLmluUXVldWU7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbWFpbk9iamVjdC5vcmRlcnNbaV0ucHJlcGFyaW5nID0gaXRlbS5wcmVwYXJpbmc7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbWFpbk9iamVjdC5vcmRlcnNbaV0uZGF0ZSA9IGl0ZW0uZGF0ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtYWluT2JqZWN0Lm9yZGVyc1tpXS5uZWVkTWVzc2FnZSA9IGl0ZW0ubmVlZE1lc3NhZ2U7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KVxuXG4gICAgICAgICAgICAvL9C30LDQtNCw0LXQvCDQstGA0LXQvNGPINC90LDQsdC+0YDQutC4XG4gICAgICAgICAgICBtYWluT2JqZWN0Lm9yZGVycy5mb3JFYWNoKChpdGVtKSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKGl0ZW0uY29tcGxldGUgPT09IGZhbHNlKSB7XG4gICAgICAgICAgICAgICAgICAgIGl0ZW0uc2V0VGltZShwYXJzZUludChuZXcgRGF0ZSgpLmdldFRpbWUoKSAvIDEwMDApKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KVxuXG4gICAgICAgICAgICAvL9C/0YDQvtCy0LXRgNGP0LXQvCDQvdCwINC/0YDQvtGB0YDQvtGH0LrRg1xuXG4gICAgICAgICAgICBtYWluT2JqZWN0Lm9yZGVycy5mb3JFYWNoKChpdGVtKSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKGl0ZW0uY29tcGxldGVUaW1lID4gbWFpbk9iamVjdC5leHBpcmF0aW9uVGltZSkge1xuICAgICAgICAgICAgICAgICAgICBpdGVtLnNldEV4cGlyZWQoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KVxuXG4gICAgICAgICAgICAvL9GD0LTQsNC70Y/QtdC8INC30LDQutCw0LfRiyDQstC+0LfRgNCw0YHRgtC+0Lwg0LHQvtC70LXQtSAxMCDQtNC90LXQuVxuICAgICAgICAgICAgZm9yIChsZXQgaSA9IG1haW5PYmplY3Qub3JkZXJzLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKSB7XG4gICAgICAgICAgICAgICAgaWYgKHBhcnNlSW50KG5ldyBEYXRlKCkuZ2V0VGltZSgpIC8gMTAwMCkgLSBtYWluT2JqZWN0Lm9yZGVyc1tpXS51bml4VGltZSA+IDg2NDAwMCkge1xuICAgICAgICAgICAgICAgICAgICBtYWluT2JqZWN0Lm9yZGVycy5zcGxpY2UoaSwgMSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG5cbiAgICAgICAgICAgIHNldE1haW5PYmplY3QobWFpbk9iamVjdCk7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhtYWluT2JqZWN0KTtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBnZXRXYXJuaW5nKCkge1xuICAgICAgICBjb25zdCBtYWluT2JqZWN0ID0gZ2V0TWFpbk9iamVjdCgpO1xuICAgICAgICBtYWluT2JqZWN0Lm9yZGVycy5mb3JFYWNoKChpdGVtKSA9PiB7XG4gICAgICAgICAgICBpZiAocGFyc2VJbnQobmV3IERhdGUoKS5nZXRUaW1lKCkgLyAxMDAwKSAtIGl0ZW0udW5peFRpbWUgPiBtYWluT2JqZWN0Lm1lc3NhZ2VUaW1lKSB7XG4gICAgICAgICAgICAgICAgaXRlbS5uZWVkTWVzc2FnZSA9IHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pXG4gICAgICAgIHNldE1haW5PYmplY3QobWFpbk9iamVjdCk7XG4gICAgfVxufSIsInZpZXcgPSB7XG4gICAgZHJhd1RhYmxlKCkge1xuICAgICAgICBjb25zdCBtYWluT2JqZWN0ID0gZ2V0TWFpbk9iamVjdCgpO1xuICAgICAgICBjb25zdCBuZXdUYWJsZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5uZXctdGFibGUnKTtcbiAgICAgICAgbmV3VGFibGUuaW5uZXJIVE1MID0gJyc7XG4gICAgICAgIC8vIGNvbnN0IHRhYmxlSGVhZGVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndHInKTtcbiAgICAgICAgLy8gdGFibGVIZWFkZXIuY2xhc3NMaXN0LmFkZCgnbmV3LXRhYmxlX19oZWFkZXInKTtcbiAgICAgICAgLy8gbmV3VGFibGUuYXBwZW5kQ2hpbGQodGFibGVIZWFkZXIpO1xuICAgICAgICAvLyBjb25zdCB0YWJsZUhlYWRlckNlbGxOdW1iZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0aCcpO1xuICAgICAgICAvLyB0YWJsZUhlYWRlckNlbGxOdW1iZXIuY2xhc3NMaXN0LmFkZCgnbmV3LXRhYmxlX19oZWFkZXItY2VsbCcpO1xuICAgICAgICAvLyB0YWJsZUhlYWRlckNlbGxOdW1iZXIudGV4dENvbnRlbnQ9ICfihJYnO1xuICAgICAgICAvLyB0YWJsZUhlYWRlci5hcHBlbmRDaGlsZCh0YWJsZUhlYWRlckNlbGxOdW1iZXIpO1xuICAgICAgICAvLyBjb25zdCB0YWJsZUhlYWRlckNlbGxPcmRlck51bWJlciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RoJyk7XG4gICAgICAgIC8vIHRhYmxlSGVhZGVyQ2VsbE9yZGVyTnVtYmVyLmNsYXNzTGlzdC5hZGQoJ25ldy10YWJsZV9faGVhZGVyLWNlbGwnKTtcbiAgICAgICAgLy8gdGFibGVIZWFkZXJDZWxsT3JkZXJOdW1iZXIudGV4dENvbnRlbnQgPSAn4oSWINC30LDQutCw0LfQsCc7XG4gICAgICAgIC8vIHRhYmxlSGVhZGVyLmFwcGVuZENoaWxkKHRhYmxlSGVhZGVyQ2VsbE9yZGVyTnVtYmVyKTtcbiAgICAgICAgLy8gY29uc3QgdGFibGVIZWFkZXJPcmRlckluUXVldWUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0aCcpO1xuICAgICAgICAvLyB0YWJsZUhlYWRlck9yZGVySW5RdWV1ZS5jbGFzc0xpc3QuYWRkKCduZXctdGFibGVfX2hlYWRlci1jZWxsJyk7XG4gICAgICAgIC8vIHRhYmxlSGVhZGVyT3JkZXJJblF1ZXVlLnRleHRDb250ZW50PSfQkiDQvtGH0LXRgNC10LTQuCc7XG4gICAgICAgIC8vIHRhYmxlSGVhZGVyLmFwcGVuZENoaWxkKHRhYmxlSGVhZGVyT3JkZXJJblF1ZXVlKTtcbiAgICAgICAgLy8gY29uc3QgdGFibGVIZWFkZXJPcmRlcklzUHJlcGFyaW5nID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndHInKTtcbiAgICAgICAgLy8gdGFibGVIZWFkZXJPcmRlcklzUHJlcGFyaW5nLmNsYXNzTGlzdC5hZGQoJ25ldy10YWJsZV9faGVhZGVyLWNlbGwnKTtcbiAgICAgICAgLy8gdGFibGVIZWFkZXJPcmRlcklzUHJlcGFyaW5nLnRleHRDb250ZW50ID0gJ9CSINC90LDQsdC+0YDQtSc7XG4gICAgICAgIC8vIHRhYmxlSGVhZGVyLmFwcGVuZENoaWxkKHRhYmxlSGVhZGVyT3JkZXJJc1ByZXBhcmluZyk7XG4gICAgICAgIC8vIGNvbnN0IHRhYmxlSGVhZGVyVGltZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RyJyk7XG4gICAgICAgIC8vIHRhYmxlSGVhZGVyVGltZS5jbGFzc0xpc3QuYWRkKCduZXctdGFibGVfX2hlYWRlci1jZWxsJyk7XG4gICAgICAgIC8vIHRhYmxlSGVhZGVyVGltZS50ZXh0Q29udGVudCA9ICfQktGA0LXQvNGPINC90LDQsdC+0YDQsCc7XG4gICAgICAgIC8vIHRhYmxlSGVhZGVyLmFwcGVuZENoaWxkKHRhYmxlSGVhZGVyVGltZSk7XG5cblxuICAgICAgICBuZXdUYWJsZS5pbnNlcnRBZGphY2VudEhUTUwoJ2JlZm9yZWVuZCcsICcnICtcbiAgICAgICAgICAgICcgICAgICAgICAgICAgICAgIDx0aGVhZD4nICtcbiAgICAgICAgICAgICcgICAgICAgICAgICAgICAgICAgIDx0ciBjbGFzcz1cIm5ldy10YWJsZV9faGVhZGVyXCI+XFxuJyArXG4gICAgICAgICAgICAnICAgICAgICAgICAgICAgICAgICAgICAgPHRoIGNsYXNzPVwibmV3LXRhYmxlX19oZWFkZXItY2VsbFwiPuKEljwvdGg+XFxuJyArXG4gICAgICAgICAgICAnICAgICAgICAgICAgICAgICAgICAgICAgPHRoIGNsYXNzPVwibmV3LXRhYmxlX19oZWFkZXItY2VsbFwiPtCd0L7QvNC10YAg0LfQsNC60LDQt9CwPC90aD5cXG4nICtcbiAgICAgICAgICAgICcgICAgICAgICAgICAgICAgICAgICAgICA8dGggY2xhc3M9XCJuZXctdGFibGVfX2hlYWRlci1jZWxsXCI+0JIg0L7Rh9C10YDQtdC00Lg8L3RoPlxcbicgK1xuICAgICAgICAgICAgJyAgICAgICAgICAgICAgICAgICAgICAgIDx0aCBjbGFzcz1cIm5ldy10YWJsZV9faGVhZGVyLWNlbGxcIj7QkiDQvdCw0LHQvtGA0LU8L3RoPlxcbicgK1xuICAgICAgICAgICAgJyAgICAgICAgICAgICAgICAgICAgICAgIDx0aCBjbGFzcz1cIm5ldy10YWJsZV9faGVhZGVyLWNlbGxcIj7Ql9Cw0LLQtdGA0YjQtdC9PC90aD5cXG4nICtcbiAgICAgICAgICAgICcgICAgICAgICAgICAgICAgICAgICAgICA8dGggY2xhc3M9XCJuZXctdGFibGVfX2hlYWRlci1jZWxsXCI+0JLRgNC10LzRjzwvdGg+XFxuJyArXG4gICAgICAgICAgICAnICAgICAgICAgICAgICAgICAgICA8L3RyPicgK1xuICAgICAgICAgICAgJyAgICAgICAgICAgICAgICAgPC90aGVhZD4nKTtcblxuICAgICAgICBsZXQgY291bnRlciA9IDE7XG4gICAgICAgIG1haW5PYmplY3Qub3JkZXJzLmZvckVhY2goKGl0ZW0pID0+IHtcblxuICAgICAgICAgICAgbGV0IGluUXVldWUgPSAnJztcbiAgICAgICAgICAgIGlmIChpdGVtLmluUXVldWUgPT09IHRydWUpIHtcbiAgICAgICAgICAgICAgICBpblF1ZXVlID0gJ1gnO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgbGV0IHByZXBhcmluZyA9ICcnO1xuICAgICAgICAgICAgaWYgKGl0ZW0ucHJlcGFyaW5nID09PSB0cnVlKSB7XG4gICAgICAgICAgICAgICAgcHJlcGFyaW5nID0gJ1gnO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgbGV0IGNvbXBsZXRlID0gJyc7XG4gICAgICAgICAgICBpZiAoaXRlbS5jb21wbGV0ZSA9PT0gdHJ1ZSkge1xuICAgICAgICAgICAgICAgIGNvbXBsZXRlID0gJ1gnO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgbGV0IHRpbWUgPSBzZWNvbmRzVGltZVRvTm9ybWFsKGl0ZW0uY29tcGxldGVUaW1lKTtcbiAgICAgICAgICAgIGlmIChpdGVtLmRhdGUgPT09IHBhcnNlSW50KG5ldyBEYXRlKCkuZ2V0RGF0ZSgpKSAmJiBpdGVtLmV4cGlyZWQgPT09IGZhbHNlICYmIGl0ZW0ubWVzc2FnZVNlbnQgPT09IGZhbHNlKSB7XG4gICAgICAgICAgICAgICAgbmV3VGFibGUuaW5zZXJ0QWRqYWNlbnRIVE1MKCdiZWZvcmVlbmQnLCBgXG4gICAgICAgICAgICAgICAgICAgIDx0Ym9keT5cbiAgICAgICAgICAgICAgICAgICAgICAgIDx0ciBjbGFzcz1cIm5ldy10YWJsZV9fcm93XCI+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgPHRkIGNsYXNzPVwibmV3LXRhYmxlX19jZWxsXCI+JHtjb3VudGVyfTwvdGQ+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgPHRkIGNsYXNzPVwibmV3LXRhYmxlX19jZWxsXCI+JHtpdGVtLm9yZGVyTnVtYmVyfTwvdGQ+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgPHRkIGNsYXNzPVwibmV3LXRhYmxlX19jZWxsXCI+JHtpblF1ZXVlfTwvdGQ+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgPHRkIGNsYXNzPVwibmV3LXRhYmxlX19jZWxsXCI+JHtwcmVwYXJpbmd9PC90ZD5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8dGQgY2xhc3M9XCJuZXctdGFibGVfX2NlbGxcIj4ke2NvbXBsZXRlfTwvdGQ+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgPHRkIGNsYXNzPVwibmV3LXRhYmxlX19jZWxsXCI+JHt0aW1lfTwvdGQ+XG4gICAgICAgICAgICAgICAgICAgICAgICA8L3RyPlxuICAgICAgICAgICAgICAgICAgICA8L3Rib2R5PmBcbiAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICB9IGVsc2UgaWYgKGl0ZW0uZGF0ZSA9PT0gcGFyc2VJbnQobmV3IERhdGUoKS5nZXREYXRlKCkpICYmIGl0ZW0uZXhwaXJlZCA9PT0gZmFsc2UgJiYgaXRlbS5tZXNzYWdlU2VudCA9PT0gdHJ1ZSkge1xuICAgICAgICAgICAgICAgIG5ld1RhYmxlLmluc2VydEFkamFjZW50SFRNTCgnYmVmb3JlZW5kJywgYFxuICAgICAgICAgICAgICAgICAgICA8dGJvZHkgY2xhc3M9XCJuZXctdGFibGVfX29yZGVyLXdhcm5pbmdcIj5cbiAgICAgICAgICAgICAgICAgICAgICAgIDx0ciBjbGFzcz1cIm5ldy10YWJsZV9fcm93XCI+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgPHRkIGNsYXNzPVwibmV3LXRhYmxlX19jZWxsXCI+JHtjb3VudGVyfTwvdGQ+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgPHRkIGNsYXNzPVwibmV3LXRhYmxlX19jZWxsXCI+JHtpdGVtLm9yZGVyTnVtYmVyfTwvdGQ+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgPHRkIGNsYXNzPVwibmV3LXRhYmxlX19jZWxsXCI+JHtpblF1ZXVlfTwvdGQ+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgPHRkIGNsYXNzPVwibmV3LXRhYmxlX19jZWxsXCI+JHtwcmVwYXJpbmd9PC90ZD5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8dGQgY2xhc3M9XCJuZXctdGFibGVfX2NlbGxcIj4ke2NvbXBsZXRlfTwvdGQ+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgPHRkIGNsYXNzPVwibmV3LXRhYmxlX19jZWxsXCI+JHt0aW1lfTwvdGQ+XG4gICAgICAgICAgICAgICAgICAgICAgICA8L3RyPlxuICAgICAgICAgICAgICAgICAgICA8L3Rib2R5PmBcbiAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICB9IGVsc2UgaWYgKGl0ZW0uZGF0ZSA9PT0gcGFyc2VJbnQobmV3IERhdGUoKS5nZXREYXRlKCkpICYmIGl0ZW0uZXhwaXJlZCA9PT0gdHJ1ZSAmJiBpdGVtLm1lc3NhZ2VTZW50ID09PSB0cnVlKSB7XG4gICAgICAgICAgICAgICAgbmV3VGFibGUuaW5zZXJ0QWRqYWNlbnRIVE1MKCdiZWZvcmVlbmQnLCBgXG4gICAgICAgICAgICAgICAgICAgIDx0Ym9keSBjbGFzcz1cIm5ldy10YWJsZV9fb3JkZXItZXhwaXJlZFwiPlxuICAgICAgICAgICAgICAgICAgICAgICAgPHRyIGNsYXNzPVwibmV3LXRhYmxlX19yb3dcIj5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8dGQgY2xhc3M9XCJuZXctdGFibGVfX2NlbGxcIj4ke2NvdW50ZXJ9PC90ZD5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8dGQgY2xhc3M9XCJuZXctdGFibGVfX2NlbGxcIj4ke2l0ZW0ub3JkZXJOdW1iZXJ9PC90ZD5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8dGQgY2xhc3M9XCJuZXctdGFibGVfX2NlbGxcIj4ke2luUXVldWV9PC90ZD5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8dGQgY2xhc3M9XCJuZXctdGFibGVfX2NlbGxcIj4ke3ByZXBhcmluZ308L3RkPlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDx0ZCBjbGFzcz1cIm5ldy10YWJsZV9fY2VsbFwiPiR7Y29tcGxldGV9PC90ZD5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8dGQgY2xhc3M9XCJuZXctdGFibGVfX2NlbGxcIj4ke3RpbWV9PC90ZD5cbiAgICAgICAgICAgICAgICAgICAgICAgIDwvdHI+XG4gICAgICAgICAgICAgICAgICAgIDwvdGJvZHk+YFxuICAgICAgICAgICAgICAgIClcblxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY291bnRlcisrO1xuICAgICAgICB9KVxuXG4gICAgfSxcblxuICAgIHNlbmRNZXNzYWdlKG1lc3NhZ2UpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHggPSBuZXcgWE1MSHR0cFJlcXVlc3QoKTtcbiAgICAgICAgICAgIHgub3BlbignR0VUJywgJ2h0dHBzOi8vYXBpLnRlbGVncmFtLm9yZy9ib3QxMDE4NzU3MDEzOkFBRUhPOWFjY1Voc2NpZVQwQXJScTlpd1VlYXQ2Qm1Fek9NL3NlbmRNZXNzYWdlP2NoYXRfaWQ9LTEwMDE0NzE2Nzc2MTQmdGV4dD0nICsgbWVzc2FnZSk7XG4gICAgICAgICAgICB4LnNlbmQoKTtcbiAgICAgICAgICAgIHgub25sb2FkID0gKCkgPT4ge1xuICAgICAgICAgICAgICAgIGlmICh4LnN0YXR1cyAhPSAyMDApIHtcbiAgICAgICAgICAgICAgICAgICAgcmVqZWN0KHguc3RhdHVzVGV4dClcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICByZXNvbHZlKHgucmVzcG9uc2VUZXh0IHx8ICcnKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9O1xuICAgICAgICB9KVxuICAgIH0sXG5cbiAgICBzZW5kTWVzc2FnZXMoKSB7XG4gICAgICAgIGNvbnN0IG1haW5PYmplY3QgPSBnZXRNYWluT2JqZWN0KCk7XG4gICAgICAgIG1haW5PYmplY3Qub3JkZXJzLmZvckVhY2goKGl0ZW0pID0+IHtcbiAgICAgICAgICAgIGlmIChpdGVtLm5lZWRNZXNzYWdlID09PSB0cnVlKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5zZW5kTWVzc2FnZSgn0JfQsNC60LDQtyAnICsgaXRlbS5vcmRlck51bWJlciArICcg0LIg0L3QsNCx0L7RgNC1INGD0LbQtSDQsdC+0LvQtdC1ICcgKyBtYWluT2JqZWN0LmV4cGlyYXRpb25UaW1lIC8gNjAgKyAnINC80LjQvdGD0YInKTtcbiAgICAgICAgICAgICAgICBtYWluT2JqZWN0Lm1lc3NhZ2VTZW50ID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICBtYWluT2JqZWN0Lm5lZWRNZXNzYWdlID0gZmFsc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pXG4gICAgICAgIHNldE1haW5PYmplY3QobWFpbk9iamVjdCk7XG4gICAgfVxufSIsIiIsImRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJET01Db250ZW50TG9hZGVkXCIsICgpID0+IHtcblxuICAgIG1vZGVsLmNhbGxFeHRlcm5hbENvbnRlbnQoKVxuICAgICAgICAudGhlbigocmVzcG9uc2UpID0+IHtcbiAgICAgICAgICAgIG1vZGVsLmdldENvbnRlbnQocmVzcG9uc2UpO1xuICAgICAgICAgICAgbW9kZWwuZ2V0V2FybmluZygpO1xuICAgICAgICAgICAgdmlldy5zZW5kTWVzc2FnZXMoKTtcbiAgICAgICAgICAgIHZpZXcuZHJhd1RhYmxlKCk7XG4gICAgICAgIH0pXG5cblxuXG5cblxuXG5cblxuXG4gICAgLy8gLy8g0KTRg9C90LrRhtC40Y8g0L/QtdGA0LXQstC+0LTQsCDQutC+0LvQuNGH0LXRgdGC0LLQsCDRgdC10LrRg9C90LQg0LIg0LzQuNC90YPRgtGLINC4INGB0LXQutGD0L3QtNGLXG4vLyAgICAgZnVuY3Rpb24gdW5peFRpbWVUb05vcm1hbChzZWNvbmRzKSB7XG4vLyAgICAgICAgIGxldCBtaW51dGVzID0gTWF0aC5mbG9vcihzZWNvbmRzIC8gNjApICsgJyc7XG4vLyAgICAgICAgIGxldCBzZWNzID0gc2Vjb25kcyAlIDYwICsgJyc7XG4vLyAgICAgICAgIGlmIChzZWNzLmxlbmd0aCA8IDIpIHtcbi8vICAgICAgICAgICAgIHNlY3MgPSAnMCcgKyBzZWNzO1xuLy8gICAgICAgICB9XG4vLyAgICAgICAgIHJldHVybiByZXN1bHQgPSBtaW51dGVzICsgJzonICsgc2Vjc1xuLy8gICAgIH1cbi8vXG4vLyAvLy0tLdC00L7QsdCw0LLQu9GP0LXQvCDRhNGD0L3QutGG0LjRjiDQv9GA0L7QstC10YDQutC4INC90LDQu9C40YfQuNGPINC30LDQutCw0LfQsCDQsiBzZXNzaW9uIHN0b3JhZ2Vcbi8vICAgICBmdW5jdGlvbiBpc09yZGVyTnVtYmVySW5TZXNzaW9uU3RvcmFnZShvcmRlck51bWJlcikge1xuLy8gICAgICAgICBpZiAoc2Vzc2lvblN0b3JhZ2UuZ2V0SXRlbShvcmRlck51bWJlcikpIHtcbi8vICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuLy8gICAgICAgICB9IGVsc2Uge1xuLy8gICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuLy8gICAgICAgICB9XG4vLyAgICAgfVxuLy9cbi8vIC8v0YTRg9C90LrRhtC40Y8g0L/RgNC+0LLQtdGA0Y/QtdGCINC90LDQu9C40YfQuNC1INC30LDQutCw0LfQsCDQsiDRgdGC0YDQvtC60LUgXCLQvtGC0L/RgNCw0LLQuNGC0YxcIiDQsiBzZXNzaW9uIHN0b3JhZ2Vcbi8vICAgICBmdW5jdGlvbiBpc0FkZGVkVG9TZW5kU3RyaW5nKG9yZGVyTnVtYmVyKSB7XG4vLyAgICAgICAgIGxldCB0ZXh0ID0gc2Vzc2lvblN0b3JhZ2UuZ2V0SXRlbSgndG8tc2VuZCcpO1xuLy8gICAgICAgICBpZiAodGV4dCkge1xuLy8gICAgICAgICAgICAgbGV0IG9yZGVyc0FycmF5ID0gdGV4dC5zcGxpdCgnfCcpO1xuLy8gICAgICAgICAgICAgZm9yIChpID0gMDsgaSA8IG9yZGVyc0FycmF5Lmxlbmd0aDsgaSsrKSB7XG4vLyAgICAgICAgICAgICAgICAgaWYgKG9yZGVyTnVtYmVyID09PSBwYXJzZUludChvcmRlcnNBcnJheVtpXSkpIHtcbi8vICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWVcbi8vICAgICAgICAgICAgICAgICB9XG4vLyAgICAgICAgICAgICB9XG4vLyAgICAgICAgIH1cbi8vICAgICB9XG4vL1xuLy8gLy/QpNGD0L3QutGG0LjRjyDQvtCy0LXRgNGP0LXRgiDQvdCw0LvQuNGH0LjQtSDQt9Cw0LrQsNC30LAg0LIg0YHRgtGA0L7QutC1INC/0YDQvtGB0YDQvtGH0LXQvdC90YvRhSDQsiBzZXNzaW9uIHN0b3JhZ2Vcbi8vICAgICBmdW5jdGlvbiBpc0FkZGVkKG9yZGVyTnVtYmVyKSB7XG4vLyAgICAgICAgIGxldCB0ZXh0ID0gc2Vzc2lvblN0b3JhZ2UuZ2V0SXRlbSgnZXhwaXJlZCcpO1xuLy8gICAgICAgICBpZiAodGV4dCkge1xuLy8gICAgICAgICAgICAgbGV0IG9yZGVyc0FycmF5ID0gdGV4dC5zcGxpdCgnfCcpO1xuLy8gICAgICAgICAgICAgZm9yIChpID0gMDsgaSA8IG9yZGVyc0FycmF5Lmxlbmd0aDsgaSsrKSB7XG4vLyAgICAgICAgICAgICAgICAgaWYgKG9yZGVyTnVtYmVyID09PSBwYXJzZUludChvcmRlcnNBcnJheVtpXSkpIHtcbi8vICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWVcbi8vICAgICAgICAgICAgICAgICB9XG4vLyAgICAgICAgICAgICB9XG4vLyAgICAgICAgIH1cbi8vICAgICAgICAgcmV0dXJuIGZhbHNlXG4vLyAgICAgfVxuLy9cbi8vIC8v0KTRg9C90LrRhtC40Y8g0L/QvtC70YPRh9C10L3QuNGPINC00LDQvdC90YvRhVxuLy8gICAgIGZ1bmN0aW9uIGNhbGxFeHRlcm5hbENvbnRlbnQoKSB7XG4vLyAgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4vLyAgICAgICAgICAgICBjb25zdCB4ID0gbmV3IFhNTEh0dHBSZXF1ZXN0KCk7XG4vL1xuLy8gICAgICAgICAgICAgLy9hamF4INC30LDQv9GA0L7RgSDRh9C10YDQtdC3INC/0YDQvtC60YHQuCBjb3JzLWFueXdoZXJlXG4vLyAgICAgICAgICAgICB4Lm9wZW4oJ0dFVCcsICdodHRwczovL2NvcnMtYW55d2hlcmUuaGVyb2t1YXBwLmNvbS9odHRwczovL2Frc29uLnJ1L3BlcnNvbmFsL29yZGVyL3RhYmxlMS8/U1RPUkVfSUQ9MTEnKTtcbi8vICAgICAgICAgICAgIC8veC5vcGVuKCdHRVQnLCAncHouaHRtbCcpO1xuLy8gICAgICAgICAgICAgLy94Lm9wZW4oJ0dFVCcsICdwejIuaHRtbCcpO1xuLy8gICAgICAgICAgICAgLy94LnRpbWVvdXQgPSA1MDAwO1xuLy8gICAgICAgICAgICAgeC5zZW5kKCk7XG4vLyAgICAgICAgICAgICB4Lm9ubG9hZCA9ICgpID0+IHtcbi8vICAgICAgICAgICAgICAgICBpZiAoeC5zdGF0dXMgIT0gMjAwKSB7XG4vLyAgICAgICAgICAgICAgICAgICAgIHJlamVjdCh4LnN0YXR1c1RleHQpXG4vLyAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbi8vICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZSh4LnJlc3BvbnNlVGV4dCB8fCAnJyk7XG4vLyAgICAgICAgICAgICAgICAgfVxuLy8gICAgICAgICAgICAgfTtcbi8vICAgICAgICAgfSlcbi8vICAgICB9XG4vL1xuLy8gLy/QpNGD0L3QutGG0LjRjyDQv9GA0L7QstC10YDQutC4INC90LDQu9C40YfQuNGPINGB0YLRgNC+0LrQuCBleHBpcmVkINCyIHNlc3Npb24gc3RvcmFnZVxuLy8gICAgIGZ1bmN0aW9uIGRvZXNTZXNzaW9uU3RvcmFnZUNvbnRhaW5zRXhwaXJlZFN0cmluZygpIHtcbi8vICAgICAgICAgaWYgKHNlc3Npb25TdG9yYWdlLmdldEl0ZW0oJ2V4cGlyZWQnKSkge1xuLy8gICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4vLyAgICAgICAgIH0gZWxzZSB7XG4vLyAgICAgICAgICAgICByZXR1cm4gZmFsc2Vcbi8vICAgICAgICAgfVxuLy8gICAgIH1cbi8vXG4vLyAvL9Ck0YPQvdC60YbQuNGPINC/0YDQvtCy0LXRgNC60Lgg0L3QsNC70LjRh9C40Y8g0YHRgtGA0L7QutC4IFwi0L7RgtC/0YDQsNCy0LjRgtGMXCIg0LIgc2Vzc2lvbiBzdG9yYWdlXG4vLyAgICAgZnVuY3Rpb24gZG9lc1Nlc3Npb25TdG9yYWdlQ29udGFpbnNUb1NlbmRTdHJpbmcoKSB7XG4vLyAgICAgICAgIGlmIChzZXNzaW9uU3RvcmFnZS5nZXRJdGVtKCd0by1zZW5kJykpIHtcbi8vICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuLy8gICAgICAgICB9IGVsc2Uge1xuLy8gICAgICAgICAgICAgcmV0dXJuIGZhbHNlXG4vLyAgICAgICAgIH1cbi8vICAgICB9XG4vL1xuLy8gLy/QpNGD0L3QutGG0LjRjyDQv9GA0L7QstC10YDQutC4INC90LDQu9C40YfQuNGPINGB0YLRgNC+0LrQuCBcItC+0YLQv9GA0LDQstC70LXQvdC+XCIg0LIgc2Vzc2lvbiBzdG9yYWdlXG4vLyAgICAgZnVuY3Rpb24gZG9lc1Nlc3Npb25TdG9yYWdlQ29udGFpbnNTZW50U3RyaW5nKCkge1xuLy8gICAgICAgICBpZiAoc2Vzc2lvblN0b3JhZ2UuZ2V0SXRlbSgnc2VudCcpKSB7XG4vLyAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbi8vICAgICAgICAgfSBlbHNlIHtcbi8vICAgICAgICAgICAgIHJldHVybiBmYWxzZVxuLy8gICAgICAgICB9XG4vLyAgICAgfVxuLy9cbi8vIC8v0KTRg9C90LrRhtC40Y8g0L7RgtC/0YDQsNCy0LrQuCDRgdC+0L7QsdGJ0LXQvdC40Y8g0LIgVGVsZWdyYW0g0LrQsNC90LDQu1xuLy8gICAgIGZ1bmN0aW9uIHNlbmRNZXNzYWdlKG1lc3NhZ2UpIHtcbi8vICAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcbi8vICAgICAgICAgICAgIGNvbnN0IHggPSBuZXcgWE1MSHR0cFJlcXVlc3QoKTtcbi8vICAgICAgICAgICAgIHgub3BlbignR0VUJywgJ2h0dHBzOi8vYXBpLnRlbGVncmFtLm9yZy9ib3QxMDE4NzU3MDEzOkFBRUhPOWFjY1Voc2NpZVQwQXJScTlpd1VlYXQ2Qm1Fek9NL3NlbmRNZXNzYWdlP2NoYXRfaWQ9LTEwMDE0NzE2Nzc2MTQmdGV4dD0nICsgbWVzc2FnZSk7XG4vLyAgICAgICAgICAgICB4LnNlbmQoKTtcbi8vICAgICAgICAgICAgIHgub25sb2FkID0gKCkgPT4ge1xuLy8gICAgICAgICAgICAgICAgIGlmICh4LnN0YXR1cyAhPSAyMDApIHtcbi8vICAgICAgICAgICAgICAgICAgICAgcmVqZWN0KHguc3RhdHVzVGV4dClcbi8vICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuLy8gICAgICAgICAgICAgICAgICAgICByZXNvbHZlKHgucmVzcG9uc2VUZXh0IHx8ICcnKTtcbi8vICAgICAgICAgICAgICAgICB9XG4vLyAgICAgICAgICAgICB9O1xuLy8gICAgICAgICB9KVxuLy8gICAgIH1cbi8vXG4vLyAvL9Cy0YDQtdC80Y8g0LTQviDQv9GA0L7RgdGA0L7Rh9C60Lgg0LIg0YHQtdC60YPQvdC00LDRhVxuLy8gICAgIGxldCB0aW1lVG9FeHBpcmUgPSAxODAwO1xuLy8gICAgIGNvbnN0IHRpbWVUb0V4cGlyZUlucHV0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLm9wdGlvbnNfX3RpbWUtdG8tZXhwaXJlJyk7XG4vLyAgICAgY29uc3QgdGltZVRvRXhwaXJlQnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLm9wdGlvbnNfX3RpbWUtdG8tZXhwaXJlLWJ1dHRvbicpO1xuLy8gICAgIHRpbWVUb0V4cGlyZUJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChlKSA9PiB7XG4vLyAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbi8vICAgICAgICAgdGltZVRvRXhwaXJlID0gdGltZVRvRXhwaXJlSW5wdXQudmFsdWUgKiA2MDtcbi8vICAgICB9KVxuLy9cbi8vIC8v0LLRgNC10LzRjyDQtNC+INC+0YLQv9GA0LDQstC60Lgg0YHQvtC+0LHRidC10L3QuNGPINCyINGB0LXQutGD0L3QtNCw0YVcbi8vICAgICBsZXQgdGltZVRvU2VuZE1lc3NhZ2UgPSAyMDtcbi8vXG4vLyAvL9Cy0YDQtdC80LXQvdC90L7QuSDQuNC90YLQtdGA0LLQsNC7INC80LXQttC00YMg0LfQsNC/0YDQvtGB0LDQvNC4INC90LAg0YHQtdGA0LLQtdGAXG4vLyAgICAgbGV0IHJlcXVlc3RJbnRlcnZhbCA9IDEwO1xuLy9cbi8vIC8v0LzQsNGB0YHQuNCyINGBINC30LDQutCw0LfQsNC80Lgg0LTQu9GPINC+0YLQv9GA0LDQstC60Lgg0YHQvtC+0LHRidC10L3QuNGPXG4vLyAgICAgbGV0IG9yZGVyc1RvVGVsZWdyYW0gPSBbXTtcbi8vXG4vLyAvL9C/0LXRgNC10LzQtdC90L3QsNGPINC00LvRjyDQv9C+0LvRg9GH0LXQvdC40Y8g0LjRgdGF0L7QtNC90YvRhSDQtNCw0L3QvdGL0YVcbi8vICAgICBsZXQgZXh0ZXJuYWxDb250ZW50ID0gJyc7XG4vL1xuLy8gLy/RgdC+0LfQtNCw0LXQvCDQv9C10YDQtdC80LXQvdC90YPRjiDQtNC70Y8g0YHQutGA0YvRgtC+0Lkg0LjRgdGF0L7QtNC90L7QuSDRgtCw0LHQu9C40YbRi1xuLy8gICAgIGNvbnN0IHRhYmxlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnRhYmxlJyk7XG4vL1xuLy8gLy/Qt9C00LDQtdC8INC/0LXRgNC10LzQtdC90L3Rg9GOINC00LvRjyDRgdGC0YDQvtC60Lgg0L/RgNC+0YHRgNC+0YfQtdC90L3Ri9GFINC30LDQutCw0LfQvtCyXG4vLyAgICAgY29uc3QgZXhwaXJlZE9yZGVycyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5leHBpcmVkLW9yZGVycycpO1xuLy9cbi8vXG4vLyAgICAgLy/Qv9C+0YHQu9C10LTQvtCy0LDRgtC10LvRjNC90L7RgdGC0Ywg0LDRgdC40L3RhdGA0L7QvdC90YvRhSDQvtC/0LXRgNCw0YbQuNC5XG4vLyAgICAgY2FsbEV4dGVybmFsQ29udGVudCgpXG4vLyAgICAgICAgIC50aGVuKHJlc3VsdCA9PiB7XG4vLyAgICAgICAgICAgICAgICAgZXh0ZXJuYWxDb250ZW50ID0gcmVzdWx0O1xuLy8gICAgICAgICAgICAgfSxcbi8vICAgICAgICAgICAgIGVycm9yID0+IGNvbnNvbGUubG9nKCdFcnJvcicgKyAnOiAnICsgZXJyb3IpKVxuLy8gICAgICAgICAudGhlbigoKSA9PiB7XG4vLyAgICAgICAgICAgICAvL9Cy0YvRgtCw0YHQutC40LLQsNC10Lwg0YLQsNCx0LvQuNGG0YMg0LjQtyDQuNGB0YXQvtC00L3QvtCz0L4g0LrQvtC00LBcbi8vICAgICAgICAgICAgIGV4dGVybmFsQ29udGVudCA9IGV4dGVybmFsQ29udGVudC5zdWJzdHIoMzQ3NiwgZXh0ZXJuYWxDb250ZW50Lmxlbmd0aCAtIDM3MDQpO1xuLy8gICAgICAgICAgICAgdGFibGUuaW5uZXJIVE1MID0gZXh0ZXJuYWxDb250ZW50O1xuLy8gICAgICAgICAgICAgLy/QstGL0YLQsNGB0LrQuNCy0LDQtdC8INGB0YLRgNC+0LrQuFxuLy8gICAgICAgICAgICAgY29uc3Qgcm93cyA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKCd0cicpO1xuLy8gICAgICAgICAgICAgLy/Qv9C10YDQtdC80LXQvdC90LDRjyDQtNC70Y8g0YHRgtGA0L7QuiDRhNC40LvRjNGC0YDQvtCy0LDQvdC90L7QuSDRgtCw0LHQu9C40YbRi1xuLy8gICAgICAgICAgICAgbGV0IGZpbHRlcmVkUm93cyA9IFtdO1xuLy9cbi8vICAgICAgICAgICAgIC8v0YPQtNCw0LvRj9C10Lwg0YHRgtGA0L7QutC4INC30LDQs9C+0LvQvtCy0LrQvtCyINGC0LDQsdC70LjRhiwg0YPQtNCw0LvRj9C10Lwg0L7RgtC80LXQvdC10L3QvdGL0LUg0LfQsNC60LDQt9GLLCDRhNC+0YDQvNC40YDRg9C10Lwg0L7QtNC90YMg0YLQsNCx0LvQuNGG0YMg0LjQtyDQtNCy0YPRhVxuLy8gICAgICAgICAgICAgZm9yIChpID0gMDsgaSA8IHJvd3MubGVuZ3RoOyBpKyspIHtcbi8vICAgICAgICAgICAgICAgICBpZiAocm93c1tpXS5pbm5lckhUTUwubGVuZ3RoICE9PSAzNzcpIHtcbi8vICAgICAgICAgICAgICAgICAgICAgaWYgKHJvd3NbaV0uY2hpbGRyZW5bM10uaW5uZXJIVE1MLmxlbmd0aCA+IDEwMCkge1xuLy8gICAgICAgICAgICAgICAgICAgICAgICAgcm93c1tpXS5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKHJvd3NbaV0pO1xuLy8gICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuLy8gICAgICAgICAgICAgICAgICAgICAgICAgZmlsdGVyZWRSb3dzLnB1c2gocm93c1tpXSk7XG4vLyAgICAgICAgICAgICAgICAgICAgIH1cbi8vICAgICAgICAgICAgICAgICB9XG4vLyAgICAgICAgICAgICB9XG4vL1xuLy8gICAgICAgICAgICAgLy/Rg9C00LDQu9GP0LXQvCDRh9C10YLQstC10YDRgtGD0Y4g0Y/Rh9C10LnQutGDXG4vLyAgICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgZmlsdGVyZWRSb3dzLmxlbmd0aDsgaSsrKSB7XG4vLyAgICAgICAgICAgICAgICAgZmlsdGVyZWRSb3dzW2ldLnJlbW92ZUNoaWxkKGZpbHRlcmVkUm93c1tpXS5jaGlsZHJlblszXSk7XG4vL1xuLy8gICAgICAgICAgICAgICAgIC8v0LTQvtCx0LDQstC70Y/QtdC8INGP0YfQtdC50LrRgyDRgdC+INCy0YDQtdC80LXQvdC10Lxcbi8vICAgICAgICAgICAgICAgICBsZXQgdGltZUl0ZW0gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0ZCcpO1xuLy8gICAgICAgICAgICAgICAgIGZpbHRlcmVkUm93c1tpXS5hcHBlbmRDaGlsZCh0aW1lSXRlbSk7XG4vLyAgICAgICAgICAgICB9XG4vL1xuLy8gICAgICAgICAgICAgLy/RgNC10L3QtNC10YDQuNC8INGC0LDQsdC70LjRhtGDXG4vLyAgICAgICAgICAgICBjb25zdCBmaWx0ZXJlZFRhYmxlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmZpbHRlcmVkLXRhYmxlJyk7XG4vLyAgICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgZmlsdGVyZWRSb3dzLmxlbmd0aDsgaSsrKSB7XG4vLyAgICAgICAgICAgICAgICAgZmlsdGVyZWRUYWJsZS5pbm5lckhUTUwgKz0gZmlsdGVyZWRSb3dzW2ldLmlubmVySFRNTDtcbi8vICAgICAgICAgICAgIH1cbi8vXG4vLyAgICAgICAgICAgICAvL9Cf0YDQvtCy0LXRgNGP0LXQvCDQvdCw0LvQuNGH0LjQtSDQt9Cw0LrQsNC30LAg0LIgc2Vzc2lvbiBzdG9yYWdlLCDQtNC+0LHQsNCy0LvRj9C10Lwg0LfQsNC60LDQtyDQtdGB0LvQuCDQtdCz0L4g0L3QtdGCLCDQv9GA0L7QstC10YDRj9C10Lwg0LLRgNC10LzRjyDQvdCw0LHQvtGA0LrQuFxuLy8gICAgICAgICAgICAgZm9yIChpID0gMDsgaSA8IGZpbHRlcmVkVGFibGUuY2hpbGRyZW4ubGVuZ3RoOyBpKyspIHtcbi8vICAgICAgICAgICAgICAgICAvL2NvbnNvbGUubG9nKGZpbHRlcmVkVGFibGUpO1xuLy8gICAgICAgICAgICAgICAgIC8v0L/QvtC70YPRh9Cw0LXQvCDQvdC+0LzQtdGAINC30LDQutCw0LfQsCDQuNC3INGC0LDQsdC70LjRhtGLXG4vLyAgICAgICAgICAgICAgICAgbGV0IG9yZGVyTnVtYmVyID0gcGFyc2VJbnQoZmlsdGVyZWRUYWJsZS5jaGlsZHJlbltpXS5jaGlsZHJlblswXS5jaGlsZHJlblswXS5jaGlsZHJlblswXS5jaGlsZHJlblswXS5pbm5lckhUTUwpO1xuLy9cbi8vICAgICAgICAgICAgICAgICAvL9C/0YDQvtCy0LXRgNGP0LXQvCDQvdCw0LvQuNGH0LjQtSDQt9Cw0LrQsNC30LAg0LIgc2Vzc2lvbiBzdG9yYWdlXG4vLyAgICAgICAgICAgICAgICAgLy8tLS3QtdGB0LvQuCDQt9Cw0LrQsNC30LAg0L3QtdGCLCDQtNC+0LHQsNCy0LvRj9C10Lwg0LIgc2Vzc2lvbiBzdG9yYWdlINC10LPQviDQvdC+0LzQtdGAINC60LDQuiDQutC70Y7RhyDQuCB1bml4dGltZSDQutCw0Log0LfQvdCw0YfQtdC90LjQtVxuLy8gICAgICAgICAgICAgICAgIGlmICghaXNPcmRlck51bWJlckluU2Vzc2lvblN0b3JhZ2Uob3JkZXJOdW1iZXIpKSB7XG4vLyAgICAgICAgICAgICAgICAgICAgIHNlc3Npb25TdG9yYWdlLnNldEl0ZW0ob3JkZXJOdW1iZXIsIHBhcnNlSW50KG5ldyBEYXRlKCkuZ2V0VGltZSgpIC8gMTAwMCkpO1xuLy8gICAgICAgICAgICAgICAgICAgICAvLyAtLS0g0YPRgdGC0LDQvdCw0LLQu9C40LLQsNC10Lwg0LLRgNC10LzRjyDQsiDRh9C10YLQstC10YDRgtGL0Lkg0YHRgtC+0LvQsdC10YZcbi8vICAgICAgICAgICAgICAgICAgICAgZmlsdGVyZWRUYWJsZS5jaGlsZHJlbltpXS5jaGlsZHJlblswXS5jaGlsZHJlblszXS5pbm5lckhUTUwgPSAnMDowMCc7XG4vLyAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbi8vICAgICAgICAgICAgICAgICAgICAgLy/QtdGB0LvQuCDQt9Cw0LrQsNC3INC10YHRgtGMLCDQvtCx0L3QvtCy0LvRj9C10Lwg0LLRgNC10LzRj1xuLy8gICAgICAgICAgICAgICAgICAgICBsZXQgc2Vjb25kcyA9IHBhcnNlSW50KG5ldyBEYXRlKCkuZ2V0VGltZSgpIC8gMTAwMCkgLSBzZXNzaW9uU3RvcmFnZS5nZXRJdGVtKG9yZGVyTnVtYmVyKTtcbi8vICAgICAgICAgICAgICAgICAgICAgZmlsdGVyZWRUYWJsZS5jaGlsZHJlbltpXS5jaGlsZHJlblswXS5jaGlsZHJlblszXS5pbm5lckhUTUwgPSB1bml4VGltZVRvTm9ybWFsKHNlY29uZHMpO1xuLy9cbi8vICAgICAgICAgICAgICAgICAgICAgLy/QtdGB0LvQuCDQv9C+0YDQsCDQvtGC0L/RgNCw0LLQu9GP0YLRjCDRgdC+0L7QsdGJ0LXQvdC40LUsINC+0YLQv9GA0LDQstC70Y/QtdC8INC10LPQviDQsiBzZXNzaW9uIHN0b3JhZ2Vcbi8vICAgICAgICAgICAgICAgICAgICAgaWYgKHNlY29uZHMgPiB0aW1lVG9TZW5kTWVzc2FnZSkge1xuLy8gICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFpc0FkZGVkVG9TZW5kU3RyaW5nKG9yZGVyTnVtYmVyKSkge1xuLy8gICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkb2VzU2Vzc2lvblN0b3JhZ2VDb250YWluc1RvU2VuZFN0cmluZygpKSB7XG4vLyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlc3Npb25TdG9yYWdlLnNldEl0ZW0oJ3RvLXNlbmQnLCBzZXNzaW9uU3RvcmFnZS5nZXRJdGVtKCd0by1zZW5kJykgKyAnfCcgKyBvcmRlck51bWJlcik7XG4vLyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbi8vICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2Vzc2lvblN0b3JhZ2Uuc2V0SXRlbSgndG8tc2VuZCcsIG9yZGVyTnVtYmVyKTtcbi8vICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4vLyAgICAgICAgICAgICAgICAgICAgICAgICB9XG4vLyAgICAgICAgICAgICAgICAgICAgIH1cbi8vXG4vLyAgICAgICAgICAgICAgICAgICAgIC8v0LXRgdC70Lgg0LfQsNC60LDQtyDQv9GA0L7RgdGA0L7Rh9C10L0sINC+0YLQv9GA0LDQstC70Y/QtdC8INC10LPQviDQsiBzZXNzaW9uIHN0b3JhZ2Vcbi8vICAgICAgICAgICAgICAgICAgICAgaWYgKHNlY29uZHMgPiB0aW1lVG9FeHBpcmUpIHtcbi8vICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghaXNBZGRlZChvcmRlck51bWJlcikpIHtcbi8vICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZG9lc1Nlc3Npb25TdG9yYWdlQ29udGFpbnNFeHBpcmVkU3RyaW5nKCkpIHtcbi8vICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2Vzc2lvblN0b3JhZ2Uuc2V0SXRlbSgnZXhwaXJlZCcsIHNlc3Npb25TdG9yYWdlLmdldEl0ZW0oJ2V4cGlyZWQnKSArICd8JyArIG9yZGVyTnVtYmVyKTtcbi8vICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuLy8gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZXNzaW9uU3RvcmFnZS5zZXRJdGVtKCdleHBpcmVkJywgb3JkZXJOdW1iZXIpO1xuLy8gICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbi8vICAgICAgICAgICAgICAgICAgICAgICAgIH1cbi8vICAgICAgICAgICAgICAgICAgICAgfVxuLy8gICAgICAgICAgICAgICAgIH1cbi8vICAgICAgICAgICAgIH1cbi8vICAgICAgICAgICAgIC8v0KTQvtGA0LzQuNGA0YPQtdC8INGB0YLRgNC+0LrRgyDRgSDQv9GA0L7RgdGA0L7Rh9C10L3QvdGL0LzQuCDQt9Cw0LrQsNC30LDQvNC4XG4vLyAgICAgICAgICAgICBpZiAoZG9lc1Nlc3Npb25TdG9yYWdlQ29udGFpbnNFeHBpcmVkU3RyaW5nKCkpIHtcbi8vICAgICAgICAgICAgICAgICBsZXQgdGV4dCA9IHNlc3Npb25TdG9yYWdlLmdldEl0ZW0oJ2V4cGlyZWQnKTtcbi8vICAgICAgICAgICAgICAgICB0ZXh0ID0gdGV4dC5zcGxpdCgnfCcpO1xuLy8gICAgICAgICAgICAgICAgIGxldCBjcmVhdGVkVGV4dCA9ICcnO1xuLy8gICAgICAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCB0ZXh0Lmxlbmd0aDsgaSsrKSB7XG4vLyAgICAgICAgICAgICAgICAgICAgIGNyZWF0ZWRUZXh0ICs9IFwiLCBcIiArIHRleHRbaV07XG4vLyAgICAgICAgICAgICAgICAgfVxuLy8gICAgICAgICAgICAgICAgIGNyZWF0ZWRUZXh0ID0gY3JlYXRlZFRleHQuc3Vic3RyKDIpO1xuLy8gICAgICAgICAgICAgICAgIGV4cGlyZWRPcmRlcnMuaW5uZXJIVE1MID0gY3JlYXRlZFRleHQ7XG4vLyAgICAgICAgICAgICB9XG4vLyAvL9Cf0YDQvtCy0LXRgNGP0LXQvCwg0L7RgtC/0YDQsNCy0LvQtdC90Ysg0LvQuCDRgdC+0L7QsdGJ0LXQvdC40Y8g0L/QviDQt9Cw0LrQsNC30LDQvFxuLy8gICAgICAgICAgICAgaWYgKGRvZXNTZXNzaW9uU3RvcmFnZUNvbnRhaW5zVG9TZW5kU3RyaW5nKCkpIHtcbi8vICAgICAgICAgICAgICAgICBsZXQgb3JkZXJzVG9TZW5kID0gc2Vzc2lvblN0b3JhZ2UuZ2V0SXRlbSgndG8tc2VuZCcpO1xuLy8gICAgICAgICAgICAgICAgIGxldCBvcmRlcnNUb1NlbmRBcnJheSA9IG9yZGVyc1RvU2VuZC5zcGxpdCgnfCcpO1xuLy8gICAgICAgICAgICAgICAgIGlmIChkb2VzU2Vzc2lvblN0b3JhZ2VDb250YWluc1NlbnRTdHJpbmcoKSkge1xuLy8gICAgICAgICAgICAgICAgICAgICBsZXQgc2VudE9yZGVycyA9IHNlc3Npb25TdG9yYWdlLmdldEl0ZW0oJ3NlbnQnKTtcbi8vICAgICAgICAgICAgICAgICAgICAgbGV0IHNlbnRPcmRlcnNBcnJheSA9IHNlbnRPcmRlcnMuc3BsaXQoJ3wnKTtcbi8vICAgICAgICAgICAgICAgICAgICAgZm9yIChpID0gMDsgaSA8IG9yZGVyc1RvU2VuZEFycmF5Lmxlbmd0aDsgaSsrKSB7XG4vLyAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGogPSAwOyBqIDwgc2VudE9yZGVyc0FycmF5Lmxlbmd0aDsgaisrKSB7XG4vLyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG9yZGVyc1RvU2VuZEFycmF5W2ldID09IHNlbnRPcmRlcnNBcnJheVtqXSkge1xuLy8gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcmRlcnNUb1NlbmRBcnJheS5zcGxpY2UoaSwgMSk7XG4vLyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuLy8gICAgICAgICAgICAgICAgICAgICAgICAgfVxuLy8gICAgICAgICAgICAgICAgICAgICB9XG4vLyAgICAgICAgICAgICAgICAgfVxuLy8gICAgICAgICAgICAgICAgIGlmIChvcmRlcnNUb1NlbmRBcnJheSkge1xuLy8gICAgICAgICAgICAgICAgICAgICBvcmRlcnNUb1RlbGVncmFtID0gb3JkZXJzVG9TZW5kQXJyYXk7XG4vLyAgICAgICAgICAgICAgICAgfVxuLy8gICAgICAgICAgICAgfVxuLy9cbi8vICAgICAgICAgfSlcbi8vICAgICAgICAgLnRoZW4oKCkgPT4ge1xuLy8gICAgICAgICAgICAgaWYgKG9yZGVyc1RvVGVsZWdyYW0pIHtcbi8vICAgICAgICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgb3JkZXJzVG9UZWxlZ3JhbS5sZW5ndGg7IGkrKykge1xuLy8gICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygn0JfQsNC60LDQtyAnICsgb3JkZXJzVG9UZWxlZ3JhbVtpXSArICcg0LIg0L3QsNCx0L7RgNC1INGD0LbQtSAnICsgdGltZVRvU2VuZE1lc3NhZ2UgLyA2MCArICcg0LzQuNC90YPRgicpO1xuLy8gICAgICAgICAgICAgICAgICAgICAvL3NlbmRNZXNzYWdlKCfQl9Cw0LrQsNC3ICcgKyBvcmRlcnNUb1RlbGVncmFtW2ldICsgJyDQsiDQvdCw0LHQvtGA0LUg0YPQttC1ICcgKyB0aW1lVG9TZW5kTWVzc2FnZS82MCArICcg0LzQuNC90YPRgicpO1xuLy8gICAgICAgICAgICAgICAgICAgICBpZiAoZG9lc1Nlc3Npb25TdG9yYWdlQ29udGFpbnNTZW50U3RyaW5nKCkpIHtcbi8vICAgICAgICAgICAgICAgICAgICAgICAgIHNlc3Npb25TdG9yYWdlLnNldEl0ZW0oJ3NlbnQnLCBzZXNzaW9uU3RvcmFnZS5nZXRJdGVtKCdzZW50JykgKyAnfCcgKyBvcmRlcnNUb1RlbGVncmFtW2ldKTtcbi8vICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbi8vICAgICAgICAgICAgICAgICAgICAgICAgIHNlc3Npb25TdG9yYWdlLnNldEl0ZW0oJ3NlbnQnLCBvcmRlcnNUb1RlbGVncmFtW2ldKTtcbi8vICAgICAgICAgICAgICAgICAgICAgfVxuLy8gICAgICAgICAgICAgICAgIH1cbi8vICAgICAgICAgICAgIH1cbi8vICAgICAgICAgfSlcbi8vICAgICAgICAgIC50aGVuKCgpID0+IHtcbi8vICAgICAgICAgICAgICB3aW5kb3cuc2V0VGltZW91dCgoKSA9PiBkb2N1bWVudC5sb2NhdGlvbi5yZWxvYWQoKSwgMTAwMDApO1xuLy8gICAgICAgICAgfSlcbn0pXG4iLCIvL9GD0YHRgtCw0L3QsNCy0LvQuNCy0LDQtdC8INC40L3RgtC10YDQstCw0LssINCy0YDQtdC80Y8g0YHQvtC+0LHRidC10L3QuNGPLCDQstGA0LXQvNGPINC00L4g0L/RgNC+0YHRgNC+0YfQutC4XG5kb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcub3B0aW9uc19fdGltZS10by1leHBpcmUtYnV0dG9uJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoZSkgPT4ge1xuICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICBjb25zdCBleHBpcmVUZXh0QXJlYSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5vcHRpb25zX190aW1lLXRvLWV4cGlyZScpO1xuICAgIGlmIChleHBpcmVUZXh0QXJlYS52YWx1ZSkge1xuICAgICAgICBjb25zdCBtYWluT2JqZWN0ID0gZ2V0TWFpbk9iamVjdCgpO1xuICAgICAgICBtYWluT2JqZWN0LmV4cGlyYXRpb25UaW1lID0gcGFyc2VJbnQoZXhwaXJlVGV4dEFyZWEudmFsdWUpICogNjA7XG4gICAgICAgIHNldE1haW5PYmplY3QobWFpbk9iamVjdCk7XG4gICAgICAgIGV4cGlyZVRleHRBcmVhLnBsYWNlaG9sZGVyID0gZXhwaXJlVGV4dEFyZWEudmFsdWU7XG4gICAgICAgIGV4cGlyZVRleHRBcmVhLnZhbHVlID0gJyc7XG4gICAgfSBlbHNlIHtcbiAgICAgICAgLy9UT0RPOiDQlNC+0L/QuNGB0LDRgtGMINCy0YvQstC+0LQg0L3QsCDRjdC60YDQsNC9INGB0L7QvtCx0YnQtdC90LjRjyDQviDRgtC+0LwsINGH0YLQviDQt9C90LDRh9C10L3QuNC1INC90LUg0LLQstC10LTQtdC90L5cbiAgICB9XG59KVxuXG5kb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcub3B0aW9uc19fdGltZS10by1zZW5kLW1lc3NhZ2UtYnV0dG9uJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoZSkgPT4ge1xuICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICBjb25zdCBtZXNzYWdlVGV4dEFyZWEgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcub3B0aW9uc19fdGltZS10by1zZW5kLW1lc3NhZ2UnKTtcbiAgICBpZiAobWVzc2FnZVRleHRBcmVhLnZhbHVlKSB7XG4gICAgICAgIGNvbnN0IG1haW5PYmplY3QgPSBnZXRNYWluT2JqZWN0KCk7XG4gICAgICAgIG1haW5PYmplY3QubWVzc2FnZVRpbWUgPSBwYXJzZUludChtZXNzYWdlVGV4dEFyZWEudmFsdWUpICogNjA7XG4gICAgICAgIG1lc3NhZ2VUZXh0QXJlYS5wbGFjZWhvbGRlciA9IG1lc3NhZ2VUZXh0QXJlYS52YWx1ZTtcbiAgICAgICAgbWVzc2FnZVRleHRBcmVhLnZhbHVlID0gJyc7XG4gICAgICAgIHNldE1haW5PYmplY3QobWFpbk9iamVjdCk7XG4gICAgfSBlbHNlIHtcbiAgICAgICAgLy9UT0RPOiDQtNC+0L/QuNGB0LDRgtGMINCy0YvQstC+0LQg0L3QsCDRjdC60YDQsNC9INC+INGC0L7QvCwg0YfRgtC+INC30L3QsNGH0LXQvdC40LUg0L3QtSDQstCy0LXQtNC10L3QvlxuICAgIH1cbn0pXG5cbmRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5vcHRpb25zX19yZXF1ZXN0LWludGVydmFsLWJ1dHRvbicpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGUpID0+IHtcbiAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgY29uc3QgcmVxdWVzdFRleHRBcmVhID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLm9wdGlvbnNfX3JlcXVlc3QtaW50ZXJ2YWwnKTtcbiAgICBpZiAocmVxdWVzdFRleHRBcmVhLnZhbHVlICYmIHBhcnNlSW50KHJlcXVlc3RUZXh0QXJlYS52YWx1ZSkgPiAxMCkge1xuICAgICAgICBjb25zdCBtYWluT2JqZWN0ID0gZ2V0TWFpbk9iamVjdCgpO1xuICAgICAgICBtYWluT2JqZWN0LnJlcXVlc3RJbnRlcnZhbCA9IHBhcnNlSW50KHJlcXVlc3RUZXh0QXJlYS52YWx1ZSkgKiAxMDAwO1xuICAgICAgICByZXF1ZXN0VGV4dEFyZWEucGxhY2Vob2xkZXIgPSByZXF1ZXN0VGV4dEFyZWEudmFsdWU7XG4gICAgICAgIHJlcXVlc3RUZXh0QXJlYS52YWx1ZSA9ICcnO1xuICAgICAgICBzZXRNYWluT2JqZWN0KG1haW5PYmplY3QpO1xuICAgIH0gZWxzZSB7XG4gICAgICAgIC8vVE9ETzog0LTQvtC/0LjRgdCw0YLRjCDQstGL0LLQvtC0INC90LAg0Y3QutGA0LDQvSDQviDRgtC+0LwsINGH0YLQviDQt9C90LDRh9C10L3QuNC1INC90LUg0LLQstC10LTQtdC90L4g0LjQu9C4INC80LXQvdGM0YjQtSAxMCDRgdC10LpcbiAgICB9XG59KSJdfQ==
