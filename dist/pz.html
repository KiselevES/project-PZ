<!doctype html><html lang="ru"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,user-scalable=no,initial-scale=1,maximum-scale=1,minimum-scale=1"><meta http-equiv="X-UA-Compatible" content="ie=edge"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400"><style>html{line-height:1.15;-webkit-text-size-adjust:100%}body{margin:0}main{display:block}h1{font-size:2em;margin:.67em 0}hr{box-sizing:content-box;height:0;overflow:visible}pre{font-family:monospace,monospace;font-size:1em}a{background-color:transparent}abbr[title]{border-bottom:none;text-decoration:underline;-webkit-text-decoration:underline dotted;text-decoration:underline dotted}b,strong{font-weight:bolder}code,kbd,samp{font-family:monospace,monospace;font-size:1em}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}button,input,optgroup,select,textarea{font-family:inherit;font-size:100%;line-height:1.15;margin:0}button,input{overflow:visible}button,select{text-transform:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{padding:.35em .75em .625em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}progress{vertical-align:baseline}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}details{display:block}summary{display:list-item}[hidden],template{display:none}html{font-size:16px}body{font-family:Roboto;font-weight:300;-webkit-font-smoothing:antialiased;line-height:1.42;padding:20px 0}body,html{width:100%;height:100%}.wrapper{min-height:100%;overflow:hidden;position:relative;min-width:940px}.wrapper:after{content:"";height:50px;display:block;overflow:hidden}footer{text-align:center;height:50px;margin-top:-50px;position:relative;width:100%}.container{max-width:940px;margin:0 auto}*{box-sizing:border-box}ul{padding:0;margin:0}li{list-style:none}p{margin-top:0}h1,h2,h3,h4,h5,h6{margin-top:0;font-weight:400}body{background:#fff}.telegram__check{margin-bottom:10px}.telegram__link{text-decoration:none;font-weight:400;color:#08c}.telegram__checkbox-label{margin-left:5px}.options__label{font-size:14px;padding-left:5px}.input{width:30px;border-radius:5px;border:1px solid #e9011b}.input__outer{margin-bottom:5px}.options__label{position:relative}.options__message-box{position:absolute;padding:5px 10px;border-radius:10px;border:1px solid #e9011b;background:#fff;font-size:16px;color:#e9011b;display:none}.options__message-box-time-to-expire,.options__message-box-time-to-send-message{top:-40px;left:-200px}.options__message-box-request-interval{top:-40px;left:-260px}.outer{margin:0 auto;width:431px}.outer:after{display:block;content:"";clear:both}.logo__img{max-height:85px}.table{display:none}td{width:90px;height:20px;border:1px solid #000;text-align:center;vertical-align:middle}.new-table__header{font-size:0;width:940px;background:#e9011b;overflow:hidden;border-radius:10px 10px 0 0;z-index:3}.new-table__header-white-bg{width:100%;height:22px;background:#fff;position:relative;z-index:2}.check:after{display:inline-block;content:"X"}.new-table{position:relative;border:1px solid #e9011b;width:100%;border-radius:0 0 10px 10px;border-spacing:0;overflow:hidden;margin:0 auto 10px;z-index:1}.new-table__header-cell{display:inline-block;background:#e9011b;color:#fff;font-weight:400;text-align:center;width:18.71%;font-size:16px}.new-table__header-cell:first-child{width:6.4%}.new-table__order-warning{background:rgba(253,205,24,.3)}.new-table__order-expired{background:rgba(233,1,27,.3)}.new-table__order-normal{background:rgba(117,233,1,.3)}.new-table__order-remade{background:rgba(1,105,233,.3)}.new-table__cell{border-top:1px solid #e9011b;border-right:0;border-left:1px solid #e9011b;border-bottom:0}.new-table__cell:first-child{border-left:0;width:30px}tbody:first-child .new-table__cell{border-top:0}.instruction{margin-bottom:20px}.instruction__item{display:inline-block;margin-right:15px}.instruction__sample{width:12px;height:12px;border:1px solid #000;display:inline-block}.instruction__sample_expired{background:rgba(233,1,27,.3)}.instruction__sample_normal{background:rgba(117,233,1,.3)}.instruction__sample_remade{background:rgba(1,105,233,.3)}.instruction__sample_warning{background:rgba(253,205,24,.3)}.instruction__description{display:inline-block;margin-left:5px}.version{padding-top:10px}.source,.version{font-size:10px;color:#fff}.source{margin-top:50px}.source a{text-decoration:none;color:#fff}button{display:inline-block;background:#e9011b;border:0;padding:2px;color:#fff;border-radius:5px;font-weight:400;cursor:pointer}</style><title>Сводная информация по заказам</title></head><body><div class="wrapper"><div class="main"><div class="container"><div class="orders"><table class="hidden-table"></table><div class="new-table__header-white-bg"><div class="new-table__header"><div class="new-table__header-cell">№</div><div class="new-table__header-cell">Номер заказа</div><div class="new-table__header-cell">В очереди</div><div class="new-table__header-cell">В наборе</div><div class="new-table__header-cell">Завершен</div><div class="new-table__header-cell">Время</div></div></div><table class="new-table"></table><div class="instruction"><div class="instruction__item"><div class="instruction__sample instruction__sample_normal"></div><div class="instruction__description">- не просрочен</div></div><div class="instruction__item"><div class="instruction__sample instruction__sample_warning"></div><div class="instruction__description">- скоро просрочится, отправка уведомления в Telegram</div></div><div class="instruction__item"><div class="instruction__sample instruction__sample_expired"></div><div class="instruction__description">- просрочен</div></div><div class="instruction__item"><div class="instruction__sample instruction__sample_remade"></div><div class="instruction__description">- перевыгружен</div></div></div></div><div class="telegram">Telegram-канал: <a href="https://t.me/expiredordersnotifier" class="telegram__link" target="_blank">@expiredOrdersNotifier</a></div><div class="telegram__check"><input class="telegram__checkbox" id="telegram__checkbox" type="checkbox"><label for="telegram__checkbox" class="telegram__checkbox-label">Отправлять сообщения в Telegram</label></div><div class="options"><div class="input__outer"><input class="options__time-to-expire input" id="expire" type="text" placeholder="30"> <button class="options__time-to-expire-button options__button">Изменить</button><label class="options__label options__label-time-to-expire" for="expire">минут до просрочки<div class="options__message-box options__message-box-time-to-expire">Значение не введено!</div></label></div><div class="input__outer"><input class="options__time-to-send-message input" id="message" type="text" placeholder="23"> <button class="options__time-to-send-message-button options__button">Изменить</button><label class="options__label" for="message">минут до предупреждения<div class="options__message-box options__message-box-time-to-send-message">Значение не введено!</div></label></div><div class="input__outer"><input class="options__request-interval input" id="interval" type="text" placeholder="30" placeholder="30"> <button class="options__request-interval-button options__button">Изменить</button><label class="options__label" for="interval">секунд - интервал запросов на сервер<div class="options__message-box options__message-box-request-interval">Значение не введено или меньше 10!</div></label></div><button class="reset">Очистить БД</button><div class="source"><a href="https://github.com/KiselevES/project-PZ" target="_blank">GitHub</a></div></div></div></div></div><script>"use strict";function _defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function getMainObject(){return JSON.parse(localStorage.getItem("mainObject"))}function isMainObjectExists(){return null!==localStorage.getItem("mainObject")}function setMainObject(e){localStorage.setItem("mainObject",JSON.stringify(e))}function ismainObjectContainsOrder(e,t){for(var n=0;n<e.orders.length;n++)if(e.orders[n].orderNumber===t)return!0;return!1}function getSameOrder(e,t){for(var n=0;n<e.orders.length;n++)if(e.orders[n].orderNumber===t)return e.orders[n].orderNumber;return!1}function isOrderRemade(e,t){for(var n=0;n<e.orders.length;n++)if(e.orders[n].orderNumber===t&&!0===e.orders[n].complete)return!0;return!1}function secondsTimeToNormal(e){var t=Math.floor(e/60)+"",n=e%60+"";return n.length<2&&(n="0"+n),t+":"+n}var mainObjectClass=function e(){_classCallCheck(this,e),this.requestInterval=10,this.messageTime=1380,this.expirationTime=1800,this.orders=[],this.telegram=!0},orderClass=function(){function e(t){_classCallCheck(this,e),this.unixTime=parseInt((new Date).getTime()/1e3),this.date=parseInt((new Date).getDate()),this.expired=!1,this.messageSent=!1,this.complete=!1,this.completeTime=0,this.inQueue=!1,this.preparing=!1,this.orderNumber=t,this.needMessage=!1,this.remade=!1}return _createClass(e,[{key:"setExpired",value:function(){this.expired=!0}},{key:"setMessageSent",value:function(){this.messageSent=!0,this.needMessage=!1}},{key:"setNeedMessage",value:function(){this.needMessage=!0}},{key:"setTime",value:function(e){this.completeTime=e-this.unixTime}},{key:"setQueue",value:function(){this.inQueue=!0,this.preparing=!1}},{key:"setPreparing",value:function(){this.preparing=!0,this.inQueue=!1}},{key:"setComplete",value:function(){this.complete=!0,this.preparing=!1,this.inQueue=!1}},{key:"setRemade",value:function(){this.Complete=!1,this.Remade=!0}}]),e}(),model={callExternalContent:function(){return new Promise(function(e,t){var n=new XMLHttpRequest;n.open("GET","https://cors-anywhere.herokuapp.com/https://akson.ru/personal/order/table1/?STORE_ID=11"),n.send(),n.onload=function(){200!==n.status?t(n.statusText):e(n.responseText||"")}})},getContent:function(e){var t=e.substr(3196,e.length-3370),n=document.querySelector(".hidden-table");n.innerHTML=t;for(var r=document.getElementsByTagName("tr"),a=[],s=0;s<r.length;s++)377!==r[s].innerHTML.length&&(r[s].children[3].innerHTML.length>100?r[s].parentNode.removeChild(r[s]):a.push(r[s]));for(var o=0;o<a.length;o++)a[o].removeChild(a[o].children[3]);var i=new mainObjectClass;if(a.forEach(function(e){var t=parseInt(e.children[0].children[0].children[0].innerHTML),n=new orderClass(t);e.children[1].children[0].innerHTML.length>30?n.setQueue():e.children[2].children[0].innerHTML.length>30&&n.setPreparing(),i.orders.push(n)}),n.innerHTML="",isMainObjectExists()){var l=getMainObject(),c=new mainObjectClass;c.requestInterval=l.requestInterval,c.messageTime=l.messageTime,c.expirationTime=l.expirationTime,c.telegram=l.telegram,l.orders.forEach(function(e){var t=new orderClass(e.orderNumber);t.expired=e.expired,t.messageSent=e.messageSent,t.complete=e.complete,t.completeTime=e.completeTime,t.inQueue=e.inQueue,t.preparing=e.preparing,t.remade=e.remade,t.unixTime=e.unixTime,t.date=e.date,t.needMessage=e.needMessage,c.orders.push(t)}),i.orders.forEach(function(e,t){ismainObjectContainsOrder(c,e.orderNumber)||c.orders.push(i.orders[t])});for(var d=0;d<i.orders.length;d++)if(ismainObjectContainsOrder(c,i.orders[d].orderNumber)&&i.orders[d].preparing)for(var u=0;u<c.orders.length;u++)c.orders[u].orderNumber===i.orders[d].orderNumber&&(c.orders[u].preparing=!0,c.orders[u].inQueue=!1);c.orders.forEach(function(e){getSameOrder(i,e.orderNumber)||e.setComplete()}),i.orders.forEach(function(e){if(isOrderRemade(c,e.orderNumber))for(var t=0;t<c.orders.length;t++)if(c.orders[t].orderNumber===e.orderNumber){c.orders[t].remade=!0,c.orders[t].expired=e.expired,c.orders[t].messageSent=!1,c.orders[t].unixTime=parseInt((new Date).getTime()/1e3),c.orders[t].complete=!1,c.orders[t].completeTime=0,c.orders[t].inQueue=e.inQueue,c.orders[t].preparing=e.preparing,c.orders[t].date=e.date,c.orders[t].needMessage=e.needMessage;var n=c.orders[t];c.orders.push(n),c.orders.splice(t,1)}}),c.orders.forEach(function(e){!1===e.complete&&e.setTime(parseInt((new Date).getTime()/1e3))}),c.orders.forEach(function(e){e.completeTime>c.expirationTime&&e.setExpired()});for(var m=c.orders.length-1;m>=0;m--)parseInt((new Date).getTime()/1e3)-c.orders[m].unixTime>864e3&&c.orders.splice(m,1);setMainObject(c)}else setMainObject(i),this.getContent(e)},setWarning:function(){var e=getMainObject();e.orders.forEach(function(t){parseInt((new Date).getTime()/1e3)-t.unixTime>e.messageTime&&!t.complete&&!t.messageSent&&(t.needMessage=!0)}),setMainObject(e)}},view={drawTable:function(){var e=getMainObject(),t=document.querySelector(".new-table"),n=1;e.orders.forEach(function(e){var r="";!0===e.inQueue&&(r="X");var a="";!0===e.preparing&&(a="X");var s="";!0===e.complete&&(s="X");var o=secondsTimeToNormal(e.completeTime);e.date===parseInt((new Date).getDate())&&e.remade&&!e.messageSent?t.insertAdjacentHTML("beforeend",'\n                    <tbody class="new-table__tbody">\n                        <tr class="new-table__row new-table__order-remade">\n                            <td class="new-table__cell">'.concat(n++,'</td>\n                            <td class="new-table__cell">').concat(e.orderNumber,'</td>\n                            <td class="new-table__cell">').concat(r,'</td>\n                            <td class="new-table__cell">').concat(a,'</td>\n                            <td class="new-table__cell">').concat(s,'</td>\n                            <td class="new-table__cell">').concat(o,"</td>\n                        </tr>\n                    </tbody>")):e.date!==parseInt((new Date).getDate())||e.expired||e.messageSent?e.date===parseInt((new Date).getDate())&&!e.expired&&e.messageSent?t.insertAdjacentHTML("beforeend",'\n                    <tbody class="new-table__tbody">\n                        <tr class="new-table__row new-table__order-warning">\n                            <td class="new-table__cell">'.concat(n++,'</td>\n                            <td class="new-table__cell">').concat(e.orderNumber,'</td>\n                            <td class="new-table__cell">').concat(r,'</td>\n                            <td class="new-table__cell">').concat(a,'</td>\n                            <td class="new-table__cell">').concat(s,'</td>\n                            <td class="new-table__cell">').concat(o,"</td>\n                        </tr>\n                    </tbody>")):e.date===parseInt((new Date).getDate())&&e.expired&&e.messageSent&&t.insertAdjacentHTML("beforeend",'\n                    <tbody class="new-table__tbody">\n                        <tr class="new-table__row new-table__order-expired">\n                            <td class="new-table__cell">'.concat(n++,'</td>\n                            <td class="new-table__cell">').concat(e.orderNumber,'</td>\n                            <td class="new-table__cell">').concat(r,'</td>\n                            <td class="new-table__cell">').concat(a,'</td>\n                            <td class="new-table__cell">').concat(s,'</td>\n                            <td class="new-table__cell">').concat(o,"</td>\n                        </tr>\n                    </tbody>")):t.insertAdjacentHTML("beforeend",'\n                    <tbody class="new-table__tbody">\n                        <tr class="new-table__row new-table__order-normal">\n                            <td class="new-table__cell">'.concat(n++,'</td>\n                            <td class="new-table__cell">').concat(e.orderNumber,'</td>\n                            <td class="new-table__cell">').concat(r,'</td>\n                            <td class="new-table__cell">').concat(a,'</td>\n                            <td class="new-table__cell">').concat(s,'</td>\n                            <td class="new-table__cell">').concat(o,"</td>\n                        </tr>\n                    </tbody>"))})},setTimer:function(){var e=getMainObject();document.querySelectorAll(".new-table__tbody").forEach(function(t){0===t.children[0].children[4].innerHTML.length&&setInterval(function(){for(var n=0,r=parseInt(t.children[0].children[1].innerHTML),a=0;a<e.orders.length;a++)e.orders[a].orderNumber==r&&(n=e.orders[a].unixTime);var s=parseInt((new Date).getTime()/1e3);t.children[0].children[5].innerHTML=secondsTimeToNormal(s-n)},1e3)})},sendMessage:function(e){var t=new XMLHttpRequest;t.open("GET","https://api.telegram.org/bot1018757013:AAEHO9accUhscieT0ArRq9iwUeat6BmEzOM/sendMessage?chat_id=-1001471677614&text="+e),t.send()},sendMessages:function(){var e=this,t=getMainObject();t.orders.forEach(function(n){!0===n.needMessage&&(t.telegram&&e.sendMessage("Заказ "+n.orderNumber+" в наборе уже более "+t.messageTime/60+" минут"),n.messageSent=!0,n.needMessage=!1)}),setMainObject(t)},setPlaceholders:function(){var e=getMainObject();document.querySelector(".options__time-to-expire").placeholder=e.expirationTime/60,document.querySelector(".options__time-to-send-message").placeholder=e.messageTime/60,document.querySelector(".options__request-interval").placeholder=e.requestInterval},telegramCheckbox:function(){var e=getMainObject(),t=document.querySelector(".telegram__checkbox");e.telegram?t.setAttribute("checked","true"):t.removeAttribute("checked")}},controller={mainRoute:function(){var e=10;if(isMainObjectExists()){e=getMainObject().requestInterval}model.callExternalContent().then(function(e){model.getContent(e),model.setWarning(),view.sendMessages(),view.drawTable(),view.setTimer(),view.telegramCheckbox(),view.setPlaceholders(),document.getElementById("interval").scrollIntoView()}),window.setTimeout(function(){window.location.reload()},1e3*e)}};document.addEventListener("DOMContentLoaded",function(){controller.mainRoute()}),document.querySelector(".options__time-to-expire-button").addEventListener("click",function(e){e.preventDefault();var t=document.querySelector(".options__time-to-expire");if(t.value){var n=getMainObject();n.expirationTime=60*parseInt(t.value),setMainObject(n),t.placeholder=t.value,t.value=""}else{var r=document.querySelector(".options__message-box-time-to-expire");r.style.display="block",setTimeout(function(){r.style.display="none"},1e3)}}),document.querySelector(".options__time-to-send-message-button").addEventListener("click",function(e){e.preventDefault();var t=document.querySelector(".options__time-to-send-message");if(t.value){var n=getMainObject();n.messageTime=60*parseInt(t.value),t.placeholder=t.value,t.value="",setMainObject(n)}else{var r=document.querySelector(".options__message-box-time-to-send-message");r.style.display="block",setTimeout(function(){r.style.display="none"},1e3)}}),document.querySelector(".options__request-interval-button").addEventListener("click",function(e){e.preventDefault();var t=document.querySelector(".options__request-interval");if(t.value&&parseInt(t.value)>=10){var n=getMainObject();n.requestInterval=parseInt(t.value),t.placeholder=t.value,t.value="",setMainObject(n)}else{var r=document.querySelector(".options__message-box-request-interval");r.style.display="block",t.value="",setTimeout(function(){r.style.display="none"},1e3)}}),document.querySelector(".reset").addEventListener("click",function(e){e.preventDefault(),"УДАЛИТЬ!"===prompt('Действительно? Все данные удалятся! Для продолжения введите "УДАЛИТЬ!" большими буквами')&&(localStorage.clear(),window.location.reload())}),document.addEventListener("scroll",function(){console.log(document.querySelector(".new-table__header").getBoundingClientRect()),console.log(window.scrollY);var e=document.querySelector(".new-table__header-white-bg");window.scrollY>e.getBoundingClientRect().y?(e.style.position="fixed",e.style.top="0"):e.style.position="static"}),document.querySelector(".telegram__checkbox").addEventListener("change",function(){var e=getMainObject(),t=document.querySelector(".telegram__checkbox");e.telegram=!!t.checked,setMainObject(e)});</script></body></html>